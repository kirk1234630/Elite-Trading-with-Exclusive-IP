
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elite Trading Analytics</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://s3.tradingview.com/tv.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: linear-gradient(135deg, #1a1a3e 0%, #16213e 50%, #0f3460 100%); color: #fff; font-family: -apple-systdocem, sans-serif; min-height: 100vh; }

        .header { background: rgba(20, 20, 50, 0.95); backdrop-filter: blur(10px); border-bottom: 2px solid #00d4ff; padding: 1.2rem 2rem; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; }
        .logo { font-size: 1.8em; font-weight: 900; background: linear-gradient(135deg, #00d4ff 0%, #7c3aed 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; cursor: pointer; }
        .search-bar { flex: 1; max-width: 500px; margin: 0 2rem; display: flex; align-items: center; background: rgba(30, 30, 60, 0.8); border: 2px solid #444; border-radius: 10px; padding: 0.8rem 1rem; gap: 0.8rem; }
        .search-bar input { flex: 1; background: transparent; border: none; color: #fff; outline: none; }
        .search-bar button { background: linear-gradient(135deg, #7c3aed 0%, #06b6d4 100%); border: none; color: white; padding: 0.7rem 1.5rem; border-radius: 8px; cursor: pointer; font-weight: 700; }

        .container { max-width: 1600px; margin: 0 auto; padding: 2rem; }
        .page { display: none; }
        .page.active { display: block; }

        .btn-large { padding: 1rem 2rem; border: none; border-radius: 12px; font-size: 1.1em; font-weight: 700; cursor: pointer; display: flex; align-items: center; gap: 0.8rem; justify-content: center; }
        .btn-refresh { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; }
        .btn-brief { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; }
        .btn-newsletter { background: linear-gradient(135deg, #ec4899 0%, #db2777 100%); color: white; }
        .btn-back { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; width: 100%; margin-top: 2rem; }
        .action-buttons { display: flex; gap: 1rem; justify-content: center; margin-bottom: 2rem; flex-wrap: wrap; }

        .top-plays-section { margin-bottom: 3rem; padding: 2rem; background: rgba(0, 212, 255, 0.05); border: 2px solid #00d4ff; border-radius: 15px; }
        .top-plays-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(340px, 1fr)); gap: 1.5rem; margin-top: 1.5rem; }
        .play-card { background: linear-gradient(145deg, #1a1a40 0%, #242850 100%); border: 2px solid #333; border-radius: 15px; padding: 1.5rem; cursor: pointer; transition: all 0.3s; }
        .play-card:hover { border-color: #00d4ff; transform: translateY(-5px); }
        .play-title { font-size: 1.5em; font-weight: 900; color: white; margin-bottom: 0.5rem; }
        .play-subtitle { font-style: italic; color: #00d4ff; margin-bottom: 0.8rem; font-size: 0.95em; }
        .play-change { font-size: 1.1em; font-weight: 700; }
        .play-button { width: 100%; padding: 0.7rem 1.5rem; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; color: white; font-size: 0.95em; margin: 0.8rem 0; }
        .play-metrics-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.8rem; margin: 1rem 0; }
        .metric-box-sm { background: rgba(0, 212, 255, 0.1); border: 1px solid #444; padding: 0.6rem; border-radius: 8px; text-align: center; }
        .metric-label-sm { font-size: 0.7em; color: #b0b8c1; }
        .metric-value-sm { font-size: 1em; color: #00d4ff; font-weight: 700; margin-top: 0.2rem; }
        .play-analysis { margin: 1rem 0; padding: 1rem; background: rgba(0, 212, 255, 0.05); border-left: 3px solid; border-radius: 5px; }
        .play-analysis ul { list-style: none; padding: 0; margin: 0; }
        .play-analysis li { font-size: 0.85em; line-height: 1.6; margin: 0.4rem 0; padding-left: 1.5rem; position: relative; }
        .play-targets { margin-top: 1rem; padding: 1rem; background: rgba(0, 212, 255, 0.05); border-left: 3px solid #10b981; border-radius: 5px; }
        .play-targets-title { font-size: 0.85em; color: #10b981; font-weight: 700; margin-bottom: 0.5rem; }
        .play-targets-content { font-size: 0.85em; color: #b0b8c1; line-height: 1.6; }

        .ai-chat-toggle { position: fixed; bottom: 30px; right: 30px; width: 70px; height: 70px; background: linear-gradient(135deg, #7c3aed 0%, #06b6d4 100%); border: none; border-radius: 50%; color: white; font-size: 1.8em; cursor: pointer; z-index: 200; box-shadow: 0 8px 25px rgba(124, 58, 237, 0.4); transition: all 0.3s; }
        .ai-chat-toggle:hover { transform: scale(1.1); }
        .ai-chat-toggle.hidden { opacity: 0; pointer-events: none; }
        .ai-chat-widget { position: fixed; bottom: 120px; right: 30px; width: 420px; max-height: 600px; background: rgba(30, 30, 60, 0.98); border: 2px solid #00d4ff; border-radius: 15px; display: flex; flex-direction: column; z-index: 199; box-shadow: 0 12px 40px rgba(0, 0, 0, 0.5); transform: scale(0.8); opacity: 0; pointer-events: none; transition: all 0.3s; }
        .ai-chat-widget.active { transform: scale(1); opacity: 1; pointer-events: all; }
        .ai-chat-header { background: linear-gradient(135deg, #7c3aed 0%, #06b6d4 100%); color: white; padding: 1.2rem; border-radius: 13px 13px 0 0; font-weight: 700; display: flex; justify-content: space-between; align-items: center; }
        .ai-messages { flex: 1; overflow-y: auto; padding: 1.2rem; display: flex; flex-direction: column; gap: 1rem; min-height: 300px; max-height: 400px; }
        .message { padding: 0.9rem 1.2rem; border-radius: 10px; max-width: 90%; word-wrap: break-word; font-size: 0.9em; line-height: 1.6; }
        .message.user { align-self: flex-end; background: linear-gradient(135deg, #7c3aed 0%, #06b6d4 100%); color: white; }
        .message.ai { align-self: flex-start; background: rgba(0, 212, 255, 0.15); color: #d1fae5; border: 1px solid #00d4ff; }
        .ai-input { display: flex; gap: 0.8rem; padding: 1.2rem; border-top: 1px solid #444; }
        .ai-input input { flex: 1; background: rgba(20, 20, 50, 0.8); border: 1px solid #444; color: white; padding: 0.8rem; border-radius: 8px; outline: none; }
        .ai-input button { background: linear-gradient(135deg, #7c3aed 0%, #06b6d4 100%); border: none; color: white; padding: 0.8rem 1.5rem; border-radius: 8px; cursor: pointer; font-weight: 700; }

        .stock-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 1.5rem; }
        .stock-card { background: linear-gradient(145deg, #1a1a40 0%, #242850 100%); border: 2px solid #333; border-radius: 15px; padding: 1.5rem; cursor: pointer; transition: all 0.3s; }
        .stock-card:hover { border-color: #00d4ff; transform: translateY(-5px); }

        .story-section { margin-bottom: 3rem; padding: 2rem; background: rgba(0, 212, 255, 0.05); border: 2px solid #00d4ff; border-radius: 15px; }
        .newsletter-table { width: 100%; border-collapse: collapse; margin: 1.5rem 0; }
        .newsletter-table th { background: rgba(124, 58, 237, 0.3); color: #00d4ff; padding: 1rem; text-align: left; font-weight: 700; border: 1px solid #444; }
        .newsletter-table td { padding: 0.8rem 1rem; border: 1px solid #444; color: #b0b8c1; cursor: pointer; }
        .newsletter-table tr:hover { background: rgba(0, 212, 255, 0.1); }

        .research-layout { display: grid; grid-template-columns: 280px 1fr; gap: 1.5rem; }
        .left-sidebar { display: flex; flex-direction: column; gap: 1.5rem; }
        .sidebar-card { background: rgba(26, 26, 64, 0.95); border: 2px solid #444; border-radius: 15px; padding: 1.5rem; }
        .sidebar-card h3 { color: #00d4ff; margin-bottom: 1rem; font-size: 1.1em; }
        .sidebar-content { color: #b0b8c1; line-height: 1.8; font-size: 0.9em; }
        .price-banner { background: linear-gradient(135deg, #7c3aed 0%, #06b6d4 100%); border-radius: 12px; padding: 1.5rem; margin-bottom: 1rem; }
        .price-ticker { font-size: 1.8em; font-weight: 900; color: white; }
        .price-value { font-size: 2em; color: #00d4ff; font-weight: 900; margin: 0.5rem 0; }
        .price-story { font-style: italic; color: rgba(255, 255, 255, 0.9); font-size: 0.9em; }
        .metric-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 0.8rem; margin-top: 1rem; }
        .metric-box { background: rgba(0, 212, 255, 0.1); border: 1px solid #444; padding: 0.8rem; border-radius: 8px; text-align: center; }
        .metric-label { font-size: 0.75em; color: #b0b8c1; }
        .metric-value { font-size: 1.2em; color: #00d4ff; font-weight: 700; margin-top: 0.3rem; }
        .greeks-table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
        .greeks-table th { background: rgba(124, 58, 237, 0.2); color: #00d4ff; padding: 0.6rem; font-size: 0.8em; border: 1px solid #444; }
        .greeks-table td { padding: 0.6rem; font-size: 0.85em; text-align: center; border: 1px solid #444; color: #b0b8c1; }

        .main-content { display: flex; flex-direction: column; gap: 1.5rem; }
        .chart-card { background: rgba(26, 26, 64, 0.9); border: 2px solid #444; border-radius: 15px; padding: 1.5rem; }
        .chart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .chart-header h3 { color: #00d4ff; font-size: 1.2em; }
        .timeframe-buttons { display: flex; gap: 0.5rem; }
        .timeframe-btn { background: rgba(0, 212, 255, 0.1); border: 1px solid #444; color: #b0b8c1; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer; font-size: 0.85em; font-weight: 600; transition: all 0.3s; }
        .timeframe-btn:hover { border-color: #00d4ff; color: #00d4ff; }
        .timeframe-btn.active { background: linear-gradient(135deg, #7c3aed 0%, #06b6d4 100%); border-color: #00d4ff; color: white; }
        .chart-box { height: 500px; width: 100%; }

        .info-boxes { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
        .info-box { background: rgba(26, 26, 64, 0.9); border: 2px solid #444; border-radius: 15px; padding: 1.5rem; }
        .info-box h3 { color: #00d4ff; margin-bottom: 1rem; font-size: 1.2em; }
        .info-content { color: #b0b8c1; line-height: 1.8; }
        .ai-deep-section { background: rgba(26, 26, 64, 0.9); border: 2px solid #00d4ff; border-radius: 15px; padding: 2rem; }
        .ai-deep-section h2 { color: #00d4ff; font-size: 1.8em; margin-bottom: 1rem; }
        .ai-deep-content { color: #d1fae5; line-height: 1.8; font-size: 1em; }

        .ticker-cell { font-weight: 700; color: white; font-size: 1.1em; }

        /* Loading Spinner - Step 3 */
        .loading-spinner {
            border: 4px solid #1e293b;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            animation: spin 0.8s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 1200px) {
            .research-layout { grid-template-columns: 1fr; }
            .info-boxes { grid-template-columns: 1fr; }
            .ai-chat-widget { width: calc(100% - 20px); right: 10px; left: 10px; }
            .timeframe-buttons { flex-wrap: wrap; }
            .top-plays-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo" onclick="goHome()">üìä Elite Trading</div>
        <div class="search-bar">
            <i class="fas fa-search"></i>
            <input type="text" id="searchInput" placeholder="Search ticker..." onkeypress="if(event.key=='Enter') searchStock()">
            <button onclick="searchStock()">ANALYZE</button>
        </div>
    </div>

    <button class="ai-chat-toggle" onclick="toggleAIChat()" id="aiChatToggle"><i class="fas fa-robot"></i></button>
    <div class="ai-chat-widget" id="aiChatWidget">
        <div class="ai-chat-header">
            <span>ü§ñ Trading AI</span>
            <button onclick="toggleAIChat()" style="background: none; border: none; color: white; font-size: 1.2em; cursor: pointer;">‚úï</button>
        </div>
        <div class="ai-messages" id="aiMessages">
            <div class="message ai">Ask about stocks, strategies, or market conditions.</div>
        </div>
        <div class="ai-input">
            <input type="text" id="aiInput" placeholder="Ask AI..." onkeypress="if(event.key=='Enter') sendAIMessage()">
            <button onclick="sendAIMessage()">Send</button>
        </div>
    </div>

    <!-- HOME PAGE -->
    <div id="homePage" class="page active">
        <div class="container">
            <div style="background: linear-gradient(135deg, #7c3aed 0%, #06b6d4 100%); border-radius: 20px; padding: 3rem 2rem; text-align: center; margin-bottom: 2rem;">
                <h1 style="font-size: 2.8em; font-weight: 900;">Elite Trading Analytics</h1>
                <p style="font-size: 1.1em;">57 Stocks ¬∑ Live Prices ¬∑ AI Analysis</p>
            </div>

            <div class="action-buttons">
                <button class="btn-large btn-refresh" onclick="loadAllStocks()"><i class="fas fa-sync"></i> LOAD 57 STOCKS</button>
                <button class="btn-large btn-brief" onclick="showBrief()"><i class="fas fa-bolt"></i> MARKET BRIEF</button>
                <button class="btn-large btn-newsletter" onclick="showNewsletter()"><i class="fas fa-newspaper"></i> NEWSLETTER SCREENER</button>
            </div>

            <div class="top-plays-section">
                <h2 style="color: #00d4ff; font-size: 1.8em;"><i class="fas fa-star"></i> Top 3 High-Conviction Plays</h2>
                <div class="top-plays-grid" id="topPlays">Loading...</div>
            </div>

            <!-- Loading State -->
            <div id="loadingState" style="display: none; text-align: center; padding: 80px 20px;">
                <div class="loading-spinner"></div>
                <h3 style="color: #e2e8f0; margin-top: 24px; font-size: 20px;">Loading Market Analysis...</h3>
                <p style="color: #94a3b8; margin-top: 8px;">Fetching latest 110-signal recommendations</p>
            </div>

            <!-- Error State -->
            <div id="errorState" style="display: none; text-align: center; padding: 80px 20px;">
                <div style="font-size: 64px; margin-bottom: 20px;">‚ö†Ô∏è</div>
                <h3 style="color: #ef4444; margin-bottom: 12px; font-size: 20px;">Unable to Load Data</h3>
                <p style="color: #94a3b8; margin-bottom: 24px; font-size: 14px;" id="errorMessage">Connection error</p>
                <button onclick="retryLoad()" style="background: #3b82f6; color: white; border: none; padding: 12px 28px; border-radius: 8px; cursor: pointer; font-size: 15px; font-weight: 600; transition: all 0.2s;">
                    üîÑ Retry
                </button>
            </div>

            <!-- Stock Grid (existing) -->
            <div id="stockGrid" class="stock-grid">
                <!-- Stocks will load here -->
            </div>

        </div>
    </div>

    <!-- (All other pages remain the same - Brief, Newsletter, Research) -->
    
    <script>
    // ============================================
    // API CONFIGURATION - Step 1
    // ============================================
    const API_CONFIG = {
        baseUrl: 'https://elite-trading-with-exclusive-ip.onrender.com',
        endpoints: {
            recommendations: '/api/recommendations',
            triggerScan: '/api/trigger-scan'
        },
        refreshInterval: 5 * 60 * 1000,
        fallbackToLocal: true
    };

    function testAPIConfig() {
        console.log('‚úÖ API Config loaded:', API_CONFIG);
        console.log('üîó Recommendations endpoint:', API_CONFIG.baseUrl + API_CONFIG.endpoints.recommendations);
        return API_CONFIG;
    }
    // ============================================
    // END API CONFIGURATION
    // ============================================

    // ============================================
    // API SERVICE FUNCTIONS - Step 2
    // ============================================
    const TradingAPI = {
        async getRecommendations() {
            console.log('üîÑ Fetching recommendations from API...');
            
            try {
                const url = API_CONFIG.baseUrl + API_CONFIG.endpoints.recommendations;
                console.log('üì° Calling:', url);
                
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('‚úÖ Received', data.length, 'stocks from API');
                
                return {
                    success: true,
                    data: data,
                    timestamp: new Date().toISOString()
                };
            } catch (error) {
                console.error('‚ùå API Error:', error);
                
                if (API_CONFIG.fallbackToLocal) {
                    console.log('‚ö†Ô∏è Using local data as fallback');
                    return {
                        success: false,
                        error: error.message,
                        data: allStocks,
                        usingFallback: true
                    };
                }
                
                return {
                    success: false,
                    error: error.message,
                    data: []
                };
            }
        },

        async testConnection() {
            console.log('üß™ Testing API connection...');
            const result = await this.getRecommendations();
            
            if (result.success) {
                console.log('‚úÖ API connection successful!');
                console.log('üìä Sample stock:', result.data[0]);
            } else if (result.usingFallback) {
                console.log('‚ö†Ô∏è API unavailable, using fallback data');
            } else {
                console.log('‚ùå API connection failed:', result.error);
            }
            
            return result;
        }
    };

    function testAPIService() {
        console.log('üß™ Testing API Service...');
        return TradingAPI.testConnection();
    }
    // ============================================
    // END API SERVICE FUNCTIONS
    // ============================================

    // ============================================
    // UI STATE MANAGEMENT - Step 3
    // ============================================
    function showLoadingState() {
        document.getElementById('loadingState').style.display = 'block';
        document.getElementById('errorState').style.display = 'none';
        document.getElementById('stockGrid').style.display = 'none';
    }

    function hideLoadingState() {
        document.getElementById('loadingState').style.display = 'none';
        document.getElementById('stockGrid').style.display = 'grid';
    }

    function showErrorState(message) {
        document.getElementById('loadingState').style.display = 'none';
        document.getElementById('errorState').style.display = 'block';
        document.getElementById('stockGrid').style.display = 'none';
        document.getElementById('errorMessage').textContent = message || 'Failed to load data';
    }

    function retryLoad() {
        console.log('üîÑ Retrying data load...');
        showLoadingState();
        setTimeout(() => {
            hideLoadingState();
        }, 1000);
    }

    function testLoadingState() {
        console.log('Testing loading state...');
        showLoadingState();
        setTimeout(() => {
            console.log('‚úÖ Loading state shown for 2 seconds');
            hideLoadingState();
        }, 2000);
    }

    function testErrorState() {
        console.log('Testing error state...');
        showErrorState('This is a test error message');
        setTimeout(() => {
            console.log('‚úÖ Error state shown for 3 seconds');
            hideLoadingState();
        }, 3000);
    }
    // ============================================
    // END UI STATE MANAGEMENT
    // ============================================

    let allStocks = [
        {Symbol:'NVDA',Last:'178.88',Change:'-0.97',RSIWilder:'70',RegimeDetection:'82',Inst33:'85',Signal:'STRONG BUY',Story:'The Setup'},
        {Symbol:'TSLA',Last:'342.80',Change:'-2.3',RSIWilder:'42',RegimeDetection:'50',Inst33:'60',Signal:'HOLD',Story:'The Fade'},
        {Symbol:'META',Last:'512.15',Change:'2.1',RSIWilder:'66',RegimeDetection:'75',Inst33:'80',Signal:'BUY',Story:'The Creep'},
        {Symbol:'AAPL',Last:'289.45',Change:'-1.15',RSIWilder:'52',RegimeDetection:'65',Inst33:'75',Signal:'HOLD',Story:'Quality Hold'},
        {Symbol:'MSFT',Last:'425.30',Change:'0.85',RSIWilder:'58',RegimeDetection:'70',Inst33:'72',Signal:'BUY',Story:'Steady Growth'},
        {Symbol:'GOOGL',Last:'178.50',Change:'-0.9',RSIWilder:'48',RegimeDetection:'55',Inst33:'68',Signal:'HOLD',Story:'Consolidation'},
        {Symbol:'AMZN',Last:'195.20',Change:'1.2',RSIWilder:'62',RegimeDetection:'72',Inst33:'70',Signal:'BUY',Story:'Cloud Strength'},
        {Symbol:'AMD',Last:'142.35',Change:'4.2',RSIWilder:'68',RegimeDetection:'78',Inst33:'65',Signal:'STRONG BUY',Story:'Breakout Play'}
    ];

    // (Rest of your JavaScript functions remain the same)
    function loadAllStocks() {
        // ... your existing loadAllStocks function ...
    }
    
    // ... all other existing functions ...
    
    window.addEventListener('load', loadAllStocks);
    </script>
</body>
</html>
