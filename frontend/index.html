<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Elite Trading Analytics - 57 Stocks</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <script src="https://s3.tradingview.com/tv.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: linear-gradient(135deg, #1a1a3e 0%, #16213e 50%, #0f3460 100%);
      color: #ffffff;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      min-height: 100vh;
    }

    .header {
      background: rgba(20, 20, 50, 0.95);
      backdrop-filter: blur(10px);
      border-bottom: 2px solid #00d4ff;
      padding: 1.2rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
    }

    .logo {
      font-size: 1.8em;
      font-weight: 900;
      background: linear-gradient(135deg, #00d4ff 0%, #7c3aed 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      cursor: pointer;
    }

    .search-bar {
      flex: 1;
      max-width: 500px;
      margin: 0 2rem;
      display: flex;
      align-items: center;
      background: rgba(30, 30, 60, 0.8);
      border: 2px solid #444;
      border-radius: 10px;
      padding: 0.8rem 1rem;
      gap: 0.8rem;
    }

    .search-bar input {
      flex: 1;
      background: transparent;
      border: none;
      color: #fff;
      outline: none;
      font-size: 1em;
    }

    .search-bar button {
      background: linear-gradient(135deg, #7c3aed 0%, #06b6d4 100%);
      border: none;
      color: white;
      padding: 0.7rem 1.5rem;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 700;
      transition: all 0.3s;
    }

    .search-bar button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(124, 58, 237, 0.4);
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem;
    }

    .btn-large {
      padding: 1rem 2rem;
      border: none;
      border-radius: 12px;
      font-size: 1.1em;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 0.8rem;
    }

    .btn-refresh {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
    }

    .btn-brief {
      background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);
      color: white;
    }

    .btn-large:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3);
    }

    .action-buttons {
      display: flex;
      gap: 1rem;
      justify-content: center;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }

    .filter-tabs {
      display: flex;
      gap: 1rem;
      justify-content: center;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }

    .filter-btn {
      padding: 0.8rem 1.5rem;
      background: rgba(70, 70, 120, 0.6);
      border: 2px solid #444;
      color: #b0b8c1;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
    }

    .filter-btn:hover {
      border-color: #00d4ff;
      color: #00d4ff;
    }

    .filter-btn.active {
      background: linear-gradient(135deg, #7c3aed 0%, #06b6d4 100%);
      color: white;
      border-color: transparent;
    }

    /* ============ NEWSLETTER PAGE STYLES ============ */
    .newsletter-page {
      display: none;
    }

    .newsletter-page.active {
      display: block;
    }

    .newsletter-header {
      text-align: center;
      margin-bottom: 3rem;
      border-bottom: 3px solid #00d4ff;
      padding-bottom: 2rem;
    }

    .newsletter-header h1 {
      font-size: 2.5em;
      color: #00d4ff;
      margin-bottom: 0.5rem;
    }

    .newsletter-section {
      margin-bottom: 3rem;
      padding: 2rem;
      background: rgba(0, 212, 255, 0.05);
      border-left: 4px solid #10b981;
      border-radius: 10px;
    }

    .newsletter-section h2 {
      color: #10b981;
      font-size: 1.8em;
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .newsletter-table {
      width: 100%;
      border-collapse: collapse;
      margin: 1.5rem 0;
      font-size: 0.9em;
    }

    .newsletter-table th {
      background: rgba(124, 58, 237, 0.3);
      color: #00d4ff;
      padding: 1rem;
      text-align: left;
      font-weight: 700;
      border: 1px solid #444;
    }

    .newsletter-table td {
      padding: 0.8rem 1rem;
      border: 1px solid #444;
      color: #b0b8c1;
    }

    .newsletter-table tr:hover {
      background: rgba(0, 212, 255, 0.1);
    }

    .stock-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.5rem;
      margin-bottom: 3rem;
    }

    .stock-card {
      background: linear-gradient(145deg, #1a1a40 0%, #242850 100%);
      border: 2px solid #333;
      border-radius: 15px;
      padding: 1.5rem;
      cursor: pointer;
      transition: all 0.3s;
    }

    .stock-card:hover {
      border-color: #00d4ff;
      transform: translateY(-5px);
      box-shadow: 0 12px 40px rgba(0, 212, 255, 0.2);
    }

    .stock-symbol {
      font-size: 2.2em;
      font-weight: 900;
      color: white;
      margin-bottom: 0.5rem;
    }

    .stock-price {
      font-size: 1.8em;
      color: #00d4ff;
      font-weight: 900;
      margin-bottom: 0.3rem;
    }

    .stock-change {
      font-size: 1.1em;
      font-weight: 700;
      margin-bottom: 1rem;
    }

    .stock-change.positive {
      color: #10b981;
    }

    .stock-change.negative {
      color: #ef4444;
    }

    .signal-badge {
      display: inline-block;
      padding: 0.6rem 1.2rem;
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      border-radius: 8px;
      font-weight: 700;
      font-size: 0.85em;
      margin-bottom: 1rem;
    }

    .stock-metrics {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.8rem;
      font-size: 0.9em;
      margin: 1rem 0;
    }

    .metric {
      background: rgba(0, 212, 255, 0.1);
      padding: 0.8rem;
      border-radius: 8px;
      text-align: center;
    }

    .metric-label {
      font-size: 0.8em;
      color: #b0b8c1;
      text-transform: uppercase;
    }

    .metric-value {
      font-size: 1.2em;
      color: #00d4ff;
      font-weight: 700;
    }

    .edge-box {
      background: rgba(16, 185, 129, 0.1);
      border-left: 4px solid #10b981;
      padding: 1rem;
      border-radius: 8px;
      margin-top: 1rem;
      font-size: 0.85em;
      line-height: 1.6;
      color: #d1fae5;
    }

    .edge-title {
      font-weight: 700;
      color: #10b981;
      margin-bottom: 0.5rem;
    }

    /* RESEARCH PAGE */
    .research-page {
      display: none;
    }

    .research-page.active {
      display: block;
    }

    .research-header {
      background: linear-gradient(135deg, #7c3aed 0%, #06b6d4 100%);
      border-radius: 15px;
      padding: 2rem;
      margin-bottom: 2rem;
    }

    .research-title {
      font-size: 3.5em;
      font-weight: 900;
    }

    .research-analysis {
      background: rgba(255, 255, 255, 0.1);
      padding: 1.5rem;
      border-radius: 10px;
      margin-top: 1rem;
      line-height: 1.8;
    }

    .charts-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .chart-box {
      background: rgba(30, 30, 60, 0.8);
      border: 2px solid #444;
      border-radius: 15px;
      padding: 1.5rem;
      min-height: 450px;
    }

    .chart-box h3 {
      color: #00d4ff;
      margin-bottom: 1rem;
      font-size: 1.3em;
    }

    .chart-container {
      width: 100%;
      height: 400px;
      background: rgba(20, 20, 50, 0.5);
      border-radius: 10px;
      overflow: hidden;
    }

    .commentary-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
      margin: 2rem 0;
    }

    .commentary-box {
      background: rgba(30, 30, 60, 0.8);
      border: 2px solid #444;
      border-radius: 15px;
      padding: 1.5rem;
    }

    .commentary-box h3 {
      color: #06b6d4;
      margin-bottom: 1rem;
      font-size: 1.2em;
    }

    .commentary-text {
      color: #b0b8c1;
      line-height: 1.8;
      font-size: 0.95em;
    }

    /* AI CHAT */
    .ai-chat-widget {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 400px;
      max-height: 600px;
      background: rgba(30, 30, 60, 0.95);
      border: 2px solid #00d4ff;
      border-radius: 15px;
      display: flex;
      flex-direction: column;
      z-index: 150;
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.5);
      transform: translateY(calc(100% + 20px));
      opacity: 0;
      transition: all 0.3s;
      pointer-events: none;
    }

    .ai-chat-widget.active {
      transform: translateY(0);
      opacity: 1;
      pointer-events: all;
    }

    .ai-chat-header {
      background: linear-gradient(135deg, #7c3aed 0%, #06b6d4 100%);
      color: white;
      padding: 1.2rem;
      border-radius: 13px 13px 0 0;
      font-weight: 700;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .ai-messages {
      flex: 1;
      overflow-y: auto;
      padding: 1.2rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .message {
      padding: 0.9rem 1.2rem;
      border-radius: 10px;
      max-width: 90%;
      word-wrap: break-word;
      font-size: 0.9em;
      line-height: 1.6;
    }

    .message.user {
      align-self: flex-end;
      background: linear-gradient(135deg, #7c3aed 0%, #06b6d4 100%);
      color: white;
    }

    .message.ai {
      align-self: flex-start;
      background: rgba(0, 212, 255, 0.15);
      color: #b0b8c1;
      border: 1px solid #00d4ff;
    }

    .ai-input {
      display: flex;
      gap: 0.8rem;
      padding: 1.2rem;
      border-top: 1px solid #444;
    }

    .ai-input input {
      flex: 1;
      background: rgba(20, 20, 50, 0.8);
      border: 1px solid #444;
      color: white;
      padding: 0.8rem;
      border-radius: 8px;
      outline: none;
    }

    .ai-input button {
      background: linear-gradient(135deg, #7c3aed 0%, #06b6d4 100%);
      border: none;
      color: white;
      padding: 0.8rem 1.5rem;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 700;
    }

    .ai-toggle {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 70px;
      height: 70px;
      background: linear-gradient(135deg, #7c3aed 0%, #06b6d4 100%);
      border: none;
      border-radius: 50%;
      color: white;
      font-size: 1.8em;
      cursor: pointer;
      z-index: 140;
      box-shadow: 0 8px 25px rgba(124, 58, 237, 0.4);
      transition: all 0.3s;
    }

    .ai-toggle:hover {
      transform: scale(1.1);
    }

    .ai-toggle.hidden {
      opacity: 0;
      pointer-events: none;
    }

    .loading {
      text-align: center;
      padding: 2rem;
      color: #00d4ff;
    }

    @media (max-width: 1024px) {
      .charts-grid {
        grid-template-columns: 1fr;
      }

      .commentary-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .ai-chat-widget {
        width: calc(100% - 20px);
        right: 10px;
        left: 10px;
        max-width: none;
      }
    }
  </style>
</head>

<body>
  <div class="header">
    <div class="logo" onclick="goHome()">üìä Elite Trading Analytics</div>
    <div class="search-bar">
      <i class="fas fa-search"></i>
      <input type="text" id="searchInput" placeholder="Search ticker..." onkeypress="if(event.key==='Enter') searchAndResearch()">
      <button onclick="searchAndResearch()">ANALYZE</button>
    </div>
    <button style="background: none; border: none; color: #00d4ff; font-size: 1.5em; cursor: pointer;" onclick="toggleAI()">
      <i class="fas fa-comments"></i>
    </button>
  </div>

  <!-- HOME PAGE -->
  <div id="homePage">
    <div class="container">
      <div style="background: linear-gradient(135deg, #7c3aed 0%, #06b6d4 100%); border-radius: 20px; padding: 3rem 2rem; text-align: center; margin-bottom: 2rem; box-shadow: 0 12px 40px rgba(124, 58, 237, 0.3);">
        <h1 style="font-size: 2.8em; font-weight: 900; margin-bottom: 0.5rem;">Elite Trading Analytics</h1>
        <p style="font-size: 1.1em; opacity: 0.95;">57 Institutional-Grade Stock Recommendations</p>
      </div>

      <div class="action-buttons">
        <button class="btn-large btn-refresh" onclick="loadAllStocks()">
          <i class="fas fa-sync"></i> REFRESH ALL 57
        </button>
        <button class="btn-large btn-brief" onclick="showNewsletter()">
          <i class="fas fa-newspaper"></i> MARKET BRIEF
        </button>
      </div>

      <div class="filter-tabs">
        <button class="filter-btn active" onclick="filterStocks('all')">All (57)</button>
        <button class="filter-btn" onclick="filterStocks('value')">Value Plays</button>
        <button class="filter-btn" onclick="filterStocks('momentum')">Momentum</button>
        <button class="filter-btn" onclick="filterStocks('institutional')">High Inst Score</button>
      </div>

      <div class="loading" id="loadingIndicator">üìä Loading your stocks from CSV...</div>
      <div class="stock-grid" id="stockGrid"></div>
    </div>
  </div>

  <!-- NEWSLETTER PAGE -->
  <div id="newsletterPage" class="newsletter-page">
    <div class="container">
      <div class="newsletter-header">
        <h1>üì∞ Comprehensive Financial Analysis</h1>
        <p>Value Screening & Momentum Analysis with Institutional Scoring</p>
        <p style="font-size: 0.9em; margin-top: 1rem; color: #10b981;">Powered by Your Proprietary Trading Scripts (Results Only - Scripts Remain Private)</p>
      </div>

      <!-- VALUE SCREENING -->
      <div class="newsletter-section">
        <h2><i class="fas fa-chart-line"></i> VALUE SCREENING ANALYSIS</h2>
        <p style="margin-bottom: 1rem; color: #b0b8c1;">12+ Large-Cap Stocks Near 52-Week Lows with Favorable P/E Ratios</p>
        <table class="newsletter-table">
          <thead>
            <tr>
              <th>Ticker</th>
              <th>Company</th>
              <th>Price</th>
              <th>52W Low</th>
              <th>% to Low</th>
              <th>P/E</th>
              <th>Market Cap</th>
              <th>Quality</th>
            </tr>
          </thead>
          <tbody id="valueTableBody">
            <tr><td colspan="8" class="loading">Loading value analysis...</td></tr>
          </tbody>
        </table>
      </div>

      <!-- MOMENTUM ANALYSIS -->
      <div class="newsletter-section">
        <h2><i class="fas fa-rocket"></i> MOMENTUM ANALYSIS - TOP 10 PERFORMERS</h2>
        <p style="margin-bottom: 1rem; color: #b0b8c1;">5 Trading Days Performance with Institutional Scoring</p>
        <table class="newsletter-table">
          <thead>
            <tr>
              <th>Ticker</th>
              <th>Company</th>
              <th>YTD Return</th>
              <th>5-Day Perf</th>
              <th>RSI</th>
              <th>Sector</th>
              <th>Inst Score</th>
            </tr>
          </thead>
          <tbody id="momentumTableBody">
            <tr><td colspan="7" class="loading">Loading momentum analysis...</td></tr>
          </tbody>
        </table>
      </div>

      <button class="btn-large" onclick="goHome()" style="width: 100%; margin: 2rem 0; background: #10b981;">
        ‚Üê BACK TO WATCHLIST
      </button>
    </div>
  </div>

  <!-- RESEARCH PAGE -->
  <div id="researchPage" class="research-page">
    <div class="container">
      <div class="research-header">
        <div class="research-title" id="researchSymbol">TICKER</div>
        <div class="research-analysis" id="stockAnalysis">Loading AI analysis...</div>
      </div>

      <div class="charts-grid">
        <div class="chart-box">
          <h3>üìä 1D Chart</h3>
          <div class="chart-container" id="chart1D"></div>
        </div>
        <div class="chart-box">
          <h3>üìà 1W Chart</h3>
          <div class="chart-container" id="chart1W"></div>
        </div>
      </div>

      <div class="commentary-grid">
        <div class="commentary-box">
          <h3><i class="fas fa-lightbulb"></i> Technical Setup</h3>
          <div class="commentary-text" id="technicalComment">Loading...</div>
        </div>
        <div class="commentary-box">
          <h3><i class="fas fa-target"></i> Entry & Targets</h3>
          <div class="commentary-text" id="entryTargets">Loading...</div>
        </div>
      </div>

      <div class="commentary-box">
        <h3><i class="fas fa-brain"></i> AI Deep Analysis</h3>
        <div class="commentary-text" id="aiAnalysis">Loading...</div>
      </div>

      <button class="btn-large" onclick="goHome()" style="width: 100%; margin: 2rem 0; background: #10b981;">
        ‚Üê BACK TO DASHBOARD
      </button>
    </div>
  </div>

  <!-- AI CHAT -->
  <button class="ai-toggle" id="aiToggle" onclick="toggleAI()">
    <i class="fas fa-comments"></i>
  </button>

  <div class="ai-chat-widget" id="aiChatWidget">
    <div class="ai-chat-header">
      <span><i class="fas fa-robot"></i> Trading AI</span>
      <button style="background: none; border: none; color: white; font-size: 1.4em; cursor: pointer;" onclick="toggleAI()">‚àí</button>
    </div>
    <div class="ai-messages" id="aiMessages"></div>
    <div class="ai-input">
      <input type="text" id="aiInput" placeholder="Ask AI..." onkeypress="if(event.key==='Enter') sendAI()">
      <button onclick="sendAI()"><i class="fas fa-paper-plane"></i></button>
    </div>
  </div>

  <script>
    const BACKEND_URL = 'https://elite-trading-with-exclusive-ip.onrender.com';
    
    // STOCK DATA FROM YOUR CSVS
    let allStocks = [];

    window.addEventListener('load', async () => {
      await loadStocksFromCSV();
    });

    // ============ LOAD STOCKS FROM CSV ============
    async function loadStocksFromCSV() {
      try {
        // Fetch your CSV files from Netlify public folder
        const csvFiles = [
          '2025-11-20-watchlist.csv',
          '2025-11-20-watchlist-Priority.csv',
          '2025-11-20-watchlist-GN1.csv',
          '2025-11-20-watchlist-GN2.csv'
        ];

        for (let csvFile of csvFiles) {
          try {
            const res = await fetch(`/${csvFile}`);
            if (res.ok) {
              const csv = await res.text();
              const rows = parseCSV(csv);
              allStocks.push(...rows);
            }
          } catch (e) {
            console.log(`CSV ${csvFile} not found (optional)`);
          }
        }

        if (allStocks.length === 0) {
          // Fallback: use hardcoded watchlist
          allStocks = generateFallbackWatchlist();
        }

        document.getElementById('loadingIndicator').style.display = 'none';
        renderStocks('all');
        populateNewsletterTables();
      } catch (e) {
        console.error('Error loading stocks:', e);
        allStocks = generateFallbackWatchlist();
        document.getElementById('loadingIndicator').style.display = 'none';
        renderStocks('all');
      }
    }

    function parseCSV(csv) {
      const lines = csv.trim().split('\n');
      const headers = lines[0].split(',').map(h => h.trim());
      const rows = [];

      for (let i = 1; i < lines.length; i++) {
        const values = lines[i].split(',').map(v => v.trim());
        if (values[0]) {
          const row = {};
          headers.forEach((header, idx) => {
            row[header] = values[idx] || '';
          });
          rows.push(row);
        }
      }
      return rows;
    }

    function generateFallbackWatchlist() {
      return [
        {Symbol:'MU','Last':201.37,Change:-10.87,'mean revision':-2.47,RSIWIlder:41.24,'Regime Detection':75.6,'Inst 33':53,Signal:'STRONG BUY'},
        {Symbol:'SE','Last':130.99,Change:-8.74,'mean revision':-2.46,RSIWIlder:27.72,'Regime Detection':51.7,'Inst 33':38,Signal:'ACCUMULATE'},
        {Symbol:'RIVN','Last':14.66,Change:-0.41,'mean revision':-1.75,RSIWIlder:58.91,'Regime Detection':99.1,'Inst 33':65,Signal:'BUY'},
        {Symbol:'EA','Last':201.12,Change:-0.23,'mean revision':-1.74,RSIWIlder:46.82,'Regime Detection':64.7,'Inst 33':53,Signal:'MONITOR'},
        {Symbol:'LULU','Last':164.69,Change:-0.82,'mean revision':-1.49,RSIWIlder:49.1,'Regime Detection':28.2,'Inst 33':58,Signal:'MONITOR'},
        {Symbol:'TTWO','Last':216.23,Change:-2.84,'mean revision':-2.28,RSIWIlder:43.08,'Regime Detection':68.5,'Inst 33':58,Signal:'ACCUMULATE'},
        {Symbol:'MRVL','Last':76.68,Change:-5.71,'mean revision':-2.38,RSIWIlder:36.84,'Regime Detection':56.6,'Inst 33':28,Signal:'ACCUMULATE'},
        {Symbol:'HOOD','Last':79.82,Change:12.3,'mean revision':0.5,RSIWIlder:72,'Regime Detection':85,'Inst 33':78,Signal:'STRONG BUY'},
        {Symbol:'WDC','Last':220.5,Change:15.2,'mean revision':1.2,RSIWIlder:75,'Regime Detection':88,'Inst 33':75,Signal:'BUY'},
        {Symbol:'RKLB','Last':14.5,Change:18.5,'mean revision':1.8,RSIWIlder:78,'Regime Detection':92,'Inst 33':72,Signal:'BUY'},
        {Symbol:'PLTR','Last':155,Change:-9.52,'mean revision':-1.2,RSIWIlder:27.8,'Regime Detection':55,'Inst 33':58,Signal:'OVERSOLD'},
        {Symbol:'NEM','Last':66,Change:8.5,'mean revision':0.8,RSIWIlder:65,'Regime Detection':70,'Inst 33':70,Signal:'BUY'},
        {Symbol:'BAX','Last':17.42,Change:-2.1,'mean revision':-2.1,RSIWIlder:35,'Regime Detection':45,'Inst 33':42,Signal:'VALUE'},
        {Symbol:'ADBE','Last':318.11,Change:-2.7,'mean revision':-1.8,RSIWIlder:38,'Regime Detection':52,'Inst 33':62,Signal:'VALUE'},
        {Symbol:'CPRT','Last':70.15,Change:17.9,'mean revision':1.5,RSIWIlder:68,'Regime Detection':75,'Inst 33':70,Signal:'BUY'},
        {Symbol:'AAPL','Last':289.45,Change:-1.15,'mean revision':-0.5,RSIWIlder:52,'Regime Detection':60,'Inst 33':65,Signal:'HOLD'},
        {Symbol:'MSFT','Last':425.30,Change:0.85,'mean revision':0.3,RSIWIlder:58,'Regime Detection':65,'Inst 33':72,Signal:'BUY'},
        {Symbol:'NVDA','Last':485.22,Change:3.5,'mean revision':1.2,RSIWIlder:70,'Regime Detection':82,'Inst 33':85,Signal:'STRONG BUY'},
        {Symbol:'META','Last':512.15,Change:2.1,'mean revision':0.9,RSIWIlder:66,'Regime Detection':75,'Inst 33':80,Signal:'BUY'},
        {Symbol:'TSLA','Last':342.80,Change:-2.3,'mean revision':-1.1,RSIWIlder:42,'Regime Detection':50,'Inst 33':60,Signal:'HOLD'},
      ];
    }

    // ============ POPULATE NEWSLETTER TABLES ============
    function populateNewsletterTables() {
      const valueStocks = allStocks
        .filter(s => parseFloat(s.Change || 0) < -1.5)
        .sort((a, b) => parseFloat(a.Change) - parseFloat(b.Change))
        .slice(0, 12);

      const momentumStocks = allStocks
        .filter(s => parseFloat(s.Change || 0) > 5)
        .sort((a, b) => parseFloat(b.Change) - parseFloat(a.Change))
        .slice(0, 10);

      // VALUE TABLE
      document.getElementById('valueTableBody').innerHTML = valueStocks.map(s => `
        <tr>
          <td><strong>${s.Symbol || s['Symbol.1']}</strong></td>
          <td>${s['Company'] || 'N/A'}</td>
          <td>$${parseFloat(s['Last'] || s.Price || 0).toFixed(2)}</td>
          <td>${s['52W Low'] || 'N/A'}</td>
          <td>${s['% to Low'] || 'N/A'}</td>
          <td>${s['P/E'] || 'N/A'}</td>
          <td>${s['Market Cap'] || 'N/A'}</td>
          <td>${(parseFloat(s['Inst 33'] || 0) / 100).toFixed(1)}/10</td>
        </tr>
      `).join('') || '<tr><td colspan="8">No value stocks found</td></tr>';

      // MOMENTUM TABLE
      document.getElementById('momentumTableBody').innerHTML = momentumStocks.map(s => `
        <tr>
          <td><strong>${s.Symbol || s['Symbol.1']}</strong></td>
          <td>${s['Company'] || 'N/A'}</td>
          <td>${s['YTD Return'] || 'N/A'}</td>
          <td>${s.Change || 'N/A'}%</td>
          <td>${s.RSIWIlder || s['RSI'] || 'N/A'}</td>
          <td>${s['Sector'] || 'N/A'}</td>
          <td>${s['Inst 33'] || 'N/A'}</td>
        </tr>
      `).join('') || '<tr><td colspan="7">No momentum stocks found</td></tr>';
    }

    function renderStocks(filter) {
      const filtered = allStocks.filter(s => {
        const change = parseFloat(s.Change || 0);
        if (filter === 'value') return change < -1.5;
        if (filter === 'momentum') return change > 5;
        if (filter === 'institutional') return parseFloat(s['Inst 33'] || 0) > 65;
        return true;
      });

      const grid = document.getElementById('stockGrid');
      grid.innerHTML = filtered.slice(0, 57).map(s => {
        const symbol = s.Symbol || s['Symbol.1'];
        const price = parseFloat(s['Last'] || s.Price || 0);
        const change = parseFloat(s.Change || 0);
        const meanRev = parseFloat(s['mean revision'] || 0);
        const rsi = parseFloat(s.RSIWIlder || s['RSI'] || 0);
        const inst33 = parseFloat(s['Inst 33'] || 0);
        const regime = parseFloat(s['Regime Detection'] || 0);

        return `
          <div class="stock-card" onclick="researchStock('${symbol}')">
            <div class="stock-symbol">${symbol}</div>
            <div class="stock-price">$${price.toFixed(2)}</div>
            <div class="stock-change ${change >= 0 ? 'positive' : 'negative'}">
              ${change >= 0 ? '‚ñ≤' : '‚ñº'} ${Math.abs(change).toFixed(2)}%
            </div>
            <span class="signal-badge">${s.Signal || 'MONITOR'}</span>
            <div class="stock-metrics">
              <div class="metric">
                <div class="metric-label">Mean Rev</div>
                <div class="metric-value">${meanRev}</div>
              </div>
              <div class="metric">
                <div class="metric-label">RSI</div>
                <div class="metric-value">${rsi.toFixed(1)}</div>
              </div>
              <div class="metric">
                <div class="metric-label">Inst Score</div>
                <div class="metric-value">${inst33}</div>
              </div>
              <div class="metric">
                <div class="metric-label">Regime</div>
                <div class="metric-value">${regime}%</div>
              </div>
            </div>
            <div class="edge-box">
              <div class="edge-title">üìä Your Edge:</div>
              ‚Ä¢ Institutional Score: ${inst33}/100<br>
              ‚Ä¢ ${meanRev < -2 ? 'Extreme mean reversion' : 'Technical momentum'}<br>
              ‚Ä¢ ${inst33 > 70 ? 'Strong institutional flow' : 'Developing setup'}
            </div>
          </div>
        `;
      }).join('');
    }

    function filterStocks(type) {
      document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
      event.target.classList.add('active');
      renderStocks(type);
    }

    function goHome() {
      document.getElementById('homePage').style.display = 'block';
      document.getElementById('newsletterPage').classList.remove('active');
      document.getElementById('researchPage').classList.remove('active');
    }

    function showNewsletter() {
      document.getElementById('homePage').style.display = 'none';
      document.getElementById('newsletterPage').classList.add('active');
      document.getElementById('researchPage').classList.remove('active');
      populateNewsletterTables();
    }

    function loadAllStocks() {
      renderStocks('all');
    }

    async function researchStock(ticker) {
      document.getElementById('homePage').style.display = 'none';
      document.getElementById('newsletterPage').classList.remove('active');
      document.getElementById('researchPage').classList.add('active');

      let stock = allStocks.find(s => (s.Symbol || s['Symbol.1']) === ticker);
      if (!stock) stock = {Symbol: ticker, Last: 0, Change: 0};

      document.getElementById('researchSymbol').textContent = ticker;
      
      const analysisPrompt = `Brief 2-sentence stock analysis for ${ticker} at $${stock.Last}: current setup and key levels.`;
      const analysis = await callAI(analysisPrompt);
      document.getElementById('stockAnalysis').textContent = analysis;

      renderCharts(ticker);

      const technicalPrompt = `Technical analysis for ${ticker}. 2 sentences on setup.`;
      const tech = await callAI(technicalPrompt);
      document.getElementById('technicalComment').textContent = tech;

      document.getElementById('entryTargets').innerHTML = `
        <strong>ENTRY:</strong> $${parseFloat(stock.Last || 0).toFixed(2)}<br>
        <strong>T1 (5%):</strong> $${(parseFloat(stock.Last || 0) * 1.05).toFixed(2)}<br>
        <strong>T2 (10%):</strong> $${(parseFloat(stock.Last || 0) * 1.10).toFixed(2)}<br>
        <strong>STOP:</strong> $${(parseFloat(stock.Last || 0) * 0.95).toFixed(2)}
      `;

      const deepPrompt = `Comprehensive trading analysis for ${ticker} (5-7 sentences).`;
      const deep = await callAI(deepPrompt);
      document.getElementById('aiAnalysis').textContent = deep;

      toggleAI(true);
    }

    function renderCharts(ticker) {
      document.getElementById('chart1D').innerHTML = '';
      document.getElementById('chart1W').innerHTML = '';

      new TradingView.widget({
        "container_id": "chart1D",
        "width": "100%",
        "height": "100%",
        "symbol": ticker,
        "interval": "1",
        "timezone": "America/New_York",
        "theme": "dark",
        "style": "1",
        "studies": ["BB@tv-basicstudies", "MACD@tv-basicstudies", "RSI@tv-basicstudies", "Vol@tv-basicstudies"]
      });

      new TradingView.widget({
        "container_id": "chart1W",
        "width": "100%",
        "height": "100%",
        "symbol": ticker,
        "interval": "W",
        "timezone": "America/New_York",
        "theme": "dark",
        "style": "1",
        "studies": ["BB@tv-basicstudies", "MACD@tv-basicstudies", "RSI@tv-basicstudies"]
      });
    }

    async function callAI(prompt) {
      try {
        const res = await fetch(`${BACKEND_URL}/api/ai-analyze`, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({
            model: 'sonar',
            messages: [{role: 'user', content: prompt}],
            temperature: 0.3,
            max_tokens: 500
          })
        });
        if (!res.ok) return `AI Error: ${res.status}`;
        const data = await res.json();
        return data.choices?.[0]?.message?.content || 'No AI response';
      } catch (e) {
        return `AI Error: ${e.message}`;
      }
    }

    function toggleAI(force = null) {
      const widget = document.getElementById('aiChatWidget');
      const toggle = document.getElementById('aiToggle');
      
      if (force === true) {
        widget.classList.add('active');
        toggle.classList.add('hidden');
      } else if (force === false) {
        widget.classList.remove('active');
        toggle.classList.remove('hidden');
      } else {
        widget.classList.toggle('active');
        toggle.classList.toggle('hidden');
      }
    }

    async function sendAI() {
      const inp = document.getElementById('aiInput');
      const msg = inp.value.trim();
      if (!msg) return;

      const box = document.getElementById('aiMessages');
      box.innerHTML += `<div class="message user">${msg}</div>`;
      inp.value = '';
      box.scrollTop = box.scrollHeight;

      const resp = await callAI(msg);
      box.innerHTML += `<div class="message ai">${resp}</div>`;
      box.scrollTop = box.scrollHeight;
    }

    function searchAndResearch() {
      const ticker = document.getElementById('searchInput').value.toUpperCase().trim();
      if (ticker) {
        researchStock(ticker);
        document.getElementById('searchInput').value = '';
      }
    }
  </script>
</body>
</html>


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elite Trading Analytics - Production</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            min-height: 100vh;
            color: #e0e0e0;
        }

        .top-nav {
            background: rgba(0,0,0,0.3);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-logo {
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
        }

        .nav-logo-text {
            font-size: 1.5em;
            font-weight: 700;
            color: #667eea;
        }

        .nav-actions {
            display: flex;
            gap: 20px;
        }

        .nav-btn {
            padding: 10px 20px;
            background: rgba(102, 126, 234, 0.2);
            border: 1px solid #667eea;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .nav-btn:hover {
            background: rgba(102, 126, 234, 0.4);
        }

        .ai-chat-bar {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1500;
        }

        .chat-toggle-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            border: none;
            color: white;
            font-size: 1.8em;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.5);
            transition: all 0.3s;
            position: relative;
        }

        .chat-toggle-btn:hover {
            transform: scale(1.1);
        }

        .ai-pulse {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 20px;
            height: 20px;
            background: #10b981;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }

        .chat-panel {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 400px;
            max-height: 600px;
            background: linear-gradient(145deg, #2d2d44 0%, #1f1f2e 100%);
            border-radius: 20px;
            border: 2px solid #8b5cf6;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            display: none;
            flex-direction: column;
        }

        .chat-panel.active {
            display: flex;
        }

        .chat-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-title {
            font-size: 1.3em;
            font-weight: 700;
            color: #8b5cf6;
        }

        .chat-close {
            background: none;
            border: none;
            color: #aaa;
            font-size: 1.5em;
            cursor: pointer;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            max-height: 400px;
        }

        .chat-message {
            margin-bottom: 15px;
            padding: 12px;
            border-radius: 10px;
            line-height: 1.6;
            font-size: 0.9em;
        }

        .chat-message.user {
            background: rgba(102, 126, 234, 0.2);
            margin-left: 20px;
        }

        .chat-message.ai {
            background: rgba(139, 92, 246, 0.2);
            margin-right: 20px;
        }

        .chat-input-area {
            padding: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 12px;
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 10px;
            color: white;
            outline: none;
        }

        .chat-send-btn {
            padding: 12px 20px;
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            border: none;
            border-radius: 10px;
            color: white;
            font-weight: 700;
            cursor: pointer;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
        }

        .market-story-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px 20px;
            text-align: center;
            color: white;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .story-title {
            font-size: 2.8em;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .story-narrative {
            font-size: 1.2em;
            line-height: 1.6;
            padding: 20px;
        }

        .api-status {
            font-size: 0.9em;
            color: rgba(255,255,255,0.7);
            margin-top: 15px;
        }

        .proprietary-badge {
            display: inline-block;
            background: rgba(16, 185, 129, 0.2);
            padding: 8px 20px;
            border-radius: 20px;
            border: 2px solid #10b981;
            color: #10b981;
            font-weight: 700;
            margin: 10px 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .proprietary-badge:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3);
        }

        .search-section {
            max-width: 900px;
            margin: 30px auto;
        }

        .search-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .search-input {
            flex: 1;
            min-width: 250px;
            padding: 20px 28px;
            font-size: 1.3em;
            background: rgba(255,255,255,0.12);
            border: 2px solid rgba(255,255,255,0.25);
            border-radius: 15px;
            color: white;
            outline: none;
        }

        .analyze-btn {
            padding: 20px 45px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 15px;
            color: white;
            font-size: 1.3em;
            font-weight: 700;
            cursor: pointer;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 16px 32px;
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: 700;
            cursor: pointer;
            font-size: 1.05em;
            transition: all 0.3s;
        }

        .btn-scanner {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .btn-brief {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .btn-ai {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        }

        .filter-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 20px 0;
            justify-content: center;
        }

        .filter-btn {
            padding: 10px 20px;
            border-radius: 20px;
            border: 2px solid #667eea;
            background: transparent;
            color: #667eea;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .filter-btn:hover {
            background: rgba(102, 126, 234, 0.2);
        }

        .filter-btn.active {
            background: #667eea;
            color: white;
        }

        .plays-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .play-card {
            background: linear-gradient(145deg, #2d2d44 0%, #1f1f2e 100%);
            border-radius: 20px;
            padding: 30px;
            cursor: pointer;
            border: 2px solid transparent;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            transition: all 0.3s;
        }

        .play-card:hover {
            transform: translateY(-5px);
            border-color: #667eea;
        }

        .play-ticker {
            font-size: 2.2em;
            font-weight: 700;
            color: #fff;
            margin-bottom: 10px;
        }

        .signal-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 0.9em;
            margin: 5px 5px 15px 0;
        }

        .signal-strong-buy {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .signal-accumulate {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .play-metrics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 15px 0;
        }

        .play-metric {
            background: rgba(102, 126, 234, 0.12);
            padding: 12px;
            border-radius: 10px;
        }

        .metric-label {
            font-size: 0.85em;
            color: #999;
            text-transform: uppercase;
        }

        .metric-value {
            font-size: 1.3em;
            font-weight: 700;
            color: #fff;
            margin-top: 5px;
        }

        .proprietary-insight {
            background: rgba(16, 185, 129, 0.15);
            border-left: 4px solid #10b981;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 0.9em;
            line-height: 1.5;
        }

        .ai-insight-box {
            background: rgba(139, 92, 246, 0.15);
            border-left: 4px solid #8b5cf6;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            line-height: 1.8;
        }

        .newsletter-section {
            background: linear-gradient(145deg, #2d2d44 0%, #1f1f2e 100%);
            border-radius: 25px;
            padding: 50px;
            margin: 30px 0;
        }

        .newsletter-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 2px solid rgba(102, 126, 234, 0.3);
        }

        .newsletter-title {
            font-size: 2.5em;
            color: #667eea;
            margin-bottom: 15px;
        }

        .tldr-box {
            background: rgba(16, 185, 129, 0.15);
            border-left: 5px solid #10b981;
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
        }

        .section-header {
            background: rgba(102, 126, 234, 0.15);
            padding: 20px 30px;
            border-radius: 15px;
            margin: 30px 0 20px 0;
            border-left: 5px solid #667eea;
        }

        .stock-list {
            list-style: none;
            padding: 0;
        }

        .stock-list li {
            padding: 20px;
            margin: 15px 0;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 12px;
            border-left: 4px solid #10b981;
            cursor: pointer;
            transition: all 0.3s;
        }

        .stock-list li:hover {
            background: rgba(102, 126, 234, 0.2);
            transform: translateX(10px);
        }

        .table-container {
            overflow-x: auto;
            margin: 25px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            overflow: hidden;
        }

        th {
            background: #667eea;
            padding: 15px;
            text-align: left;
            font-weight: 700;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .price-targets-section {
            background: linear-gradient(145deg, #2d2d44 0%, #1f1f2e 100%);
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            border: 2px solid #667eea;
        }

        .targets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .target-box {
            background: rgba(102, 126, 234, 0.15);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid transparent;
        }

        .target-label {
            font-size: 0.8em;
            color: #999;
            text-transform: uppercase;
        }

        .target-price {
            font-size: 1.6em;
            font-weight: 700;
            color: #10b981;
            margin-top: 5px;
        }

        .chart-container {
            background: #0a0a1a;
            border-radius: 20px;
            padding: 20px;
            margin: 30px 0;
            min-height: 800px;
        }

        .loading {
            text-align: center;
            padding: 60px 20px;
        }

        .spinner {
            border: 5px solid rgba(255,255,255,0.1);
            border-top: 5px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .live-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #10b981;
            animation: pulse 2s infinite;
            margin-right: 5px;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .plays-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- AI CHAT -->
    <div class="ai-chat-bar">
        <div class="chat-panel" id="chatPanel">
            <div class="chat-header">
                <div class="chat-title">ü§ñ AI Assistant</div>
                <button class="chat-close" onclick="toggleChat()">√ó</button>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="chat-message ai">
                    üëã Hi! Ask me anything about stocks!<br><br>
                    <strong>Examples:</strong><br>
                    ‚Ä¢ "Latest MU news?"<br>
                    ‚Ä¢ "Best mean reversion plays?"
                </div>
            </div>
            <div class="chat-input-area">
                <input 
                    type="text" 
                    id="chatInput" 
                    class="chat-input" 
                    placeholder="Ask..."
                    onkeypress="if(event.key==='Enter') sendChat()"
                />
                <button onclick="sendChat()" class="chat-send-btn">Send</button>
            </div>
        </div>
        <button class="chat-toggle-btn" onclick="toggleChat()">
            ü§ñ
            <span class="ai-pulse"></span>
        </button>
    </div>

    <div class="top-nav">
        <div class="nav-logo" onclick="goToHome()">
            <span style="font-size: 2em;">üìä</span>
            <span class="nav-logo-text">Elite Trading Analytics</span>
        </div>
        <div class="nav-actions">
            <button class="nav-btn" onclick="goToHome()">üè† Home</button>
            <button class="nav-btn" onclick="viewNewsletter()">üì∞ Newsletter</button>
            <button class="nav-btn" onclick="toggleChat()">ü§ñ Chat</button>
        </div>
    </div>

    <div class="container">
        <div class="market-story-header" id="homeHeader">
            <h1 class="story-title">Elite Trading Analytics</h1>
            <div class="story-narrative">
                "AI-Powered Analysis + Your Proprietary ThinkScript Edge + Live Market Data"
            </div>
            <div>
                <span class="proprietary-badge" onclick="filterByMeanReversion()">Mean Reversion</span>
                <span class="proprietary-badge" onclick="filterByInstitutional()">Inst 33 Flow</span>
                <span class="proprietary-badge" onclick="filterByRegime()">Regime Detection</span>
                <span class="proprietary-badge" style="border-color: #8b5cf6; color: #8b5cf6;">ü§ñ AI Active</span>
            </div>
            <div class="api-status" id="apiStatus">Connecting to backends...</div>
        </div>

        <div class="search-section" id="searchSection">
            <div class="search-bar">
                <input 
                    type="text" 
                    id="tickerInput" 
                    class="search-input"
                    placeholder="Enter ticker (AAPL, TSLA, NVDA)..." 
                    onkeypress="if(event.key==='Enter') analyzeStock()"
                />
                <button onclick="analyzeStock()" class="analyze-btn">AI DEEP DIVE ü§ñ</button>
            </div>
            
            <div class="action-buttons">
                <button onclick="loadStocks()" class="btn btn-scanner">üéØ ALL STOCKS</button>
                <button onclick="viewNewsletter()" class="btn btn-brief">üì∞ NEWSLETTER</button>
                <button onclick="toggleChat()" class="btn btn-ai">ü§ñ AI CHAT</button>
            </div>

            <div class="filter-buttons" id="filterButtons">
                <button class="filter-btn active" onclick="loadStocks()">All</button>
                <button class="filter-btn" onclick="filterByMeanReversion()">Mean Rev < -2.0</button>
                <button class="filter-btn" onclick="filterByInstitutional()">Inst 33 > 55</button>
                <button class="filter-btn" onclick="filterByRegime()">Regime > 70%</button>
                <button class="filter-btn" onclick="filterByOversold()">RSI < 35</button>
            </div>
        </div>

        <div id="detailedView" class="hidden"></div>
        
        <div class="plays-grid" id="playsGrid">
            <div class="loading">
                <div class="spinner"></div>
                <p>Loading Elite Trading Data...</p>
            </div>
        </div>
    </div>

    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>

    <script>
        // CONFIG
        const BACKEND_URL = 'https://elite-trading-with-exclusive-ip.onrender.com';

        // WATCHLIST DATA
        const WATCHLIST = [
            {symbol:'MU',price:201.37,change:-10.87,meanRev:-2.47,rsi:41.24,sellPct:94.29,volatility:60.0,regime:75.6,inst33:53,signal:"STRONG BUY",target1:220,target2:235,stop:190},
            {symbol:'SE',price:130.99,change:-8.74,meanRev:-2.46,rsi:27.72,volatility:42.0,regime:51.7,inst33:38,signal:"ACCUMULATE",target1:150,target2:165,stop:120},
            {symbol:'RIVN',price:14.66,change:-0.41,meanRev:-1.75,rsi:58.91,volatility:52.0,regime:99.1,inst33:65,signal:"BUY",target1:22,target2:25,stop:13},
            {symbol:'EA',price:201.12,change:-0.23,meanRev:-1.74,rsi:46.82,volatility:72.0,regime:64.7,inst33:53,signal:"MONITOR",target1:210,target2:225,stop:190},
            {symbol:'LULU',price:164.69,change:-0.82,meanRev:-1.49,rsi:49.1,volatility:80.0,regime:28.2,inst33:58,signal:"MONITOR",target1:180,target2:200,stop:155},
            {symbol:'TTWO',price:235.37,change:-2.84,meanRev:-2.28,rsi:43.08,volatility:75.0,regime:68.5,inst33:58,signal:"ACCUMULATE",target1:260,target2:280,stop:220}
        ];

        let stocks = [...WATCHLIST];
        let currentFilter = 'all';

        window.addEventListener('load', () => {
            checkBackend();
            loadStocks();
        });

        async function checkBackend() {
            try {
                const res = await fetch(`${BACKEND_URL}/api/config`, {timeout: 5000});
                const data = await res.json();
                
                updateStatus(`‚úÖ All APIs Ready ‚Ä¢ Polygon: ${data.polygon_enabled ? '‚úì' : '‚úó'} Finnhub: ${data.finnhub_enabled ? '‚úì' : '‚úó'} AI: ${data.perplexity_enabled ? '‚úì' : '‚úó'}`);
            } catch (err) {
                updateStatus('‚ö†Ô∏è Backend connecting...');
            }
        }

        function updateStatus(msg) {
            const el = document.getElementById('apiStatus');
            if (el) el.textContent = msg;
        }

        function toggleChat() {
            document.getElementById('chatPanel').classList.toggle('active');
        }

        async function sendChat() {
            const input = document.getElementById('chatInput');
            const msg = input.value.trim();
            if (!msg) return;

            const msgs = document.getElementById('chatMessages');
            msgs.innerHTML += `<div class="chat-message user">${msg}</div>`;
            input.value = '';
            
            msgs.innerHTML += `<div class="chat-message ai" id="thinking">ü§î Analyzing...</div>`;
            msgs.scrollTop = msgs.scrollHeight;

            try {
                const res = await fetch(`${BACKEND_URL}/api/ai-analyze`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        model: 'llama-3.1-sonar-large-128k-online',
                        messages: [{role: 'user', content: msg}],
                        temperature: 0.3,
                        max_tokens: 400
                    })
                });

                if (!res.ok) throw new Error(`HTTP ${res.status}`);

                const data = await res.json();
                if (data.error) throw new Error(data.error);
                
                document.getElementById('thinking').remove();
                msgs.innerHTML += `<div class="chat-message ai">${data.choices[0].message.content.replace(/\n/g, '<br>')}</div>`;
                msgs.scrollTop = msgs.scrollHeight;
                
            } catch (err) {
                if (document.getElementById('thinking')) {
                    document.getElementById('thinking').innerHTML = `‚ùå ${err.message}`;
                }
            }
        }

        async function getAI(ticker, stock) {
            try {
                updateStatus('ü§ñ Running AI analysis...');
                
                const res = await fetch(`${BACKEND_URL}/api/ai-analyze`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        model: 'llama-3.1-sonar-large-128k-online',
                        messages: [{
                            role: 'user',
                            content: `Deep analysis for ${ticker}:
Price: $${stock.price} (${stock.change}%)
Mean Reversion: ${stock.meanRev}
RSI: ${stock.rsi}
Inst 33: ${stock.inst33}
Regime: ${stock.regime}%

Provide: 1) Latest news 2) Technical setup 3) Entry/Targets/Stop 4) Risk/reward`
                        }],
                        temperature: 0.2,
                        max_tokens: 800
                    })
                });

                if (!res.ok) throw new Error(`HTTP ${res.status}`);

                const data = await res.json();
                if (data.error) throw new Error(data.error);
                
                updateStatus('‚úÖ AI analysis ready');
                return data.choices[0].message.content;
                
            } catch (error) {
                console.error('[AI] Error:', error);
                updateStatus('‚ö†Ô∏è AI error: ' + error.message);
                return null;
            }
        }

        function calc(stock) {
            const v = stock.volatility / 100;
            const m = Math.abs(stock.meanRev);
            const r = stock.regime / 100;
            const p = stock.price;
            
            return {
                d5: p + (m * v * 0.3 * p),
                d10: p + (m * v * 0.5 * r * p)
            };
        }

        // FILTER FUNCTIONS
        function filterByMeanReversion() {
            currentFilter = 'meanrev';
            const filtered = WATCHLIST.filter(s => s.meanRev < -2.0);
            displayStocks(filtered, 'Mean Reversion (MR < -2.0)');
        }

        function filterByInstitutional() {
            currentFilter = 'inst';
            const filtered = WATCHLIST.filter(s => s.inst33 > 55);
            displayStocks(filtered, 'Institutional Accumulation (Inst 33 > 55)');
        }

        function filterByRegime() {
            currentFilter = 'regime';
            const filtered = WATCHLIST.filter(s => s.regime > 70);
            displayStocks(filtered, 'Strong Regime (> 70%)');
        }

        function filterByOversold() {
            currentFilter = 'oversold';
            const filtered = WATCHLIST.filter(s => s.rsi < 35);
            displayStocks(filtered, 'Oversold Signals (RSI < 35)');
        }

        async function loadStocks() {
            currentFilter = 'all';
            displayStocks(WATCHLIST, 'All Stocks');
        }

        function displayStocks(stockList, title) {
            const grid = document.getElementById('playsGrid');
            
            if (stockList.length === 0) {
                grid.innerHTML = '<div style="text-align: center; padding: 40px; grid-column: 1/-1;"><p style="font-size: 1.2em;">No stocks matching criteria</p></div>';
                return;
            }
            
            grid.innerHTML = stockList.map(s => {
                const c = s.change >= 0 ? '#10b981' : '#ef4444';
                const cls = s.signal === 'STRONG BUY' ? 'signal-strong-buy' : 'signal-accumulate';
                const t = calc(s);
                
                return `
                    <div class="play-card" onclick="analyzeStock('${s.symbol}')">
                        <div class="play-ticker">
                            ${s.symbol} 
                            <span style="color: ${c}; font-size: 0.6em;">${s.change > 0 ? '+' : ''}${s.change.toFixed(2)}%</span>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <span style="font-size: 1.4em;">$${s.price.toFixed(2)}</span>
                            <span style="color: #8b5cf6; font-size: 0.8em; margin-left: 8px;">ü§ñ AI Ready</span>
                        </div>
                        <span class="signal-badge ${cls}">
                            ${s.signal === 'STRONG BUY' ? 'üî•' : 'üìà'} ${s.signal}
                        </span>
                        
                        <div class="play-metrics">
                            <div class="play-metric">
                                <div class="metric-label">5D Est</div>
                                <div class="metric-value" style="color: #10b981;">$${t.d5.toFixed(2)}</div>
                            </div>
                            <div class="play-metric">
                                <div class="metric-label">Mean Rev</div>
                                <div class="metric-value" style="color: ${s.meanRev < -2.0 ? '#10b981' : '#fff'}">${s.meanRev}</div>
                            </div>
                            <div class="play-metric">
                                <div class="metric-label">Inst 33</div>
                                <div class="metric-value" style="color: ${s.inst33 > 55 ? '#10b981' : '#fff'}">${s.inst33}</div>
                            </div>
                            <div class="play-metric">
                                <div class="metric-label">Regime</div>
                                <div class="metric-value">${s.regime}%</div>
                            </div>
                        </div>
                        
                        <div class="proprietary-insight">
                            <strong>‚¨ÜÔ∏è ENTRY:</strong> $${s.price.toFixed(2)}<br>
                            <strong>üéØ TARGETS:</strong> $${s.target1} ‚Üí $${s.target2}<br>
                            <strong style="color: #8b5cf6;">Click for AI Deep Dive</strong>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function goToHome() {
            document.getElementById('detailedView').classList.add('hidden');
            document.getElementById('playsGrid').classList.remove('hidden');
            document.getElementById('homeHeader').classList.remove('hidden');
            document.getElementById('searchSection').classList.remove('hidden');
            loadStocks();
        }

        async function analyzeStock(ticker) {
            if (typeof ticker !== 'string') {
                ticker = document.getElementById('tickerInput').value.trim().toUpperCase();
            }
            if (!ticker) return;
            
            document.getElementById('homeHeader').classList.add('hidden');
            document.getElementById('searchSection').classList.add('hidden');
            document.getElementById('playsGrid').classList.add('hidden');
            document.getElementById('detailedView').classList.remove('hidden');
            document.getElementById('detailedView').innerHTML = '<div class="loading"><div class="spinner"></div><p>Analyzing...</p></div>';
            
            let stock = WATCHLIST.find(s => s.symbol === ticker);
            if (!stock) {
                stock = {
                    symbol: ticker, price: 100, change: 0, meanRev: 0, rsi: 50,
                    sellPct: 0, volatility: 50, regime: 50, inst33: 50,
                    signal: "RESEARCH", target1: 110, target2: 120, stop: 90
                };
            }
            
            const ai = await getAI(ticker, stock);
            const t = calc(stock);
            const c = stock.change >= 0 ? '#10b981' : '#ef4444';
            
            document.getElementById('detailedView').innerHTML = `
                <div style="background: linear-gradient(145deg, #2d2d44 0%, #1f1f2e 100%); border-radius: 25px; padding: 40px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 30px;">
                        <div>
                            <div style="font-size: 3em; font-weight: 700;">${ticker}</div>
                            <span class="signal-badge ${stock.signal === 'STRONG BUY' ? 'signal-strong-buy' : 'signal-accumulate'}">${stock.signal}</span>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 2.5em; font-weight: 700; color: ${c}">
                                $${stock.price.toFixed(2)}
                                <span class="live-indicator"></span>
                            </div>
                            <div style="color: ${c}; font-size: 1.2em;">
                                ${stock.change > 0 ? '+' : ''}${stock.change.toFixed(2)}%
                            </div>
                        </div>
                    </div>
                    
                    ${ai ? `
                        <div class="ai-insight-box">
                            <h3 style="color: #8b5cf6; font-size: 1.6em; margin-bottom: 15px;">ü§ñ AI Deep Dive</h3>
                            <div style="white-space: pre-wrap;">${ai}</div>
                        </div>
                    ` : `
                        <div style="background: rgba(245, 158, 11, 0.15); border-left: 4px solid #f59e0b; padding: 20px; border-radius: 10px;">
                            ‚ö†Ô∏è AI unavailable - Check backend
                        </div>
                    `}
                    
                    <div class="price-targets-section">
                        <h3 style="color: #667eea; text-align: center;">üéØ Price Targets</h3>
                        <div class="targets-grid">
                            <div class="target-box" style="border-color: #10b981;">
                                <div class="target-label">Entry</div>
                                <div class="target-price">$${stock.price.toFixed(2)}</div>
                            </div>
                            <div class="target-box">
                                <div class="target-label">5D Est</div>
                                <div class="target-price">$${t.d5.toFixed(2)}</div>
                            </div>
                            <div class="target-box">
                                <div class="target-label">10D Est</div>
                                <div class="target-price">$${t.d10.toFixed(2)}</div>
                            </div>
                            <div class="target-box" style="border-color: #10b981;">
                                <div class="target-label">T1</div>
                                <div class="target-price">$${stock.target1}</div>
                            </div>
                            <div class="target-box" style="border-color: #10b981;">
                                <div class="target-label">T2</div>
                                <div class="target-price">$${stock.target2}</div>
                            </div>
                            <div class="target-box" style="border-color: #ef4444;">
                                <div class="target-label">Stop</div>
                                <div class="target-price" style="color: #ef4444;">$${stock.stop}</div>
                            </div>
                        </div>
                    </div>
                    
                    <button onclick="goToHome()" class="btn btn-scanner" style="width: 100%; padding: 20px;">‚Üê BACK</button>
                </div>
            `;
        }

        function viewNewsletter() {
            document.getElementById('homeHeader').classList.add('hidden');
            document.getElementById('searchSection').classList.add('hidden');
            document.getElementById('playsGrid').classList.add('hidden');
            document.getElementById('detailedView').classList.remove('hidden');
            
            const strong = WATCHLIST.filter(s => s.meanRev < -2.0);
            const inst = WATCHLIST.filter(s => s.inst33 > 55);
            const regime = WATCHLIST.filter(s => s.regime > 70);
            
            document.getElementById('detailedView').innerHTML = `
                <div class="newsletter-section">
                    <div class="newsletter-header">
                        <div class="newsletter-title">üìä Elite Trading Newsletter</div>
                        <div style="color: #aaa;">November 21, 2025 ‚Ä¢ AI-Powered Analysis</div>
                    </div>
                    
                    <div class="tldr-box">
                        <h3 style="color: #10b981; font-size: 1.6em; margin-bottom: 15px;">‚ö° TL;DR</h3>
                        <p style="line-height: 2; font-size: 1.1em;">
                            <strong>${strong.length} EXTREME MEAN REVERSION</strong> (MR < -2.0) | 
                            <strong>${inst.length} INSTITUTIONAL ACCUMULATION</strong> (Inst 33 > 55) | 
                            <strong>${regime.length} STRONG TRENDS</strong> (Regime > 70%)
                        </p>
                    </div>
                    
                    <div class="section-header">
                        <h3 style="color: #667eea; font-size: 1.8em;">üî• MEAN REVERSION EXTREMES (${strong.length})</h3>
                    </div>
                    <ul class="stock-list">
                        ${strong.map(s => `
                            <li onclick="analyzeStock('${s.symbol}')">
                                <strong style="color: #10b981; font-size: 1.3em;">${s.symbol}</strong> @ $${s.price.toFixed(2)}<br>
                                Mean Rev: ${s.meanRev} | RSI: ${s.rsi} | Entry: $${s.price.toFixed(2)} ‚Üí T1: $${s.target1}
                            </li>
                        `).join('')}
                    </ul>
                    
                    <div class="section-header">
                        <h3 style="color: #667eea; font-size: 1.8em;">üè¶ INSTITUTIONAL ACCUMULATION (${inst.length})</h3>
                    </div>
                    <ul class="stock-list">
                        ${inst.map(s => `
                            <li onclick="analyzeStock('${s.symbol}')">
                                <strong style="color: #667eea; font-size: 1.3em;">${s.symbol}</strong> - Inst 33: ${s.inst33} | Regime: ${s.regime}%
                            </li>
                        `).join('')}
                    </ul>
                    
                    <div class="section-header">
                        <h3 style="color: #667eea; font-size: 1.8em;">üìà STRONG TRENDS (${regime.length})</h3>
                    </div>
                    <ul class="stock-list">
                        ${regime.map(s => `
                            <li onclick="analyzeStock('${s.symbol}')">
                                <strong style="color: #10b981; font-size: 1.3em;">${s.symbol}</strong> - Regime: ${s.regime}% | Mean Rev: ${s.meanRev}
                            </li>
                        `).join('')}
                    </ul>
                    
                    <div class="section-header">
                        <h3 style="color: #667eea; font-size: 1.8em;">üìä WATCHLIST SUMMARY</h3>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Symbol</th>
                                    <th>Price</th>
                                    <th>Mean Rev</th>
                                    <th>Inst 33</th>
                                    <th>Regime</th>
                                    <th>Signal</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${WATCHLIST.map(s => `
                                    <tr onclick="analyzeStock('${s.symbol}')" style="cursor: pointer;">
                                        <td><strong>${s.symbol}</strong></td>
                                        <td>$${s.price.toFixed(2)}</td>
                                        <td style="color: ${s.meanRev < -2.0 ? '#10b981' : '#fff'}">${s.meanRev}</td>
                                        <td style="color: ${s.inst33 > 55 ? '#10b981' : '#fff'}">${s.inst33}</td>
                                        <td>${s.regime}%</td>
                                        <td><strong style="color: ${s.signal === 'STRONG BUY' ? '#10b981' : '#f59e0b'}">${s.signal}</strong></td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                    
                    <button onclick="goToHome()" class="btn btn-scanner" style="width: 100%; padding: 20px; margin-top: 30px;">‚Üê BACK</button>
                </div>
            `;
        }
    </script>
</body>
</html>

Version 2
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Elite Trading AI Dashboard</title>
  <script src="https://s3.tradingview.com/tv.js"></script>
  <style>
    /* Add styling for tab bar, cards, modal, newsletter, and chat as needed */
  </style>
</head>
<body>
<div id="newsletter" style="padding:2em;background:#232c4c;color:#fff;border-radius:16px;margin:1em 0;"></div>
<div>
  <button onclick="switchTab('priority')">Priority</button>
  <button onclick="switchTab('meanrev')">Mean Reversion</button>
  <button onclick="switchTab('gn1')">Golden Nugget 1</button>
  <button onclick="switchTab('gn2')">Golden Nugget 2</button>
</div>
<div id="stockGrid"></div>

<!-- Detail modal -->
<div id="modal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:#000a;">
  <div id="modalContent" style="max-width:800px;margin:48px auto;background:#fff;padding:2em;border-radius:16px;">
    <button onclick="closeModal()">X</button>
    <div id="modalBody"></div>
  </div>
</div>

<!-- AI Chat widget -->
<div style="position:fixed;bottom:24px;right:24px;background:#fff;padding:1em;border-radius:12px;width:350px;">
  <div id="chatBox" style="height:120px;overflow:auto;font-size:.93em;margin-bottom:.8em"></div>
  <input id="chatInput" style="width:65%;padding:.5em;" placeholder="Ask AI...">
  <button onclick="sendChat()">Send</button>
</div>

<script>
// --- Config ---
const BACKEND_URL = 'https://elite-trading-with-exclusive-ip.onrender.com';
const TAB_FILES = {
  priority: '2025-11-20-watchlist-Priority.csv',
  meanrev: '2025-11-20-watchlist.csv',
  gn1: '2025-11-20-watchlist-GN1.csv',
  gn2: '2025-11-20-watchlist-GN2.csv'
};

// --- State ---
let stockData = {};
let currentTab = 'priority';

// --- Helper: CSV parse ---
function parseCSV(str) {
  const [header, ...lines] = str.trim().split("\n");
  const keys = header.split(",");
  return lines.map(line => {
    const vals = line.split(",");
    let row = {};
    keys.forEach((key, i) => row[key.trim()] = vals[i] ? vals[i].trim() : '');
    return row;
  });
}

// --- Fetch, Newsletter, and Stock Grid Logic ---
async function loadTab(tab) {
  currentTab = tab;
  const res = await fetch(`/${TAB_FILES[tab]}`);
  const csv = await res.text();
  const rows = parseCSV(csv);
  stockData[tab] = rows;

  if (tab === 'priority') generateNewsletter(rows);
  renderGrid(tab);
}
function switchTab(tab) { loadTab(tab); }

async function generateNewsletter(rows) {
  const prompt = `Write a trading newsletter summary for these tickers including mean revision, RSI, regime, highlights and unique observations:\n` +
    rows.map(r=>`${r.Symbol} $${r.Last} | Chg: ${r.Change} | MeanRev: ${r['mean revision']} | Regime: ${r['Regime Detection']} | RSI: ${r['RSIWIlder']}`).join("\n");
  const aiText = await callAI(prompt);
  document.getElementById('newsletter').innerText = aiText || 'Newsletter unavailable.';
}

// --- Stock Grid ---
function renderGrid(tab) {
  const rows = stockData[tab] || [];
  document.getElementById('stockGrid').innerHTML = rows.slice(0,10).map((row,idx) => `
    <div style="background:#1b2343;color:#c6e2f7;margin:1em 0;padding:1.2em;border-radius:10px;cursor:pointer"
         onclick="showModal('${tab}', ${idx})">
      <div><b>${row.Symbol || row['Symbol.1']}</b> $${row.Last || row['Last']}</div>
      <div>Change: ${row.Change || row['Change']}, RSI: ${row['RSIWIlder']}, MR: ${row['mean revision']}, Regime: ${row['Regime Detection']}</div>
    </div>`).join('');
}

// --- Detail Modal ---
function showModal(tab, idx) {
  const row = stockData[tab][idx];
  const sym = row.Symbol || row['Symbol.1'];
  const modalBody = document.getElementById('modalBody');
  modalBody.innerHTML = `
    <h2>${sym} ($${row.Last})</h2>
    <b>Change:</b> ${row.Change}<br>
    <b>Mean Rev:</b> ${row['mean revision']}<br>
    <b>RSI:</b> ${row['RSIWIlder']}<br>
    <b>Regime:</b> ${row['Regime Detection']}<br>
    <b>Volume:</b> ${row.Volume}<br>
    <b>Institutional Score:</b> ${row['Inst 33']}<br>
    <br>
    <div><b>AI Analysis:</b><div id="aiDetailBox">Loading...</div></div>
    <div id="tvChart" style="height:400px;width:100%"></div>
  `;
  document.getElementById('modal').style.display = '';
  // TradingView chart
  new TradingView.widget({
    "container_id": "tvChart",
    "width": "100%",
    "height": 400,
    "symbol": sym,
    "interval": "30",
    "timezone": "America/New_York",
    "theme": "dark",
    "style": "1",
    "hide_top_toolbar": true,
    "save_image": false,
    "hide_legend": false
  });
  // AI Expanded
  callAI(`Deep actionable trading analysis for ${sym}: price $${row.Last}, mean revision ${row['mean revision']}, RSI ${row['RSIWIlder']}, Regime ${row['Regime Detection']}, highlights, opportunity, technical setup, and risk managment.`)
    .then(txt => document.getElementById('aiDetailBox').innerText = txt || 'Unavailable');
}
function closeModal() { document.getElementById('modal').style.display = 'none'; }

// --- Central AI function ---
async function callAI(userPrompt) {
  try {
    const resp = await fetch(`${BACKEND_URL}/api/ai-analyze`, {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({
        model: 'sonar',
        messages:[{role:'user', content: userPrompt}],
        temperature: 0.35,
        max_tokens: 400
      })
    });
    if (resp.ok) {
      const data = await resp.json();
      return data.choices?.[0]?.message?.content || '';
    }
    return 'Error loading AI response';
  } catch(e) {
    return 'AI unavailable';
  }
}

// --- AI Chat ---
let chatHistory = [];
async function sendChat() {
  const box = document.getElementById('chatBox');
  const inp = document.getElementById('chatInput');
  const msg = inp.value.trim();
  if(!msg) return;
  box.innerHTML += `<div style="color:#0af"><b>You:</b>${msg}</div>`;
  inp.value = '';
  const aiAnswer = await callAI(msg);
  box.innerHTML += `<div style="color:#444"><b>AI:</b> ${aiAnswer}</div>`;
  box.scrollTop = box.scrollHeight;
}

// --- Init (load priority by default) ---
window.onload = () => loadTab('priority');
</script>
</body>
</html>

version 3
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Elite Trading Research Platform</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <script src="https://s3.tradingview.com/tv.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ApexCharts/3.44.0/apexcharts.min.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --dark-bg: #0F1419;
      --card-bg: #1a1f2e;
      --secondary-bg: #232f47;
      --accent: #00d4ff;
      --success: #00c896;
      --danger: #ff4757;
      --warning: #ffa502;
      --text-primary: #ffffff;
      --text-secondary: #b0b8c1;
      --border: #2a3446;
    }

    body {
      background: var(--dark-bg);
      color: var(--text-primary);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      overflow-x: hidden;
    }

    /* ============ HEADER ============ */
    .header {
      background: rgba(26, 31, 46, 0.95);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 2px 20px rgba(0, 0, 0, 0.3);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.8rem;
      font-size: 1.3em;
      font-weight: 700;
      color: var(--accent);
      cursor: pointer;
    }

    .header-search {
      flex: 1;
      max-width: 500px;
      margin: 0 2rem;
    }

    .search-bar {
      display: flex;
      align-items: center;
      background: var(--card-bg);
      border: 2px solid var(--border);
      border-radius: 10px;
      padding: 0.7rem 1rem;
      gap: 0.5rem;
      transition: all 0.3s;
    }

    .search-bar:focus-within {
      border-color: var(--accent);
      box-shadow: 0 0 20px rgba(0, 212, 255, 0.2);
    }

    .search-bar input {
      flex: 1;
      background: transparent;
      border: none;
      color: var(--text-primary);
      outline: none;
      font-size: 1em;
    }

    .search-bar input::placeholder {
      color: var(--text-secondary);
    }

    .search-bar button {
      background: var(--accent);
      border: none;
      color: var(--dark-bg);
      padding: 0.6rem 1.2rem;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
    }

    .search-bar button:hover {
      background: #00b8d4;
      transform: translateY(-1px);
    }

    .header-actions {
      display: flex;
      gap: 1rem;
    }

    .header-btn {
      background: transparent;
      border: 2px solid var(--border);
      color: var(--text-secondary);
      padding: 0.6rem 1.2rem;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 600;
    }

    .header-btn:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    /* ============ MAIN CONTAINER ============ */
    .container {
      max-width: 1600px;
      margin: 0 auto;
      padding: 2rem;
    }

    /* ============ NEWSLETTER SECTION ============ */
    .newsletter-section {
      background: linear-gradient(135deg, #1a3a52 0%, #232f47 100%);
      border: 1px solid rgba(0, 212, 255, 0.2);
      border-radius: 12px;
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    }

    .newsletter-section h2 {
      font-size: 1.4em;
      color: var(--accent);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .newsletter-content {
      line-height: 1.8;
      color: var(--text-secondary);
      font-size: 0.95em;
    }

    .newsletter-highlights {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 1rem;
      margin-top: 1.5rem;
    }

    .highlight-card {
      background: rgba(0, 200, 150, 0.1);
      border: 1px solid rgba(0, 200, 150, 0.3);
      padding: 1.2rem;
      border-radius: 10px;
      text-align: center;
    }

    .highlight-card .value {
      font-size: 2em;
      color: var(--success);
      font-weight: 700;
    }

    .highlight-card .label {
      font-size: 0.85em;
      color: var(--text-secondary);
      margin-top: 0.5rem;
    }

    /* ============ FILTER TABS ============ */
    .filter-tabs {
      display: flex;
      gap: 0.8rem;
      margin: 2rem 0;
      flex-wrap: wrap;
      border-bottom: 2px solid var(--border);
      padding-bottom: 1rem;
    }

    .filter-btn {
      padding: 0.8rem 1.5rem;
      background: transparent;
      border: 2px solid var(--border);
      color: var(--text-secondary);
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
      font-size: 0.95em;
    }

    .filter-btn:hover {
      border-color: var(--accent);
      color: var(--accent);
      background: rgba(0, 212, 255, 0.05);
    }

    .filter-btn.active {
      background: var(--accent);
      color: var(--dark-bg);
      border-color: var(--accent);
    }

    /* ============ STOCK GRID ============ */
    .stock-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 1.5rem;
      margin: 2rem 0;
    }

    .stock-card {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.5rem;
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
    }

    .stock-card:hover {
      border-color: var(--accent);
      box-shadow: 0 12px 40px rgba(0, 212, 255, 0.15);
      transform: translateY(-4px);
    }

    .stock-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 1rem;
    }

    .stock-symbol {
      font-size: 1.6em;
      font-weight: 700;
      color: var(--text-primary);
    }

    .stock-price {
      font-size: 1.8em;
      font-weight: 700;
      color: var(--accent);
    }

    .stock-change {
      font-size: 0.95em;
      padding: 0.4rem 0.8rem;
      border-radius: 6px;
      font-weight: 600;
      margin-top: 0.3rem;
    }

    .stock-change.positive {
      background: rgba(0, 200, 150, 0.2);
      color: var(--success);
    }

    .stock-change.negative {
      background: rgba(255, 71, 87, 0.2);
      color: var(--danger);
    }

    .signal-badge {
      display: inline-block;
      padding: 0.5rem 1rem;
      background: linear-gradient(135deg, var(--accent) 0%, #00b8d4 100%);
      color: var(--dark-bg);
      border-radius: 20px;
      font-size: 0.85em;
      font-weight: 700;
      margin-bottom: 1rem;
    }

    .stock-metrics {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.8rem;
      margin: 1rem 0;
    }

    .metric {
      background: var(--secondary-bg);
      padding: 0.8rem;
      border-radius: 8px;
      border: 1px solid var(--border);
    }

    .metric-label {
      font-size: 0.8em;
      color: var(--text-secondary);
      text-transform: uppercase;
      font-weight: 600;
      margin-bottom: 0.3rem;
    }

    .metric-value {
      font-size: 1.2em;
      color: var(--accent);
      font-weight: 700;
    }

    /* ============ RESEARCH PAGE ============ */
    .research-page {
      display: none;
    }

    .research-page.active {
      display: block;
    }

    .research-header {
      background: linear-gradient(135deg, var(--card-bg) 0%, var(--secondary-bg) 100%);
      border-bottom: 2px solid var(--accent);
      padding: 2rem;
      border-radius: 12px;
      margin-bottom: 2rem;
    }

    .research-title-section {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 1.5rem;
    }

    .research-title {
      font-size: 2.5em;
      color: var(--text-primary);
      font-weight: 700;
    }

    .research-price-info {
      text-align: right;
    }

    .research-price {
      font-size: 2.8em;
      color: var(--accent);
      font-weight: 700;
    }

    .research-change {
      font-size: 1.3em;
      margin-top: 0.3rem;
    }

    .research-metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
    }

    .research-metric {
      background: rgba(0, 212, 255, 0.05);
      border: 1px solid var(--border);
      padding: 1rem;
      border-radius: 10px;
      text-align: center;
    }

    .research-metric-label {
      font-size: 0.85em;
      color: var(--text-secondary);
      text-transform: uppercase;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .research-metric-value {
      font-size: 1.5em;
      color: var(--accent);
      font-weight: 700;
    }

    /* ============ CHART PAGE ============ */
    .chart-section {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.5rem;
      margin: 2rem 0;
    }

    .chart-container {
      width: 100%;
      height: 600px;
      background: var(--secondary-bg);
      border-radius: 12px;
      overflow: hidden;
    }

    .chart-controls {
      display: flex;
      gap: 0.8rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }

    .chart-btn {
      padding: 0.6rem 1.2rem;
      background: var(--secondary-bg);
      border: 1px solid var(--border);
      color: var(--text-secondary);
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
    }

    .chart-btn:hover,
    .chart-btn.active {
      background: var(--accent);
      color: var(--dark-bg);
      border-color: var(--accent);
    }

    /* ============ COMMENTARY SECTION ============ */
    .commentary-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
      margin: 2rem 0;
    }

    .commentary-box {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.5rem;
    }

    .commentary-box h3 {
      color: var(--accent);
      margin-bottom: 1rem;
      font-size: 1.2em;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .commentary-text {
      line-height: 1.8;
      color: var(--text-secondary);
      font-size: 0.95em;
    }

    .commentary-list {
      list-style: none;
    }

    .commentary-list li {
      padding: 0.6rem 0;
      color: var(--text-secondary);
      border-bottom: 1px solid var(--border);
    }

    .commentary-list li:last-child {
      border-bottom: none;
    }

    .commentary-list li strong {
      color: var(--accent);
    }

    /* ============ AI CHAT WIDGET ============ */
    .chat-widget {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 420px;
      max-height: 650px;
      background: var(--card-bg);
      border: 2px solid var(--border);
      border-radius: 16px;
      display: flex;
      flex-direction: column;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
      z-index: 150;
      transform: translateY(calc(100% + 20px));
      opacity: 0;
      transition: all 0.3s;
      pointer-events: none;
    }

    .chat-widget.active {
      transform: translateY(0);
      opacity: 1;
      pointer-events: all;
    }

    .chat-header {
      background: linear-gradient(135deg, var(--accent) 0%, #00b8d4 100%);
      color: var(--dark-bg);
      padding: 1.2rem;
      border-radius: 14px 14px 0 0;
      font-weight: 700;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1rem;
    }

    .chat-header span {
      font-size: 1.1em;
    }

    .chat-header button {
      background: none;
      border: none;
      color: var(--dark-bg);
      font-size: 1.4em;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 30px;
      height: 30px;
    }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 1.2rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .message {
      padding: 1rem;
      border-radius: 12px;
      max-width: 90%;
      word-wrap: break-word;
      font-size: 0.9em;
      line-height: 1.6;
      animation: fadeIn 0.3s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .message.user {
      align-self: flex-end;
      background: var(--accent);
      color: var(--dark-bg);
      border-radius: 12px 2px 12px 12px;
    }

    .message.ai {
      align-self: flex-start;
      background: var(--secondary-bg);
      color: var(--text-secondary);
      border: 1px solid var(--border);
      border-radius: 2px 12px 12px 12px;
    }

    .chat-input-area {
      display: flex;
      gap: 0.7rem;
      padding: 1.2rem;
      border-top: 1px solid var(--border);
      background: var(--card-bg);
      border-radius: 0 0 14px 14px;
    }

    .chat-input-area input {
      flex: 1;
      background: var(--secondary-bg);
      border: 1px solid var(--border);
      color: var(--text-primary);
      padding: 0.8rem;
      border-radius: 8px;
      outline: none;
      transition: border-color 0.3s;
      font-size: 0.9em;
    }

    .chat-input-area input:focus {
      border-color: var(--accent);
    }

    .chat-input-area button {
      background: var(--accent);
      border: none;
      color: var(--dark-bg);
      padding: 0.8rem 1.5rem;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 700;
      transition: all 0.3s;
    }

    .chat-input-area button:hover {
      background: #00b8d4;
      transform: translateY(-2px);
    }

    .chat-toggle {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 70px;
      height: 70px;
      background: linear-gradient(135deg, var(--accent) 0%, #00b8d4 100%);
      border: none;
      border-radius: 50%;
      color: var(--dark-bg);
      font-size: 1.6em;
      cursor: pointer;
      box-shadow: 0 12px 30px rgba(0, 212, 255, 0.4);
      transition: all 0.3s;
      z-index: 140;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .chat-toggle:hover {
      transform: scale(1.1);
      box-shadow: 0 16px 40px rgba(0, 212, 255, 0.5);
    }

    .chat-toggle.hidden {
      opacity: 0;
      pointer-events: none;
    }

    /* ============ RESPONSIVE ============ */
    @media (max-width: 1024px) {
      .commentary-section {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .stock-grid {
        grid-template-columns: 1fr;
      }

      .header {
        flex-wrap: wrap;
        gap: 1rem;
        padding: 1rem;
      }

      .header-search {
        flex: 1;
        min-width: 100%;
        max-width: none;
        margin: 0;
      }

      .chat-widget {
        width: calc(100% - 20px);
        right: 10px;
        left: 10px;
        max-width: none;
      }

      .research-title {
        font-size: 1.8em;
      }

      .container {
        padding: 1rem;
      }
    }
  </style>
</head>

<body>
  <!-- ============ HEADER ============ -->
  <div class="header">
    <div class="logo" onclick="goHome()">
      <i class="fas fa-chart-line"></i>
      <span>Elite Trading</span>
    </div>
    <div class="header-search">
      <div class="search-bar">
        <i class="fas fa-search"></i>
        <input type="text" id="searchInput" placeholder="Search any ticker..." onkeypress="if(event.key==='Enter') searchStock()">
        <button onclick="searchStock()">Research</button>
      </div>
    </div>
    <div class="header-actions">
      <button class="header-btn" onclick="goHome()">üìä Dashboard</button>
      <button class="header-btn" onclick="toggleChat()">üí¨ Chat</button>
    </div>
  </div>

  <!-- ============ MAIN CONTENT (HOME) ============ -->
  <div class="container" id="homePage">
    <!-- Newsletter -->
    <div class="newsletter-section">
      <h2><i class="fas fa-newspaper"></i> Market Newsletter</h2>
      <div class="newsletter-content" id="newsletterContent">
        Loading AI-powered market summary...
      </div>
      <div class="newsletter-highlights" id="highlights"></div>
    </div>

    <!-- Filters -->
    <div class="filter-tabs">
      <button class="filter-btn active" onclick="filterStocks('all')">üìã All Stocks</button>
      <button class="filter-btn" onclick="filterStocks('priority')">‚≠ê Priority</button>
      <button class="filter-btn" onclick="filterStocks('meanrev')">üìâ Mean Reversion</button>
      <button class="filter-btn" onclick="filterStocks('gn1')">üíé Golden Nugget 1</button>
      <button class="filter-btn" onclick="filterStocks('gn2')">üíé Golden Nugget 2</button>
    </div>

    <!-- Stock Grid -->
    <div class="stock-grid" id="stockGrid">
      <div style="grid-column: 1/-1; text-align: center; padding: 3rem; color: var(--text-secondary);">
        Loading stocks...
      </div>
    </div>
  </div>

  <!-- ============ RESEARCH PAGE ============ -->
  <div class="container research-page" id="researchPage">
    <!-- Research Header -->
    <div class="research-header">
      <div class="research-title-section">
        <div>
          <div class="research-title" id="researchSymbol">TICKER</div>
        </div>
        <div class="research-price-info">
          <div class="research-price" id="researchPrice">$0.00</div>
          <div class="research-change" id="researchChange">+0.00%</div>
        </div>
      </div>
      <div class="research-metrics-grid" id="researchMetrics"></div>
    </div>

    <!-- Chart Section -->
    <div class="chart-section">
      <div class="chart-controls">
        <button class="chart-btn active" onclick="setChartInterval('1D')">1D</button>
        <button class="chart-btn" onclick="setChartInterval('1W')">1W</button>
        <button class="chart-btn" onclick="setChartInterval('1M')">1M</button>
        <button class="chart-btn" onclick="setChartInterval('3M')">3M</button>
        <button class="chart-btn" onclick="setChartInterval('1Y')">1Y</button>
        <button class="chart-btn" onclick="setChartInterval('ALL')">All</button>
      </div>
      <div class="chart-container" id="chartContainer"></div>
    </div>

    <!-- Commentary -->
    <div class="commentary-section">
      <div class="commentary-box">
        <h3><i class="fas fa-lightbulb"></i> Technical Setup</h3>
        <div class="commentary-text" id="technicalComment">Loading analysis...</div>
      </div>
      <div class="commentary-box">
        <h3><i class="fas fa-target"></i> Entry & Targets</h3>
        <ul class="commentary-list" id="entryTargets">
          <li>Loading targets...</li>
        </ul>
      </div>
    </div>

    <!-- AI Deep Dive -->
    <div class="commentary-box" style="margin: 2rem 0;">
      <h3><i class="fas fa-brain"></i> AI Deep Analysis</h3>
      <div class="commentary-text" id="aiDeepDive">Generating comprehensive AI analysis...</div>
    </div>

    <!-- Back Button -->
    <button class="header-btn" onclick="goHome()" style="width: 100%; padding: 1rem; font-size: 1.1em; margin: 2rem 0;">
      ‚Üê Back to Dashboard
    </button>
  </div>

  <!-- ============ AI CHAT WIDGET ============ -->
  <button class="chat-toggle" id="chatToggle" onclick="toggleChat()">
    <i class="fas fa-comments"></i>
  </button>
  <div class="chat-widget" id="chatWidget">
    <div class="chat-header">
      <span><i class="fas fa-robot"></i> Trading AI</span>
      <button onclick="toggleChat()">‚àí</button>
    </div>
    <div class="chat-messages" id="chatMessages"></div>
    <div class="chat-input-area">
      <input type="text" id="chatInput" placeholder="Ask anything..." onkeypress="if(event.key==='Enter') sendChat()">
      <button onclick="sendChat()"><i class="fas fa-paper-plane"></i></button>
    </div>
  </div>

  <!-- ============ JAVASCRIPT ============ -->
  <script>
    // ===== CONFIG =====
    const BACKEND_URL = 'https://elite-trading-with-exclusive-ip.onrender.com';
    const WATCHLIST = [
      {symbol:'MU',price:201.37,change:-10.87,meanRev:-2.47,rsi:41.24,regime:75.6,inst33:53,signal:"STRONG BUY",target1:220,target2:235,stop:190,category:'priority'},
      {symbol:'SE',price:130.99,change:-8.74,meanRev:-2.46,rsi:27.72,regime:51.7,inst33:38,signal:"ACCUMULATE",target1:150,target2:165,stop:120,category:'meanrev'},
      {symbol:'RIVN',price:14.66,change:-0.41,meanRev:-1.75,rsi:58.91,regime:99.1,inst33:65,signal:"BUY",target1:22,target2:25,stop:13,category:'gn1'},
      {symbol:'EA',price:201.12,change:-0.23,meanRev:-1.74,rsi:46.82,regime:64.7,inst33:53,signal:"MONITOR",target1:210,target2:225,stop:190,category:'priority'},
      {symbol:'LULU',price:164.69,change:-0.82,meanRev:-1.49,rsi:49.1,regime:28.2,inst33:58,signal:"MONITOR",target1:180,target2:200,stop:155,category:'gn2'},
    ];

    // ===== STATE =====
    let currentResearchSymbol = null;
    let currentChartInterval = '1D';

    // ===== INIT =====
    window.addEventListener('load', () => {
      loadNewsletter();
      renderStocks('all');
    });

    // ===== NAVIGATION =====
    function goHome() {
      document.getElementById('homePage').style.display = 'block';
      document.getElementById('researchPage').classList.remove('active');
      currentResearchSymbol = null;
    }

    // ===== NEWSLETTER =====
    async function loadNewsletter() {
      const prompt = `Write a brief, actionable trading market newsletter for these ${WATCHLIST.length} stocks:\n` +
        WATCHLIST.map(s => `${s.symbol} $${s.price} | Change: ${s.change}% | Mean Rev: ${s.meanRev} | RSI: ${s.rsi} | Regime: ${s.regime}%`).join('\n') +
        `\nInclude: top 3 opportunities, key technical levels, market context in 3-4 sentences max.`;
      
      const result = await callAI(prompt);
      document.getElementById('newsletterContent').textContent = result || 'Newsletter unavailable';
      
      const highlights = `
        <div class="highlight-card">
          <div class="value">${WATCHLIST.length}</div>
          <div class="label">Stocks Monitored</div>
        </div>
        <div class="highlight-card">
          <div class="value">${WATCHLIST.filter(s=>s.meanRev<-2).length}</div>
          <div class="label">Mean Reversions</div>
        </div>
        <div class="highlight-card">
          <div class="value">${WATCHLIST.filter(s=>s.signal.includes('BUY')).length}</div>
          <div class="label">Active Buy Signals</div>
        </div>
        <div class="highlight-card">
          <div class="value">${WATCHLIST.filter(s=>s.regime>70).length}</div>
          <div class="label">Strong Trends</div>
        </div>
      `;
      document.getElementById('highlights').innerHTML = highlights;
    }

    // ===== RENDER STOCKS =====
    function renderStocks(filter) {
      const filtered = filter === 'all' ? WATCHLIST : WATCHLIST.filter(s => s.category === filter);
      const html = filtered.map(s => `
        <div class="stock-card" onclick="researchStock('${s.symbol}')">
          <div class="stock-header">
            <div>
              <div class="stock-symbol">${s.symbol}</div>
              <div class="stock-change ${s.change >= 0 ? 'positive' : 'negative'}">
                ${s.change >= 0 ? '‚ñ≤' : '‚ñº'} ${Math.abs(s.change).toFixed(2)}%
              </div>
            </div>
            <div class="stock-price">$${s.price.toFixed(2)}</div>
          </div>
          
          <span class="signal-badge">${s.signal}</span>
          
          <div class="stock-metrics">
            <div class="metric">
              <div class="metric-label">Mean Rev</div>
              <div class="metric-value">${s.meanRev}</div>
            </div>
            <div class="metric">
              <div class="metric-label">RSI</div>
              <div class="metric-value">${s.rsi}</div>
            </div>
            <div class="metric">
              <div class="metric-label">Regime</div>
              <div class="metric-value">${s.regime}%</div>
            </div>
            <div class="metric">
              <div class="metric-label">Inst 33</div>
              <div class="metric-value">${s.inst33}</div>
            </div>
          </div>
        </div>
      `).join('');
      
      document.getElementById('stockGrid').innerHTML = html;
    }

    function filterStocks(category) {
      document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
      event.target.classList.add('active');
      renderStocks(category);
    }

    // ===== SEARCH & RESEARCH =====
    function searchStock() {
      const ticker = document.getElementById('searchInput').value.toUpperCase().trim();
      if (ticker) researchStock(ticker);
    }

    async function researchStock(ticker) {
      currentResearchSymbol = ticker;
      document.getElementById('homePage').style.display = 'none';
      document.getElementById('researchPage').classList.add('active');

      // Find in watchlist or create new
      let stock = WATCHLIST.find(s => s.symbol === ticker);
      if (!stock) {
        stock = {
          symbol: ticker,
          price: 'Loading...',
          change: 0,
          meanRev: 0,
          rsi: 0,
          regime: 0,
          inst33: 0,
          target1: 0,
          target2: 0
        };
      }

      // Update header
      document.getElementById('researchSymbol').textContent = ticker;
      document.getElementById('researchPrice').textContent = `$${stock.price}`;
      document.getElementById('researchChange').textContent = `${stock.change > 0 ? '+' : ''}${stock.change}%`;

      // Metrics
      const metricsHtml = `
        <div class="research-metric">
          <div class="research-metric-label">Price</div>
          <div class="research-metric-value">$${stock.price}</div>
        </div>
        <div class="research-metric">
          <div class="research-metric-label">Change</div>
          <div class="research-metric-value">${stock.change}%</div>
        </div>
        <div class="research-metric">
          <div class="research-metric-label">Mean Rev</div>
          <div class="research-metric-value">${stock.meanRev}</div>
        </div>
        <div class="research-metric">
          <div class="research-metric-label">RSI</div>
          <div class="research-metric-value">${stock.rsi}</div>
        </div>
        <div class="research-metric">
          <div class="research-metric-label">Regime</div>
          <div class="research-metric-value">${stock.regime}%</div>
        </div>
        <div class="research-metric">
          <div class="research-metric-label">Inst 33</div>
          <div class="research-metric-value">${stock.inst33}</div>
        </div>
      `;
      document.getElementById('researchMetrics').innerHTML = metricsHtml;

      // Chart
      renderChart(ticker);

      // Technical Commentary
      const technicalPrompt = `Provide a SHORT 2-sentence technical analysis for ${ticker} at price $${stock.price} with RSI ${stock.rsi}, Mean Reversion ${stock.meanRev}. Focus on: support/resistance, trend, momentum.`;
      const technicalText = await callAI(technicalPrompt);
      document.getElementById('technicalComment').textContent = technicalText;

      // Entry & Targets
      const targetsHtml = `
        <li><strong>Entry:</strong> $${stock.price.toFixed(2)}</li>
        <li><strong>T1 (5%):</strong> $${stock.target1}</li>
        <li><strong>T2 (10%):</strong> $${stock.target2}</li>
        <li><strong>Stop Loss:</strong> $${stock.stop}</li>
      `;
      document.getElementById('entryTargets').innerHTML = targetsHtml;

      // Deep AI Analysis
      const deepPrompt = `Comprehensive trading analysis for ${ticker} at $${stock.price}:
- **Market Context**: Where is this stock in broader trend?
- **Key Levels**: Support/Resistance to watch
- **Setup**: What's the technical setup right now?
- **Trade Plan**: Best entry, targets, and risk management
- **Catalysts**: Any news or events to watch?
Keep it concise but actionable, 5-7 sentences max.`;
      const aiText = await callAI(deepPrompt);
      document.getElementById('aiDeepDive').textContent = aiText;

      document.getElementById('searchInput').value = '';
    }

    // ===== CHARTING =====
    function renderChart(ticker) {
      document.getElementById('chartContainer').innerHTML = '';
      new TradingView.widget({
        "container_id": "chartContainer",
        "width": "100%",
        "height": "100%",
        "symbol": ticker,
        "interval": currentChartInterval,
        "timezone": "America/New_York",
        "theme": "dark",
        "style": "1",
        "toolbar_bg": "#1a1f2e",
        "withdateranges": true,
        "hide_side_toolbar": false,
        "allow_symbol_change": true,
        "save_image": true,
        "studies": ["BB@tv-basicstudies", "RSI@tv-basicstudies", "MACD@tv-basicstudies"]
      });
    }

    function setChartInterval(interval) {
      currentChartInterval = interval;
      document.querySelectorAll('.chart-btn').forEach(b => b.classList.remove('active'));
      event.target.classList.add('active');
      renderChart(currentResearchSymbol);
    }

    // ===== AI CALLS =====
    async function callAI(prompt) {
      try {
        const res = await fetch(`${BACKEND_URL}/api/ai-analyze`, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({
            model: 'sonar',
            messages: [{role: 'user', content: prompt}],
            temperature: 0.3,
            max_tokens: 600
          })
        });
        if (!res.ok) return 'Error: ' + res.status;
        const data = await res.json();
        return data.choices?.[0]?.message?.content || 'No response';
      } catch (e) {
        return 'Connection error: ' + e.message;
      }
    }

    // ===== AI CHAT =====
    function toggleChat() {
      const widget = document.getElementById('chatWidget');
      const toggle = document.getElementById('chatToggle');
      widget.classList.toggle('active');
      toggle.classList.toggle('hidden');
    }

    async function sendChat() {
      const inp = document.getElementById('chatInput');
      const msg = inp.value.trim();
      if (!msg) return;

      const box = document.getElementById('chatMessages');
      box.innerHTML += `<div class="message user">${msg}</div>`;
      inp.value = '';
      box.scrollTop = box.scrollHeight;

      const aiResp = await callAI(msg);
      box.innerHTML += `<div class="message ai">${aiResp}</div>`;
      box.scrollTop = box.scrollHeight;
    }
  </script>
</body>
</html>

version 5
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Elite Trading Pro</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <script src="https://s3.tradingview.com/tv.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --dark-bg: #0F1419;
      --card-bg: #1a1f2e;
      --secondary-bg: #232f47;
      --accent: #00d4ff;
      --success: #00c896;
      --danger: #ff4757;
      --text-primary: #ffffff;
      --text-secondary: #b0b8c1;
      --border: #2a3446;
    }

    body {
      background: var(--dark-bg);
      color: var(--text-primary);
      font-family: 'Courier New', monospace;
      overflow-x: hidden;
    }

    /* ============ HEADER ============ */
    .header {
      background: rgba(26, 31, 46, 0.95);
      backdrop-filter: blur(10px);
      border-bottom: 2px solid var(--accent);
      padding: 1rem 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.8rem;
      font-size: 1.4em;
      font-weight: 900;
      color: var(--accent);
      cursor: pointer;
      letter-spacing: 2px;
    }

    .header-search {
      flex: 1;
      max-width: 450px;
      margin: 0 2rem;
    }

    .search-bar {
      display: flex;
      align-items: center;
      background: var(--card-bg);
      border: 2px solid var(--border);
      border-radius: 8px;
      padding: 0.7rem 1rem;
      gap: 0.5rem;
    }

    .search-bar:focus-within {
      border-color: var(--accent);
      box-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
    }

    .search-bar input {
      flex: 1;
      background: transparent;
      border: none;
      color: var(--text-primary);
      outline: none;
      font-family: 'Courier New', monospace;
      font-weight: 600;
    }

    .search-bar button {
      background: var(--accent);
      border: none;
      color: var(--dark-bg);
      padding: 0.6rem 1.2rem;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 700;
      transition: all 0.3s;
    }

    .search-bar button:hover {
      background: #00b8d4;
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);
    }

    .header-actions {
      display: flex;
      gap: 1rem;
    }

    .header-btn {
      background: transparent;
      border: 2px solid var(--border);
      color: var(--text-secondary);
      padding: 0.6rem 1.2rem;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 700;
      font-family: 'Courier New', monospace;
    }

    .header-btn:hover {
      border-color: var(--accent);
      color: var(--accent);
      box-shadow: 0 0 15px rgba(0, 212, 255, 0.2);
    }

    /* ============ MAIN LAYOUT ============ */
    .research-layout {
      display: grid;
      grid-template-columns: 1fr 380px;
      gap: 1rem;
      padding: 1rem;
      height: calc(100vh - 80px);
    }

    .research-main {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      overflow-y: auto;
    }

    /* ============ HEADER SECTION ============ */
    .research-header {
      background: linear-gradient(135deg, #1a2a40 0%, #1a2540 100%);
      border: 2px solid var(--accent);
      padding: 1.5rem;
      border-radius: 10px;
      display: flex;
      justify-content: space-between;
      align-items: start;
    }

    .research-title-group {
      display: flex;
      align-items: center;
      gap: 2rem;
    }

    .research-symbol {
      font-size: 3.5em;
      font-weight: 900;
      color: var(--text-primary);
      letter-spacing: 2px;
    }

    .research-price-box {
      text-align: right;
    }

    .research-price {
      font-size: 2.8em;
      color: var(--accent);
      font-weight: 900;
    }

    .research-change {
      font-size: 1.3em;
      margin-top: 0.3rem;
      font-weight: 700;
    }

    .research-change.positive {
      color: var(--success);
    }

    .research-change.negative {
      color: var(--danger);
    }

    .research-quick-metrics {
      display: flex;
      gap: 1.2rem;
    }

    .quick-metric {
      background: rgba(0, 212, 255, 0.1);
      border: 1px solid var(--accent);
      padding: 0.8rem 1.2rem;
      border-radius: 8px;
      text-align: center;
    }

    .quick-metric-label {
      font-size: 0.75em;
      color: var(--text-secondary);
      text-transform: uppercase;
      font-weight: 600;
    }

    .quick-metric-value {
      font-size: 1.4em;
      color: var(--accent);
      font-weight: 900;
      margin-top: 0.3rem;
    }

    /* ============ DUAL CHARTS SECTION ============ */
    .charts-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    .chart-box {
      background: var(--card-bg);
      border: 2px solid var(--border);
      border-radius: 10px;
      padding: 1rem;
      display: flex;
      flex-direction: column;
    }

    .chart-box-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.8rem;
      padding-bottom: 0.8rem;
      border-bottom: 1px solid var(--border);
    }

    .chart-timeframe {
      font-size: 1.2em;
      font-weight: 900;
      color: var(--accent);
      letter-spacing: 1px;
    }

    .chart-studies-toggle {
      display: flex;
      gap: 0.4rem;
    }

    .study-btn {
      padding: 0.4rem 0.8rem;
      background: var(--secondary-bg);
      border: 1px solid var(--border);
      color: var(--text-secondary);
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.75em;
      font-weight: 600;
      transition: all 0.2s;
    }

    .study-btn:hover,
    .study-btn.active {
      background: var(--accent);
      color: var(--dark-bg);
      border-color: var(--accent);
    }

    .chart-container {
      flex: 1;
      min-height: 400px;
      background: var(--secondary-bg);
      border-radius: 8px;
      overflow: hidden;
    }

    /* ============ METRICS SIDEBAR ============ */
    .metrics-sidebar {
      background: var(--card-bg);
      border: 2px solid var(--border);
      border-radius: 10px;
      padding: 1.2rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      overflow-y: auto;
    }

    .metrics-title {
      font-size: 1.1em;
      font-weight: 900;
      color: var(--accent);
      letter-spacing: 1px;
      border-bottom: 2px solid var(--accent);
      padding-bottom: 0.8rem;
    }

    .metric-item {
      background: rgba(0, 212, 255, 0.05);
      border: 1px solid var(--border);
      padding: 1rem;
      border-radius: 8px;
    }

    .metric-label {
      font-size: 0.8em;
      color: var(--text-secondary);
      text-transform: uppercase;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    .metric-value {
      font-size: 1.6em;
      color: var(--accent);
      font-weight: 900;
    }

    /* ============ COMMENTARY SECTION ============ */
    .commentary-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    .commentary-box {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 1.5rem;
    }

    .commentary-title {
      font-size: 1.1em;
      color: var(--accent);
      margin-bottom: 1rem;
      font-weight: 900;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .commentary-text {
      line-height: 1.8;
      color: var(--text-secondary);
      font-size: 0.95em;
    }

    .commentary-list {
      list-style: none;
    }

    .commentary-list li {
      padding: 0.7rem 0;
      color: var(--text-secondary);
      border-bottom: 1px solid var(--border);
      font-size: 0.95em;
    }

    .commentary-list li:last-child {
      border-bottom: none;
    }

    .commentary-list strong {
      color: var(--success);
      font-weight: 900;
    }

    /* ============ AI CHAT (PROMINENT) ============ */
    .ai-chat-sidebar {
      position: fixed;
      right: 0;
      top: 80px;
      width: 420px;
      height: calc(100vh - 80px);
      background: linear-gradient(180deg, var(--card-bg) 0%, var(--secondary-bg) 100%);
      border-left: 3px solid var(--accent);
      display: flex;
      flex-direction: column;
      z-index: 90;
      box-shadow: -4px 0 20px rgba(0, 0, 0, 0.5);
      transform: translateX(0);
      transition: transform 0.3s;
    }

    .ai-chat-sidebar.hidden {
      transform: translateX(100%);
    }

    .ai-chat-header {
      background: linear-gradient(135deg, var(--accent) 0%, #00b8d4 100%);
      color: var(--dark-bg);
      padding: 1.5rem;
      font-weight: 900;
      font-size: 1.2em;
      display: flex;
      justify-content: space-between;
      align-items: center;
      letter-spacing: 1px;
    }

    .ai-chat-header button {
      background: none;
      border: none;
      color: var(--dark-bg);
      font-size: 1.4em;
      cursor: pointer;
      font-weight: 900;
    }

    .ai-messages {
      flex: 1;
      overflow-y: auto;
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 1.2rem;
    }

    .message {
      padding: 1.2rem;
      border-radius: 10px;
      word-wrap: break-word;
      font-size: 0.9em;
      line-height: 1.7;
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .message.user {
      align-self: flex-end;
      background: linear-gradient(135deg, var(--accent) 0%, #00b8d4 100%);
      color: var(--dark-bg);
      border-radius: 10px 2px 10px 10px;
      max-width: 85%;
      font-weight: 600;
    }

    .message.ai {
      align-self: flex-start;
      background: rgba(0, 212, 255, 0.1);
      color: var(--text-secondary);
      border: 1px solid var(--accent);
      border-radius: 2px 10px 10px 10px;
      max-width: 95%;
    }

    .ai-input-area {
      display: flex;
      gap: 0.8rem;
      padding: 1.5rem;
      background: rgba(0, 0, 0, 0.3);
      border-top: 2px solid var(--border);
    }

    .ai-input-area input {
      flex: 1;
      background: var(--secondary-bg);
      border: 2px solid var(--border);
      color: var(--text-primary);
      padding: 0.9rem;
      border-radius: 8px;
      outline: none;
      font-family: 'Courier New', monospace;
      font-weight: 600;
      transition: border-color 0.3s;
    }

    .ai-input-area input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 15px rgba(0, 212, 255, 0.2);
    }

    .ai-input-area button {
      background: linear-gradient(135deg, var(--accent) 0%, #00b8d4 100%);
      border: none;
      color: var(--dark-bg);
      padding: 0.9rem 1.8rem;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 900;
      transition: all 0.3s;
    }

    .ai-input-area button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(0, 212, 255, 0.4);
    }

    .ai-toggle {
      position: fixed;
      right: 20px;
      bottom: 30px;
      width: 70px;
      height: 70px;
      background: linear-gradient(135deg, var(--accent) 0%, #00b8d4 100%);
      border: none;
      border-radius: 50%;
      color: var(--dark-bg);
      font-size: 1.8em;
      cursor: pointer;
      box-shadow: 0 8px 30px rgba(0, 212, 255, 0.5);
      transition: all 0.3s;
      z-index: 85;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 900;
    }

    .ai-toggle:hover {
      transform: scale(1.15);
      box-shadow: 0 12px 40px rgba(0, 212, 255, 0.6);
    }

    .ai-toggle.hidden {
      opacity: 0;
      pointer-events: none;
    }

    /* ============ RESPONSIVE ============ */
    @media (max-width: 1400px) {
      .charts-section {
        grid-template-columns: 1fr;
      }

      .ai-chat-sidebar {
        width: 100%;
        height: 400px;
        top: auto;
        bottom: 0;
        border-left: none;
        border-top: 3px solid var(--accent);
      }

      .research-layout {
        grid-template-columns: 1fr;
        height: auto;
      }
    }

    @media (max-width: 768px) {
      .research-header {
        flex-direction: column;
      }

      .research-title-group {
        gap: 1rem;
        margin-bottom: 1rem;
      }

      .ai-chat-sidebar {
        display: none;
      }

      .ai-toggle {
        display: flex;
      }
    }
  </style>
</head>

<body>
  <!-- ============ HEADER ============ -->
  <div class="header">
    <div class="logo" onclick="goHome()">
      <i class="fas fa-chart-line"></i>
      <span>ELITE</span>
    </div>
    <div class="header-search">
      <div class="search-bar">
        <i class="fas fa-search"></i>
        <input type="text" id="searchInput" placeholder="Search ticker..." onkeypress="if(event.key==='Enter') researchStock()">
        <button onclick="researchStock()">RESEARCH</button>
      </div>
    </div>
    <div class="header-actions">
      <button class="header-btn" onclick="goHome()">üìä DASHBOARD</button>
    </div>
  </div>

  <!-- ============ RESEARCH PAGE ============ -->
  <div class="research-layout" id="researchLayout" style="display: none;">
    <div class="research-main">
      <!-- Header -->
      <div class="research-header">
        <div class="research-title-group">
          <div class="research-symbol" id="researchSymbol">TICKER</div>
          <div class="research-price-box">
            <div class="research-price" id="researchPrice">$0.00</div>
            <div class="research-change" id="researchChange">+0.00%</div>
          </div>
        </div>
        <div class="research-quick-metrics" id="quickMetrics"></div>
      </div>

      <!-- Dual Charts -->
      <div class="charts-section">
        <!-- 1D Chart -->
        <div class="chart-box">
          <div class="chart-box-header">
            <div class="chart-timeframe">1D CHART</div>
            <div class="chart-studies-toggle">
              <button class="study-btn active" onclick="toggleStudy('1D', 'BB')">BB</button>
              <button class="study-btn active" onclick="toggleStudy('1D', 'MACD')">MACD</button>
              <button class="study-btn active" onclick="toggleStudy('1D', 'RSI')">RSI</button>
              <button class="study-btn active" onclick="toggleStudy('1D', 'STOCH')">STOCH</button>
            </div>
          </div>
          <div class="chart-container" id="chart1D"></div>
        </div>

        <!-- 1W Chart -->
        <div class="chart-box">
          <div class="chart-box-header">
            <div class="chart-timeframe">1W CHART</div>
            <div class="chart-studies-toggle">
              <button class="study-btn active" onclick="toggleStudy('1W', 'BB')">BB</button>
              <button class="study-btn active" onclick="toggleStudy('1W', 'MACD')">MACD</button>
              <button class="study-btn active" onclick="toggleStudy('1W', 'RSI')">RSI</button>
              <button class="study-btn active" onclick="toggleStudy('1W', 'STOCH')">STOCH</button>
            </div>
          </div>
          <div class="chart-container" id="chart1W"></div>
        </div>
      </div>

      <!-- Commentary -->
      <div class="commentary-section">
        <div class="commentary-box">
          <div class="commentary-title"><i class="fas fa-lightbulb"></i> TECHNICAL SETUP</div>
          <div class="commentary-text" id="technicalComment">Loading...</div>
        </div>
        <div class="commentary-box">
          <div class="commentary-title"><i class="fas fa-target"></i> ENTRY & TARGETS</div>
          <ul class="commentary-list" id="entryTargets">
            <li>Loading...</li>
          </ul>
        </div>
      </div>

      <!-- AI Analysis -->
      <div class="commentary-box">
        <div class="commentary-title"><i class="fas fa-brain"></i> AI DEEP DIVE</div>
        <div class="commentary-text" id="aiDeepDive">Generating analysis...</div>
      </div>

      <!-- Back Button -->
      <button class="header-btn" onclick="goHome()" style="width: 100%; padding: 1rem; font-size: 1.1em; margin-bottom: 1rem;">
        ‚Üê BACK TO DASHBOARD
      </button>
    </div>

    <!-- ============ METRICS SIDEBAR ============ -->
    <div class="metrics-sidebar">
      <div class="metrics-title">üìä METRICS</div>
      <div id="metricsSidebar"></div>
    </div>
  </div>

  <!-- ============ HOME PAGE ============ -->
  <div id="homePage">
    <!-- Content will load here -->
  </div>

  <!-- ============ AI CHAT SIDEBAR ============ -->
  <div class="ai-chat-sidebar" id="aiChatSidebar">
    <div class="ai-chat-header">
      <span><i class="fas fa-robot"></i> AI TRADING</span>
      <button onclick="toggleAIChat()">‚àí</button>
    </div>
    <div class="ai-messages" id="aiMessages"></div>
    <div class="ai-input-area">
      <input type="text" id="aiInput" placeholder="Ask AI..." onkeypress="if(event.key==='Enter') sendAIMessage()">
      <button onclick="sendAIMessage()"><i class="fas fa-paper-plane"></i></button>
    </div>
  </div>

  <button class="ai-toggle" id="aiToggle" onclick="toggleAIChat()">
    <i class="fas fa-comments"></i>
  </button>

  <!-- ============ JAVASCRIPT ============ -->
  <script>
    const BACKEND_URL = 'https://elite-trading-with-exclusive-ip.onrender.com';
    const WATCHLIST = [
      {symbol:'MU',price:201.37,change:-10.87,meanRev:-2.47,rsi:41.24,regime:75.6,inst33:53,signal:"STRONG BUY",target1:220,target2:235,stop:190,volume:"47.3M",iv:"38.2%"},
      {symbol:'SE',price:130.99,change:-8.74,meanRev:-2.46,rsi:27.72,regime:51.7,inst33:38,signal:"ACCUMULATE",target1:150,target2:165,stop:120,volume:"31.2M",iv:"42.1%"},
      {symbol:'RIVN',price:14.66,change:-0.41,meanRev:-1.75,rsi:58.91,regime:99.1,inst33:65,signal:"BUY",target1:22,target2:25,stop:13,volume:"203M",iv:"85.3%"},
      {symbol:'EA',price:201.12,change:-0.23,meanRev:-1.74,rsi:46.82,regime:64.7,inst33:53,signal:"MONITOR",target1:210,target2:225,stop:190,volume:"1.8M",iv:"21.5%"},
      {symbol:'LULU',price:164.69,change:-0.82,meanRev:-1.49,rsi:49.1,regime:28.2,inst33:58,signal:"MONITOR",target1:180,target2:200,stop:155,volume:"2.1M",iv:"26.4%"},
    ];

    let currentSymbol = null;

    window.addEventListener('load', () => {
      goHome();
    });

    function goHome() {
      document.getElementById('researchLayout').style.display = 'none';
      document.getElementById('homePage').innerHTML = `
        <div style="padding: 2rem; text-align: center;">
          <h1 style="font-size: 3em; color: var(--accent); margin-bottom: 2rem; letter-spacing: 2px;">ELITE TRADING</h1>
          <p style="font-size: 1.2em; color: var(--text-secondary); margin-bottom: 2rem;">Search any ticker or click on a stock to research</p>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem;">
            ${WATCHLIST.map(s => `
              <div onclick="researchStock('${s.symbol}')" style="background: var(--card-bg); border: 2px solid var(--border); padding: 1.5rem; border-radius: 10px; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.borderColor='var(--accent)'" onmouseout="this.style.borderColor='var(--border)'">
                <div style="font-size: 2em; font-weight: 900; color: var(--text-primary); letter-spacing: 1px;">${s.symbol}</div>
                <div style="font-size: 1.8em; color: var(--accent); font-weight: 900; margin: 0.5rem 0;">$${s.price}</div>
                <div style="font-size: 1em; color: ${s.change >= 0 ? 'var(--success)' : 'var(--danger)'}; font-weight: 700;">${s.change >= 0 ? '+' : ''}${s.change}%</div>
              </div>
            `).join('')}
          </div>
        </div>
      `;
      currentSymbol = null;
    }

    async function researchStock(ticker) {
      if (!ticker) {
        ticker = document.getElementById('searchInput').value.toUpperCase().trim();
      }
      if (!ticker) return;

      currentSymbol = ticker;
      document.getElementById('homePage').style.display = 'none';
      document.getElementById('researchLayout').style.display = 'grid';

      let stock = WATCHLIST.find(s => s.symbol === ticker);
      if (!stock) {
        stock = {
          symbol: ticker,
          price: 'Loading...',
          change: 0,
          meanRev: 0,
          rsi: 0,
          regime: 0,
          inst33: 0,
          target1: 0,
          target2: 0,
          stop: 0,
          volume: 'N/A',
          iv: 'N/A'
        };
      }

      document.getElementById('researchSymbol').textContent = ticker;
      document.getElementById('researchPrice').textContent = `$${stock.price}`;
      document.getElementById('researchChange').textContent = `${stock.change > 0 ? '+' : ''}${stock.change}%`;
      document.getElementById('researchChange').classList = stock.change >= 0 ? 'research-change positive' : 'research-change negative';

      const quickMetricsHtml = `
        <div class="quick-metric">
          <div class="quick-metric-label">RSI</div>
          <div class="quick-metric-value">${stock.rsi}</div>
        </div>
        <div class="quick-metric">
          <div class="quick-metric-label">MEAN REV</div>
          <div class="quick-metric-value">${stock.meanRev}</div>
        </div>
        <div class="quick-metric">
          <div class="quick-metric-label">REGIME</div>
          <div class="quick-metric-value">${stock.regime}%</div>
        </div>
      `;
      document.getElementById('quickMetrics').innerHTML = quickMetricsHtml;

      const metricsHtml = `
        <div class="metric-item">
          <div class="metric-label">Mean Reversion</div>
          <div class="metric-value">${stock.meanRev}</div>
        </div>
        <div class="metric-item">
          <div class="metric-label">Regime Detection</div>
          <div class="metric-value">${stock.regime}%</div>
        </div>
        <div class="metric-item">
          <div class="metric-label">Inst 33 Score</div>
          <div class="metric-value">${stock.inst33}</div>
        </div>
        <div class="metric-item">
          <div class="metric-label">Volume</div>
          <div class="metric-value">${stock.volume}</div>
        </div>
        <div class="metric-item">
          <div class="metric-label">Implied Vol</div>
          <div class="metric-value">${stock.iv}</div>
        </div>
        <div class="metric-item">
          <div class="metric-label">Signal</div>
          <div class="metric-value" style="color: var(--success);">${stock.signal}</div>
        </div>
      `;
      document.getElementById('metricsSidebar').innerHTML = metricsHtml;

      renderCharts(ticker);

      const technicalPrompt = `SHORT 2-sentence technical analysis for ${ticker} at $${stock.price} with RSI ${stock.rsi}, Mean Rev ${stock.meanRev}. Support/Resistance, momentum.`;
      const technicalText = await callAI(technicalPrompt);
      document.getElementById('technicalComment').textContent = technicalText;

      document.getElementById('entryTargets').innerHTML = `
        <li><strong>ENTRY:</strong> $${stock.price.toFixed(2)}</li>
        <li><strong>T1 (5%):</strong> $${stock.target1}</li>
        <li><strong>T2 (10%):</strong> $${stock.target2}</li>
        <li><strong>STOP:</strong> $${stock.stop}</li>
      `;

      const deepPrompt = `Comprehensive trading analysis for ${ticker} at $${stock.price}:
- Market Context
- Key Levels
- Technical Setup
- Trade Plan
Keep it 5-7 sentences, actionable.`;
      const aiText = await callAI(deepPrompt);
      document.getElementById('aiDeepDive').textContent = aiText;

      document.getElementById('searchInput').value = '';
      
      toggleAIChat(true);
    }

    function renderCharts(ticker) {
      document.getElementById('chart1D').innerHTML = '';
      document.getElementById('chart1W').innerHTML = '';

      // 1D Chart
      new TradingView.widget({
        "container_id": "chart1D",
        "width": "100%",
        "height": "100%",
        "symbol": ticker,
        "interval": "1",
        "timezone": "America/New_York",
        "theme": "dark",
        "style": "1",
        "toolbar_bg": "#1a1f2e",
        "withdateranges": true,
        "hide_side_toolbar": false,
        "allow_symbol_change": false,
        "save_image": true,
        "studies": ["BB@tv-basicstudies", "MACD@tv-basicstudies", "RSI@tv-basicstudies", "Stoch@tv-basicstudies", "Vol@tv-basicstudies"],
        "drawings_access": {"type": "black", "tools": [{"name": "Trend Line"}]}
      });

      // 1W Chart
      new TradingView.widget({
        "container_id": "chart1W",
        "width": "100%",
        "height": "100%",
        "symbol": ticker,
        "interval": "W",
        "timezone": "America/New_York",
        "theme": "dark",
        "style": "1",
        "toolbar_bg": "#1a1f2e",
        "withdateranges": true,
        "hide_side_toolbar": false,
        "allow_symbol_change": false,
        "save_image": true,
        "studies": ["BB@tv-basicstudies", "MACD@tv-basicstudies", "RSI@tv-basicstudies", "Stoch@tv-basicstudies"],
        "drawings_access": {"type": "black", "tools": [{"name": "Trend Line"}]}
      });
    }

    function toggleStudy(timeframe, study) {
      // Placeholder for future study toggle functionality
      event.target.classList.toggle('active');
    }

    async function callAI(prompt) {
      try {
        const res = await fetch(`${BACKEND_URL}/api/ai-analyze`, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({
            model: 'sonar',
            messages: [{role: 'user', content: prompt}],
            temperature: 0.3,
            max_tokens: 600
          })
        });
        if (!res.ok) return `Error: ${res.status}`;
        const data = await res.json();
        return data.choices?.[0]?.message?.content || 'No response';
      } catch (e) {
        return `Error: ${e.message}`;
      }
    }

    function toggleAIChat(force = null) {
      const sidebar = document.getElementById('aiChatSidebar');
      const toggle = document.getElementById('aiToggle');
      
      if (force === true) {
        sidebar.classList.remove('hidden');
        toggle.classList.add('hidden');
      } else if (force === false) {
        sidebar.classList.add('hidden');
        toggle.classList.remove('hidden');
      } else {
        sidebar.classList.toggle('hidden');
        toggle.classList.toggle('hidden');
      }
    }

    async function sendAIMessage() {
      const inp = document.getElementById('aiInput');
      const msg = inp.value.trim();
      if (!msg) return;

      const box = document.getElementById('aiMessages');
      box.innerHTML += `<div class="message user">${msg}</div>`;
      inp.value = '';
      box.scrollTop = box.scrollHeight;

      const aiResp = await callAI(msg);
      box.innerHTML += `<div class="message ai">${aiResp}</div>`;
      box.scrollTop = box.scrollHeight;
    }

    function researchStock() {
      const ticker = document.getElementById('searchInput').value.toUpperCase().trim();
      if (ticker) researchStock(ticker);
    }
  </script>
</body>
</html>
