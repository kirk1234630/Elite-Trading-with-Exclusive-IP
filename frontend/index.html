!-- DAILY NEWSLETTER & LANDING PAGE TEMPLATE -->
<!-- Add this to your index.html or create newsletter.html -->

<div id="newsletterContainer" style="background: linear-gradient(135deg, #1a1a3e 0%, #16213e 50%, #0f3460 100%); color: #fff; padding: 2rem; border-radius: 12px; margin: 2rem 0;">
    
    <!-- MARKET BRIEF HEADER -->
    <div style="background: rgba(0,212,255,0.05); padding: 1.5rem; border-radius: 12px; border-left: 4px solid #00d4ff; margin-bottom: 2rem;">
        <h2 style="color: #00d4ff; margin: 0 0 0.5rem 0;">üìä DAILY MARKET BRIEF</h2>
        <div id="marketBriefText" style="font-size: 0.95em; color: #b0b8c1; line-height: 1.8;"></div>
    </div>

    <!-- THREE-COLUMN ANALYSIS SECTION -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; margin-bottom: 2rem;">
        
        <!-- COLUMN 1: VALUE SCREENING -->
        <div style="background: rgba(26,26,64,0.8); padding: 1.5rem; border-radius: 12px; border-top: 3px solid #f59e0b;">
            <h3 style="color: #f59e0b; margin-top: 0;">üíé VALUE SCREENING</h3>
            <p style="color: #b0b8c1; font-size: 0.9em; margin: 0.5rem 0;">Large-caps within 10% of 52-week lows | P/E ‚â§ 10</p>
            
            <div id="valueStocksContainer" style="margin-top: 1rem;">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>

        <!-- COLUMN 2: MOMENTUM ANALYSIS -->
        <div style="background: rgba(26,26,64,0.8); padding: 1.5rem; border-radius: 12px; border-top: 3px solid #10b981;">
            <h3 style="color: #10b981; margin-top: 0;">üìà MOMENTUM LEADERS</h3>
            <p style="color: #b0b8c1; font-size: 0.9em; margin: 0.5rem 0;">Top 5-day performers | Heavy volume confirmation</p>
            
            <div id="momentumStocksContainer" style="margin-top: 1rem;">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>

        <!-- COLUMN 3: HOTTEST STOCKS -->
        <div style="background: rgba(26,26,64,0.8); padding: 1.5rem; border-radius: 12px; border-top: 3px solid #ef4444;">
            <h3 style="color: #ef4444; margin-top: 0;">üî• INSTITUTIONAL HOTTEST</h3>
            <p style="color: #b0b8c1; font-size: 0.9em; margin: 0.5rem 0;">Highest institutional buying pressure | Score 0-100</p>
            
            <div id="hottestStocksContainer" style="margin-top: 1rem;">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>

    </div>

    <!-- KEY OVERLAPS (CONSENSUS SIGNALS) -->
    <div style="background: rgba(124,58,237,0.05); padding: 1.5rem; border-radius: 12px; border-left: 4px solid #7c3aed; margin-bottom: 2rem;">
        <h3 style="color: #7c3aed; margin-top: 0;">‚úÖ CONSENSUS SIGNALS</h3>
        <div id="consensusSignalsContainer" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
            <!-- Will be populated by JavaScript -->
        </div>
    </div>

    <!-- TOP RECOMMENDATIONS -->
    <div style="background: rgba(16,185,129,0.05); padding: 1.5rem; border-radius: 12px; border-left: 4px solid #10b981;">
        <h3 style="color: #10b981; margin-top: 0;">üéØ TOP RECOMMENDATIONS</h3>
        <div id="topRecommendationsContainer" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
            <!-- Will be populated by JavaScript -->
        </div>
    </div>

</div>

<!-- JAVASCRIPT LOADER -->
<script>
async function loadNewsletterAnalysis() {
    try {
        // Fetch combined analysis
        const response = await fetch('/api/newsletter/combined-analysis');
        if (!response.ok) throw new Error('Failed to load newsletter');
        
        const data = await response.json();
        
        // ======================== VALUE STOCKS ========================
        let valueHtml = '';
        if (data.value_screening && data.value_screening.length > 0) {
            data.value_screening.forEach(stock => {
                valueHtml += `
                    <div style="background: rgba(0,0,0,0.3); padding: 0.8rem; border-radius: 8px; margin-bottom: 0.8rem; cursor: pointer; transition: all 0.3s;" 
                         onmouseover="this.style.background='rgba(245,158,11,0.1)'" 
                         onmouseout="this.style.background='rgba(0,0,0,0.3)'"
                         onclick="researchStock('${stock.ticker}')">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <strong style="color: #f59e0b; font-size: 1.1em;">${stock.ticker}</strong>
                            <span style="color: #10b981; font-weight: bold;">$${stock.price}</span>
                        </div>
                        <div style="font-size: 0.85em; color: #b0b8c1; margin-top: 0.3rem;">
                            P/E: ${stock.pe_ratio} | ${stock.percent_above_low}% above low<br>
                            ${stock.sector}
                        </div>
                    </div>
                `;
            });
        } else {
            valueHtml = '<div style="color: #b0b8c1; font-size: 0.9em;">No value stocks identified this period</div>';
        }
        document.getElementById('valueStocksContainer').innerHTML = valueHtml;
        
        // ======================== MOMENTUM STOCKS ========================
        let momentumHtml = '';
        if (data.momentum_analysis && data.momentum_analysis.length > 0) {
            data.momentum_analysis.forEach(stock => {
                const roiColor = stock.roc_5day > 0 ? '#10b981' : '#ef4444';
                momentumHtml += `
                    <div style="background: rgba(0,0,0,0.3); padding: 0.8rem; border-radius: 8px; margin-bottom: 0.8rem; cursor: pointer; transition: all 0.3s;"
                         onmouseover="this.style.background='rgba(16,185,129,0.1)'"
                         onmouseout="this.style.background='rgba(0,0,0,0.3)'"
                         onclick="researchStock('${stock.ticker}')">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <strong style="color: #10b981; font-size: 1.1em;">${stock.ticker}</strong>
                            <span style="color: ${roiColor}; font-weight: bold; font-size: 1.05em;">${stock.roc_5day > 0 ? '+' : ''}${stock.roc_5day}%</span>
                        </div>
                        <div style="font-size: 0.85em; color: #b0b8c1; margin-top: 0.3rem;">
                            Price: $${stock.current_price} | Vol: ${(stock.volume/1e6).toFixed(1)}M<br>
                            ${stock.signal}
                        </div>
                    </div>
                `;
            });
        }
        document.getElementById('momentumStocksContainer').innerHTML = momentumHtml;
        
        // ======================== HOTTEST STOCKS ========================
        let hottestHtml = '';
        if (data.hottest_stocks && data.hottest_stocks.length > 0) {
            data.hottest_stocks.forEach(stock => {
                const scoreColor = stock.total_score >= 80 ? '#ef4444' : stock.total_score >= 60 ? '#f59e0b' : '#10b981';
                hottestHtml += `
                    <div style="background: rgba(0,0,0,0.3); padding: 0.8rem; border-radius: 8px; margin-bottom: 0.8rem; cursor: pointer; transition: all 0.3s;"
                         onmouseover="this.style.background='rgba(239,68,68,0.1)'"
                         onmouseout="this.style.background='rgba(0,0,0,0.3)'"
                         onclick="researchStock('${stock.ticker}')">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <strong style="color: #ef4444; font-size: 1.1em;">${stock.ticker}</strong>
                            <span style="background: ${scoreColor}; color: #fff; padding: 0.2rem 0.6rem; border-radius: 4px; font-weight: bold; font-size: 0.9em;">${stock.total_score}</span>
                        </div>
                        <div style="font-size: 0.85em; color: #b0b8c1; margin-top: 0.3rem;">
                            Momentum: ${stock.momentum}/25 | Volume: ${stock.volume}/25<br>
                            <strong style="color: ${scoreColor};">${stock.signal}</strong>
                        </div>
                    </div>
                `;
            });
        }
        document.getElementById('hottestStocksContainer').innerHTML = hottestHtml;
        
        // ======================== CONSENSUS SIGNALS ========================
        let consensusHtml = `
            <div style="background: rgba(124,58,237,0.1); padding: 1rem; border-radius: 8px;">
                <strong style="color: #7c3aed;">Value + Momentum</strong><br>
                <span style="color: #10b981; font-size: 1.2em; font-weight: bold;">${data.key_overlaps.value_and_momentum.length}</span>
                <div style="font-size: 0.85em; color: #b0b8c1;">${data.key_overlaps.value_and_momentum.slice(0, 3).join(', ')}</div>
            </div>
            <div style="background: rgba(124,58,237,0.1); padding: 1rem; border-radius: 8px;">
                <strong style="color: #7c3aed;">Value + Hottest</strong><br>
                <span style="color: #10b981; font-size: 1.2em; font-weight: bold;">${data.key_overlaps.value_and_hottest.length}</span>
                <div style="font-size: 0.85em; color: #b0b8c1;">${data.key_overlaps.value_and_hottest.slice(0, 3).join(', ')}</div>
            </div>
            <div style="background: rgba(124,58,237,0.1); padding: 1rem; border-radius: 8px;">
                <strong style="color: #7c3aed;">‚≠ê ALL THREE (STRONGEST)</strong><br>
                <span style="color: #ef4444; font-size: 1.2em; font-weight: bold;">${data.key_overlaps.all_three.length}</span>
                <div style="font-size: 0.85em; color: #10b981; font-weight: bold;">${data.key_overlaps.all_three.slice(0, 5).join(', ') || 'None today'}</div>
            </div>
        `;
        document.getElementById('consensusSignalsContainer').innerHTML = consensusHtml;
        
        // ======================== TOP RECOMMENDATIONS ========================
        let recsHtml = '';
        
        if (data.top_recommendations.value_pick) {
            recsHtml += `
                <div style="background: rgba(245,158,11,0.1); padding: 1rem; border-radius: 8px; border-left: 3px solid #f59e0b; cursor: pointer;"
                     onclick="researchStock('${data.top_recommendations.value_pick.ticker}')">
                    <strong style="color: #f59e0b;">üíé VALUE PICK</strong><br>
                    <div style="font-size: 1.3em; color: #fff; margin: 0.5rem 0; font-weight: bold;">${data.top_recommendations.value_pick.ticker}</div>
                    <div style="color: #b0b8c1; font-size: 0.9em;">
                        Price: $${data.top_recommendations.value_pick.price}<br>
                        P/E: ${data.top_recommendations.value_pick.pe_ratio}<br>
                        Action: <span style="color: #10b981;">BUY</span>
                    </div>
                </div>
            `;
        }
        
        if (data.top_recommendations.momentum_pick) {
            recsHtml += `
                <div style="background: rgba(16,185,129,0.1); padding: 1rem; border-radius: 8px; border-left: 3px solid #10b981; cursor: pointer;"
                     onclick="researchStock('${data.top_recommendations.momentum_pick.ticker}')">
                    <strong style="color: #10b981;">üìà MOMENTUM PICK</strong><br>
                    <div style="font-size: 1.3em; color: #fff; margin: 0.5rem 0; font-weight: bold;">${data.top_recommendations.momentum_pick.ticker}</div>
                    <div style="color: #b0b8c1; font-size: 0.9em;">
                        5-Day ROC: ${data.top_recommendations.momentum_pick.roc_5day}%<br>
                        Volume: Strong<br>
                        Action: <span style="color: #10b981;">ENTER</span>
                    </div>
                </div>
            `;
        }
        
        if (data.top_recommendations.hottest_pick) {
            recsHtml += `
                <div style="background: rgba(239,68,68,0.1); padding: 1rem; border-radius: 8px; border-left: 3px solid #ef4444; cursor: pointer;"
                     onclick="researchStock('${data.top_recommendations.hottest_pick.ticker}')">
                    <strong style="color: #ef4444;">üî• INSTITUTIONAL HOTTEST</strong><br>
                    <div style="font-size: 1.3em; color: #fff; margin: 0.5rem 0; font-weight: bold;">${data.top_recommendations.hottest_pick.ticker}</div>
                    <div style="color: #b0b8c1; font-size: 0.9em;">
                        Inst. Score: ${data.top_recommendations.hottest_pick.total_score}/100<br>
                        Signal: ${data.top_recommendations.hottest_pick.signal}<br>
                        Action: <span style="color: #ef4444;">WATCH</span>
                    </div>
                </div>
            `;
        }
        
        document.getElementById('topRecommendationsContainer').innerHTML = recsHtml;
        
        // ======================== MARKET BRIEF TEXT ========================
        fetch('/api/newsletter/market-brief')
            .then(res => res.json())
            .then(briefData => {
                document.getElementById('marketBriefText').innerHTML = briefData.market_brief.replace(/\n/g, '<br>');
            });
        
    } catch (error) {
        console.error('Newsletter Error:', error);
        document.getElementById('newsletterContainer').innerHTML = `
            <div style="background: rgba(239,68,68,0.1); padding: 1rem; border-radius: 8px; color: #ef4444;">
                <strong>‚ö†Ô∏è Newsletter Data Unavailable</strong><br>
                <span style="font-size: 0.9em; color: #b0b8c1;">Check API connection and ticker configuration</span>
            </div>
        `;
    }
}

// Load on page load
window.addEventListener('load', loadNewsletterAnalysis);

// Refresh every hour
setInterval(loadNewsletterAnalysis, 3600000);
</script>
