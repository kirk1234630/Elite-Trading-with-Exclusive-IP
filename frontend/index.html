<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elite Stock Tracker - AI Powered</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://s3.tradingview.com/tv.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: linear-gradient(135deg, #1a1a3e 0%, #16213e 50%, #0f3460 100%); color: #fff; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; min-height: 100vh; }
        .header { background: rgba(20, 20, 50, 0.95); backdrop-filter: blur(10px); border-bottom: 2px solid #00d4ff; padding: 1.2rem 2rem; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; }
        .logo { font-size: 1.8em; font-weight: 900; background: linear-gradient(135deg, #00d4ff 0%, #7c3aed 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; cursor: pointer; }
        .search-bar { flex: 1; max-width: 500px; margin: 0 2rem; display: flex; align-items: center; background: rgba(30, 30, 60, 0.8); border: 2px solid #444; border-radius: 10px; padding: 0.8rem 1rem; gap: 0.8rem; }
        .search-bar input { flex: 1; background: transparent; border: none; color: #fff; outline: none; font-size: 1em; }
        .search-bar button { background: linear-gradient(135deg, #7c3aed 0%, #06b6d4 100%); border: none; color: white; padding: 0.7rem 1.5rem; border-radius: 8px; cursor: pointer; font-weight: 700; }
        .container { max-width: 1600px; margin: 0 auto; padding: 2rem; }
        .page { display: none; }
        .page.active { display: block; }
        .action-buttons { display: flex; gap: 1rem; justify-content: center; margin-bottom: 2rem; flex-wrap: wrap; }
        .btn-large { padding: 1rem 2rem; border: none; border-radius: 12px; font-size: 1.1em; font-weight: 700; cursor: pointer; display: flex; align-items: center; gap: 0.8rem; transition: all 0.3s; }
        .btn-large:hover { transform: translateY(-2px); }
        .btn-refresh { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; }
        .btn-newsletter { background: linear-gradient(135deg, #7c3aed 0%, #06b6d4 100%); color: white; }
        .section { background: rgba(26, 26, 64, 0.95); border: 2px solid #00d4ff; border-radius: 15px; padding: 1.5rem; margin-bottom: 1.5rem; }
        .stock-card { background: linear-gradient(145deg, #1a1a40 0%, #242850 100%); border: 2px solid #333; border-radius: 15px; padding: 1.5rem; cursor: pointer; margin-bottom: 1rem; }
        .stock-card:hover { border-color: #00d4ff; transform: translateY(-2px); }
        .ticker-name { font-size: 1.3em; font-weight: 900; color: #00d4ff; }
        .price { font-size: 1.5em; color: #10b981; font-weight: 700; margin-top: 0.5rem; }
        .table { width: 100%; border-collapse: collapse; margin: 1rem 0; }
        .table th { background: rgba(124, 58, 237, 0.3); color: #00d4ff; padding: 1rem; text-align: left; font-weight: 700; border: 1px solid #444; }
        .table td { padding: 0.8rem 1rem; border: 1px solid #444; color: #b0b8c1; }
        .table tr:hover { background: rgba(0, 212, 255, 0.05); }
        .status-badge { display: inline-block; padding: 0.4rem 0.8rem; border-radius: 6px; font-size: 0.85em; font-weight: 700; }
        .badge-buy { background: #10b981; color: white; }
        .badge-sell { background: #ef4444; color: white; }
        .badge-hold { background: #f59e0b; color: white; }
        .macro-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem; }
        .macro-item { background: rgba(0, 212, 255, 0.1); border: 1px solid #444; border-radius: 8px; padding: 1rem; }
        .macro-label { font-size: 0.85em; color: #9ca3af; margin-bottom: 0.5rem; }
        .macro-value { font-size: 1.3em; color: #00d4ff; font-weight: 900; }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo" onclick="goHome()">âš¡ Elite Trading <br><span style="font-size: 0.5em; color: #7c3aed;">AI-Powered Analysis</span></div>
        <div class="search-bar">
            <i class="fas fa-search"></i>
            <input type="text" id="searchInput" placeholder="Search ticker..." onkeypress="if(event.key==='Enter') searchStock()">
            <button onclick="searchStock()">ANALYZE</button>
        </div>
    </div>

    <!-- HOME PAGE -->
    <div id="homePage" class="page active">
        <div class="container">
            <div style="background: linear-gradient(135deg, #7c3aed 0%, #06b6d4 100%); border-radius: 20px; padding: 3rem 2rem; text-align: center; margin-bottom: 2rem;">
                <h1 style="font-size: 2.8em; font-weight: 900;">ðŸ“Š Elite Trading Dashboard</h1>
                <p style="font-size: 1.1em;">âœ… Perplexity AI | âœ… Finnhub | âœ… Alpha Vantage | âœ… FRED | âœ… Web Scraping</p>
            </div>

            <div class="action-buttons">
                <button class="btn-large btn-refresh" onclick="loadAllStocks()">
                    <i class="fas fa-sync"></i> <span>LOAD RECOMMENDATIONS</span>
                </button>
                <button class="btn-large btn-newsletter" onclick="showNewsletter()">
                    <i class="fas fa-newspaper"></i> NEWSLETTER
                </button>
            </div>

            <div id="stocksContainer" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem;">
                <p style="color: #9ca3af; grid-column: 1/-1; text-align: center;">Click LOAD RECOMMENDATIONS to fetch live data</p>
            </div>
        </div>
    </div>

    <!-- NEWSLETTER PAGE -->
    <div id="newsletterPage" class="page">
        <div class="container">
            <div style="background: linear-gradient(135deg, #7c3aed 0%, #06b6d4 100%); border-radius: 20px; padding: 2rem; text-align: center; margin-bottom: 2rem;">
                <h1 style="font-size: 2.5em; font-weight: 900;">ðŸ“° ELITE QUANTITATIVE NEWSLETTER</h1>
                <p id="nlDate" style="font-size: 0.95em;"></p>
            </div>

            <!-- MACRO INDICATORS (FRED API) -->
            <div class="section">
                <h2 style="color: #00d4ff; margin-bottom: 1rem;">
                    <i class="fas fa-globe"></i> Macro Indicators (FRED API)
                </h2>
                <div id="macroIndicators" class="macro-grid">
                    <p style="color: #9ca3af;">Loading FRED data...</p>
                </div>
            </div>

            <!-- EXECUTIVE SUMMARY -->
            <div class="section">
                <h2 style="color: #10b981; margin-bottom: 1rem;">
                    <i class="fas fa-chart-line"></i> Executive Summary
                </h2>
                <div id="executiveSummary" style="color: #b0b8c1; line-height: 1.8;">
                    <p>âœ… <strong>All APIs Enabled:</strong> Perplexity Sonar | Finnhub | Alpha Vantage | FRED | Web Scraping</p>
                    <p>ðŸŽ¯ <strong>Data Sources:</strong> Live prices, earnings calendar, insider trading, social sentiment, AI insights</p>
                    <p>ðŸ“Š <strong>Update Frequency:</strong> Prices (5 min), Sentiment (Daily), Macro (Weekly), Earnings (Monthly)</p>
                </div>
            </div>

            <!-- TOP 10 STOCKS -->
            <div class="section">
                <h2 style="color: #00d4ff; margin-bottom: 1rem;">
                    <i class="fas fa-gem"></i> Top 10 Stocks by Score
                </h2>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Ticker</th>
                            <th>Price</th>
                            <th>Change %</th>
                            <th>Score</th>
                            <th>Signal</th>
                            <th>Insider Activity</th>
                            <th>Sentiment</th>
                        </tr>
                    </thead>
                    <tbody id="nlStocksTable">
                        <tr><td colspan="7" style="text-align: center; color: #9ca3af;">Loading stocks...</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- NEWS & INSIDER -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                <!-- LIVE NEWS -->
                <div class="section">
                    <h2 style="color: #7c3aed; margin-bottom: 1rem;">
                        <i class="fas fa-newspaper"></i> Live News Scraping
                    </h2>
                    <div id="liveNews">
                        <p style="color: #9ca3af;">Loading news from web scraping...</p>
                    </div>
                </div>

                <!-- INSIDER TRADING -->
                <div class="section">
                    <h2 style="color: #f59e0b; margin-bottom: 1rem;">
                        <i class="fas fa-exchange-alt"></i> Insider Trading Activity
                    </h2>
                    <div id="insiderTrading">
                        <p style="color: #9ca3af;">Loading insider transactions...</p>
                    </div>
                </div>
            </div>

            <!-- OPTIONS RECOMMENDATIONS EXPANDED -->
            <div class="section">
                <h2 style="color: #ec4899; margin-bottom: 1rem;">
                    <i class="fas fa-chart-bar"></i> Options Recommendations (Expanded)
                </h2>
                <div id="optionsRecommendations">
                    <p style="color: #9ca3af;">Loading options strategies...</p>
                </div>
            </div>

            <button class="btn-large btn-refresh" onclick="goHome()" style="width: 100%; margin-top: 2rem;">
                <i class="fas fa-arrow-left"></i> BACK TO DASHBOARD
            </button>
        </div>
    </div>

    <script>
        const API_BASE = 'https://elite-trading-with-exclusive-ip.onrender.com';

        function formatNumber(num) { return parseFloat(num || 0).toFixed(2); }
        function goHome() {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('homePage').classList.add('active');
        }

        async function loadAllStocks() {
            try {
                const response = await fetch(`${API_BASE}/api/recommendations`);
                const stocks = await response.json();
                
                const container = document.getElementById('stocksContainer');
                container.innerHTML = stocks.slice(0, 20).map(s => `
                    <div class="stock-card" onclick="analyzeStock('${s.Symbol}')">
                        <div style="display: flex; justify-content: space-between;">
                            <div>
                                <div class="ticker-name">${s.Symbol}</div>
                                <div class="price">$${formatNumber(s.Last)}</div>
                            </div>
                            <div style="text-align: right;">
                                <span class="status-badge ${s.Signal === 'BUY' ? 'badge-buy' : s.Signal === 'SELL' ? 'badge-sell' : 'badge-hold'}">${s.Signal}</span>
                                <div style="color: ${s.Change >= 0 ? '#10b981' : '#ef4444'}; font-weight: 700; margin-top: 0.5rem;">
                                    ${s.Change >= 0 ? 'â†‘' : 'â†“'} ${Math.abs(formatNumber(s.Change))}%
                                </div>
                            </div>
                        </div>
                        <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #444; color: #9ca3af; font-size: 0.85em;">
                            <div><strong>Score:</strong> ${formatNumber(s.Score || 0)}</div>
                            <div><strong>Key:</strong> ${s.KeyMetric || 'N/A'}</div>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading stocks:', error);
                document.getElementById('stocksContainer').innerHTML = `<p style="color: #ef4444; grid-column: 1/-1;">Error loading data. Check backend.</p>`;
            }
        }

        async function showNewsletter() {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('newsletterPage').classList.add('active');
            document.getElementById('nlDate').textContent = new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

            // Load all data in parallel
            Promise.all([
                loadMacroIndicators(),
                loadTopStocks(),
                loadLiveNews(),
                loadInsiderTrading(),
                loadOptionsRecommendations()
            ]).catch(console.error);
        }

        async function loadMacroIndicators() {
            try {
                const response = await fetch(`${API_BASE}/api/macro-indicators`);
                const data = await response.json();
                
                const indicators = data.indicators || {};
                const html = Object.values(indicators).map(ind => `
                    <div class="macro-item">
                        <div class="macro-label">${ind.name || 'N/A'}</div>
                        <div class="macro-value">${formatNumber(ind.value)}</div>
                        <div style="font-size: 0.75em; color: #9ca3af; margin-top: 0.5rem;">${ind.unit || ''}</div>
                    </div>
                `).join('');
                document.getElementById('macroIndicators').innerHTML = html || '<p style="color: #9ca3af;">No macro data available</p>';
            } catch (error) {
                console.error('Error loading macro indicators:', error);
                document.getElementById('macroIndicators').innerHTML = '<p style="color: #ef4444;">Error loading FRED data</p>';
            }
        }

        async function loadTopStocks() {
            try {
                const response = await fetch(`${API_BASE}/api/recommendations`);
                const stocks = await response.json();
                
                const html = stocks.slice(0, 10).map(s => `
                    <tr onclick="analyzeStock('${s.Symbol}')" style="cursor: pointer;">
                        <td style="font-weight: 700; color: #00d4ff;">${s.Symbol}</td>
                        <td>$${formatNumber(s.Last)}</td>
                        <td style="color: ${s.Change >= 0 ? '#10b981' : '#ef4444'}; font-weight: 700;">
                            ${s.Change >= 0 ? '+' : ''}${formatNumber(s.Change)}%
                        </td>
                        <td style="color: #00d4ff; font-weight: 900;">${formatNumber(s.Score || 0)}</td>
                        <td><span class="status-badge ${s.Signal === 'BUY' ? 'badge-buy' : s.Signal === 'SELL' ? 'badge-sell' : 'badge-hold'}">${s.Signal}</span></td>
                        <td><span style="color: #f59e0b;">ðŸ“Š Loading...</span></td>
                        <td><span style="color: #7c3aed;">ðŸ’¬ Loading...</span></td>
                    </tr>
                `).join('');
                document.getElementById('nlStocksTable').innerHTML = html;
            } catch (error) {
                document.getElementById('nlStocksTable').innerHTML = '<tr><td colspan="7" style="color: #ef4444;">Error loading stocks</td></tr>';
            }
        }

        async function loadLiveNews() {
            try {
                const response = await fetch(`${API_BASE}/api/stock-news/NVDA`);
                const news = await response.json();
                
                const html = (news || []).slice(0, 5).map(n => `
                    <div style="background: rgba(0, 212, 255, 0.1); border-left: 3px solid #7c3aed; padding: 0.8rem; margin-bottom: 0.8rem; border-radius: 6px;">
                        <div style="font-weight: 600; color: #00d4ff; font-size: 0.9em;">${n.Headline || 'N/A'}</div>
                        <div style="color: #9ca3af; font-size: 0.75em; margin-top: 0.3rem;">${n.Source || 'Web Scrape'} â€¢ ${n.Date || 'Today'}</div>
                    </div>
                `).join('') || '<p style="color: #9ca3af;">No news available</p>';
                document.getElementById('liveNews').innerHTML = html;
            } catch (error) {
                document.getElementById('liveNews').innerHTML = '<p style="color: #ef4444;">Error loading news scraping</p>';
            }
        }

        async function loadInsiderTrading() {
            try {
                const response = await fetch(`${API_BASE}/api/insider-transactions/NVDA`);
                const transactions = await response.json();
                
                const html = (transactions || []).slice(0, 5).map(t => `
                    <div style="background: rgba(245, 158, 11, 0.1); border-left: 3px solid ${t.Type === 'Buy' ? '#10b981' : '#ef4444'}; padding: 0.8rem; margin-bottom: 0.8rem; border-radius: 6px;">
                        <div style="font-weight: 700; color: ${t.Type === 'Buy' ? '#10b981' : '#ef4444'};">${t.Type.toUpperCase()}: ${t.Shares || 'N/A'} shares</div>
                        <div style="color: #9ca3af; font-size: 0.85em; margin-top: 0.3rem;">${t.Insider || 'Unknown'} â€¢ ${t.Date || 'Recent'}</div>
                    </div>
                `).join('') || '<p style="color: #9ca3af;">No insider activity</p>';
                document.getElementById('insiderTrading').innerHTML = html;
            } catch (error) {
                document.getElementById('insiderTrading').innerHTML = '<p style="color: #ef4444;">Error loading insider data</p>';
            }
        }

        async function loadOptionsRecommendations() {
            try {
                const response = await fetch(`${API_BASE}/api/options-opportunities/NVDA`);
                const options = await response.json();
                
                const html = (options || []).map(opt => `
                    <div style="background: rgba(236, 72, 153, 0.1); border: 1px solid #ec4899; border-radius: 10px; padding: 1rem; margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <div style="font-weight: 700; color: #ec4899;">${opt.Strategy || 'Strategy'}</div>
                            <span class="status-badge badge-buy">${opt.Recommendation || 'HOLD'}</span>
                        </div>
                        <div style="color: #b0b8c1; font-size: 0.9em; margin: 0.5rem 0;">${opt.Setup || 'Setup loading...'}</div>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.5rem; margin-top: 0.8rem;">
                            <div style="background: rgba(0, 212, 255, 0.1); padding: 0.5rem; border-radius: 6px; text-align: center;">
                                <div style="font-size: 0.75em; color: #9ca3af;">Max Profit</div>
                                <div style="color: #10b981; font-weight: 700;">$${formatNumber(opt.MaxProfit)}</div>
                            </div>
                            <div style="background: rgba(0, 212, 255, 0.1); padding: 0.5rem; border-radius: 6px; text-align: center;">
                                <div style="font-size: 0.75em; color: #9ca3af;">Max Loss</div>
                                <div style="color: #ef4444; font-weight: 700;">$${formatNumber(opt.MaxLoss)}</div>
                            </div>
                            <div style="background: rgba(0, 212, 255, 0.1); padding: 0.5rem; border-radius: 6px; text-align: center;">
                                <div style="font-size: 0.75em; color: #9ca3af;">Breakeven</div>
                                <div style="color: #f59e0b; font-weight: 700;">$${formatNumber(opt.Breakeven)}</div>
                            </div>
                        </div>
                    </div>
                `).join('') || '<p style="color: #9ca3af;">No options data</p>';
                document.getElementById('optionsRecommendations').innerHTML = html;
            } catch (error) {
                document.getElementById('optionsRecommendations').innerHTML = '<p style="color: #ef4444;">Error loading options data</p>';
            }
        }

        function analyzeStock(ticker) {
            alert(`Detailed analysis for ${ticker} coming soon. Check the API endpoints at ${API_BASE}`);
        }

        function searchStock() {
            const ticker = document.getElementById('searchInput').value.trim().toUpperCase();
            if (ticker) analyzeStock(ticker);
        }

        window.addEventListener('load', () => {
            console.log('âœ… Dashboard loaded');
            console.log(`ðŸ”— API Base: ${API_BASE}`);
            console.log('âœ… All APIs enabled: Perplexity, Finnhub, Alpha Vantage, FRED, Web Scraping');
        });
    </script>
</body>
</html>
