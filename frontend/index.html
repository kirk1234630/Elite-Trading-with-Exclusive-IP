<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elite Trading Analytics</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://s3.tradingview.com/tv.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: linear-gradient(135deg, #1a1a3e 0%, #16213e 50%, #0f3460 100%); color: #fff; font-family: -apple-system, sans-serif; min-height: 100vh; }

        .header { background: rgba(20, 20, 50, 0.95); backdrop-filter: blur(10px); border-bottom: 2px solid #00d4ff; padding: 1.2rem 2rem; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; }
        .logo { font-size: 1.8em; font-weight: 900; background: linear-gradient(135deg, #00d4ff 0%, #7c3aed 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .nav { display: flex; gap: 2rem; }
        .nav-btn { background: transparent; color: #00d4ff; border: none; padding: 0.6rem 1.2rem; cursor: pointer; font-size: 1em; font-weight: 600; transition: all 0.3s; border-radius: 8px; }
        .nav-btn:hover, .nav-btn.active { background: rgba(0, 212, 255, 0.15); color: #00d4ff; }

        .container { max-width: 1600px; margin: 2rem auto; padding: 0 2rem; }
        .section { background: rgba(20, 20, 50, 0.7); backdrop-filter: blur(10px); border-radius: 16px; padding: 2rem; margin-bottom: 2rem; border: 1px solid rgba(0, 212, 255, 0.2); display: none; }
        .section.active { display: block; }

        .section-title { font-size: 1.8em; font-weight: 700; margin-bottom: 1.5rem; color: #00d4ff; }

        /* Dashboard Grid */
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; }
        .metric-card { background: linear-gradient(135deg, rgba(0, 212, 255, 0.1) 0%, rgba(124, 58, 237, 0.1) 100%); border-radius: 12px; padding: 1.5rem; border: 1px solid rgba(0, 212, 255, 0.3); }
        .metric-label { font-size: 0.9em; color: #9ca3af; margin-bottom: 0.5rem; }
        .metric-value { font-size: 2em; font-weight: 700; color: #00d4ff; }
        .metric-change { font-size: 0.9em; margin-top: 0.5rem; }
        .positive { color: #10b981; }
        .negative { color: #ef4444; }

        /* Stock Table */
        .stock-table-container { overflow-x: auto; }
        .stock-table { width: 100%; border-collapse: collapse; }
        .stock-table th { background: rgba(0, 212, 255, 0.1); padding: 1rem; text-align: left; font-weight: 600; border-bottom: 2px solid rgba(0, 212, 255, 0.3); }
        .stock-table td { padding: 1rem; border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
        .stock-table tr:hover { background: rgba(0, 212, 255, 0.05); cursor: pointer; }
        .ticker-cell { font-weight: 700; color: #00d4ff; font-size: 1.1em; }
        .signal-badge { padding: 0.4rem 0.8rem; border-radius: 6px; font-size: 0.85em; font-weight: 600; }
        .signal-buy { background: rgba(16, 185, 129, 0.2); color: #10b981; }
        .signal-sell { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        .signal-hold { background: rgba(156, 163, 175, 0.2); color: #9ca3af; }

        /* Stock Details Page */
        .details-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; padding-bottom: 1.5rem; border-bottom: 2px solid rgba(0, 212, 255, 0.3); }
        .details-title { font-size: 2.5em; font-weight: 800; color: #00d4ff; }
        .details-price { font-size: 2em; font-weight: 700; }
        .back-btn { background: rgba(0, 212, 255, 0.15); color: #00d4ff; border: 1px solid #00d4ff; padding: 0.7rem 1.5rem; border-radius: 8px; cursor: pointer; font-size: 1em; font-weight: 600; transition: all 0.3s; }
        .back-btn:hover { background: rgba(0, 212, 255, 0.3); }

        .details-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 2rem; margin-bottom: 2rem; }
        .chart-section { background: rgba(255, 255, 255, 0.05); border-radius: 12px; padding: 1.5rem; border: 1px solid rgba(0, 212, 255, 0.2); min-height: 500px; }
        .metrics-section { background: rgba(255, 255, 255, 0.05); border-radius: 12px; padding: 1.5rem; border: 1px solid rgba(0, 212, 255, 0.2); }
        .metric-row { display: flex; justify-content: space-between; padding: 0.8rem 0; border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
        .metric-row:last-child { border-bottom: none; }

        /* News Section */
        .news-section { background: rgba(255, 255, 255, 0.05); border-radius: 12px; padding: 1.5rem; margin-top: 2rem; border: 1px solid rgba(0, 212, 255, 0.2); }
        .news-grid { display: grid; gap: 1.2rem; margin-top: 1rem; }
        .news-card { background: rgba(0, 212, 255, 0.05); border-radius: 10px; padding: 1.2rem; border: 1px solid rgba(0, 212, 255, 0.2); transition: all 0.3s; }
        .news-card:hover { background: rgba(0, 212, 255, 0.1); transform: translateY(-2px); }
        .news-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.8rem; }
        .news-title { font-size: 1.1em; font-weight: 600; color: #00d4ff; line-height: 1.4; flex: 1; }
        .news-sentiment { padding: 0.3rem 0.7rem; border-radius: 6px; font-size: 0.8em; font-weight: 600; margin-left: 1rem; }
        .sentiment-bullish { background: rgba(16, 185, 129, 0.2); color: #10b981; }
        .sentiment-bearish { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        .sentiment-neutral { background: rgba(156, 163, 175, 0.2); color: #9ca3af; }
        .news-summary { color: #d1d5db; line-height: 1.6; margin-bottom: 0.8rem; font-size: 0.95em; }
        .news-meta { display: flex; justify-content: space-between; align-items: center; font-size: 0.85em; color: #9ca3af; }
        .news-source { font-weight: 600; color: #7c3aed; }
        .news-time { color: #6b7280; }
        .news-link { color: #00d4ff; text-decoration: none; font-weight: 600; }
        .news-link:hover { text-decoration: underline; }

        /* Market News Section */
        .market-news-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 1.5rem; }

        /* Newsletter Section */
        .newsletter-section { background: rgba(255, 255, 255, 0.05); border-radius: 12px; padding: 2rem; border: 1px solid rgba(0, 212, 255, 0.2); }
        .newsletter-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 2px solid rgba(0, 212, 255, 0.3); }
        .newsletter-title { font-size: 2em; font-weight: 700; color: #00d4ff; }
        .newsletter-date { color: #9ca3af; font-size: 1em; }
        .newsletter-article { background: rgba(0, 212, 255, 0.05); border-radius: 12px; padding: 1.8rem; margin-bottom: 1.5rem; border-left: 4px solid #00d4ff; }
        .newsletter-article-title { font-size: 1.4em; font-weight: 700; color: #00d4ff; margin-bottom: 1rem; }
        .newsletter-article-content { color: #d1d5db; line-height: 1.8; font-size: 1.05em; margin-bottom: 1rem; }

        /* Loading Spinner */
        .loading { display: flex; justify-content: center; align-items: center; padding: 3rem; }
        .spinner { border: 4px solid rgba(0, 212, 255, 0.1); border-top: 4px solid #00d4ff; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Error Message */
        .error-message { background: rgba(239, 68, 68, 0.1); border: 1px solid #ef4444; color: #ef4444; padding: 1rem; border-radius: 8px; margin: 1rem 0; }

        /* Responsive */
        @media (max-width: 768px) {
            .details-grid { grid-template-columns: 1fr; }
            .market-news-container { grid-template-columns: 1fr; }
            .dashboard-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">‚ö° Elite Trading</div>
        <div class="nav">
            <button class="nav-btn active" onclick="showSection('dashboard')">Dashboard</button>
            <button class="nav-btn" onclick="showSection('stocks')">Stocks</button>
            <button class="nav-btn" onclick="showSection('news')">Market News</button>
            <button class="nav-btn" onclick="showSection('newsletter')">Newsletter</button>
        </div>
    </div>

    <div class="container">
        <!-- DASHBOARD SECTION -->
        <div id="dashboard" class="section active">
            <h2 class="section-title">Market Overview</h2>
            <div class="dashboard-grid">
                <div class="metric-card">
                    <div class="metric-label">S&P 500</div>
                    <div class="metric-value">5,917.25</div>
                    <div class="metric-change positive">‚Üë +1.24% Today</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">NASDAQ</div>
                    <div class="metric-value">18,983.47</div>
                    <div class="metric-change positive">‚Üë +1.51% Today</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">VIX</div>
                    <div class="metric-value">14.82</div>
                    <div class="metric-change negative">‚Üì -3.2% Today</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Active Signals</div>
                    <div class="metric-value" id="activeSignals">0</div>
                    <div class="metric-change">Updated Live</div>
                </div>
            </div>

            <h3 class="section-title" style="margin-top: 2rem;">Top Movers</h3>
            <div class="stock-table-container">
                <table class="stock-table">
                    <thead>
                        <tr>
                            <th>Symbol</th>
                            <th>Last</th>
                            <th>Change</th>
                            <th>Volume</th>
                            <th>Signal</th>
                        </tr>
                    </thead>
                    <tbody id="topMoversTable">
                        <tr><td colspan="5" class="loading"><div class="spinner"></div></td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- STOCKS SECTION -->
        <div id="stocks" class="section">
            <h2 class="section-title">Stock Analysis</h2>
            <div class="stock-table-container">
                <table class="stock-table">
                    <thead>
                        <tr>
                            <th>Symbol</th>
                            <th>Last</th>
                            <th>Change %</th>
                            <th>RSI</th>
                            <th>Signal</th>
                            <th>Strategy</th>
                        </tr>
                    </thead>
                    <tbody id="stockTable">
                        <tr><td colspan="6" class="loading"><div class="spinner"></div></td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- STOCK DETAILS SECTION -->
        <div id="stockDetails" class="section">
            <div class="details-header">
                <div>
                    <div class="details-title" id="detailsSymbol">AAPL</div>
                    <div class="details-price" id="detailsPrice">$178.45</div>
                </div>
                <button class="back-btn" onclick="showSection('stocks')">‚Üê Back to Stocks</button>
            </div>

            <div class="details-grid">
                <div class="chart-section">
                    <div id="tradingview_chart"></div>
                </div>
                <div class="metrics-section">
                    <h3 style="margin-bottom: 1rem; color: #00d4ff;">Key Metrics</h3>
                    <div class="metric-row">
                        <span class="metric-label">RSI (14)</span>
                        <span id="detailsRSI">--</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Volume</span>
                        <span id="detailsVolume">--</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Avg Volume</span>
                        <span id="detailsAvgVolume">--</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Signal</span>
                        <span id="detailsSignal" class="signal-badge">--</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Strategy</span>
                        <span id="detailsStrategy">--</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Data Source</span>
                        <span id="detailsSource">--</span>
                    </div>
                </div>
            </div>

            <!-- Stock-Specific News -->
            <div class="news-section">
                <h3 style="color: #00d4ff; font-size: 1.5em; margin-bottom: 1rem;">Latest News</h3>
                <div class="news-grid" id="stockNewsContainer">
                    <div class="loading"><div class="spinner"></div></div>
                </div>
            </div>
        </div>

        <!-- MARKET NEWS SECTION -->
        <div id="news" class="section">
            <h2 class="section-title">Market News</h2>
            <div class="market-news-container" id="marketNewsContainer">
                <div class="loading"><div class="spinner"></div></div>
            </div>
        </div>

        <!-- NEWSLETTER SECTION -->
        <div id="newsletter" class="section">
            <div class="newsletter-section">
                <div class="newsletter-header">
                    <div class="newsletter-title">üìà Elite Trading Newsletter</div>
                    <div class="newsletter-date" id="newsletterDate">Loading...</div>
                </div>
                <div id="newsletterContent">
                    <div class="loading"><div class="spinner"></div></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'https://elite-trading-with-exclusive-ip.onrender.com';
        
        // Hardcoded stock list (as requested)
        const STOCKS = [
            'AAPL', 'MSFT', 'GOOGL', 'AMZN', 'NVDA', 'TSLA', 'META', 'AMD', 'CRM', 'ADBE',
            'NFLX', 'PYPL', 'SHOP', 'RBLX', 'DASH', 'ZOOM', 'SNOW', 'CRWD', 'NET', 'ABNB',
            'UPST', 'COIN', 'RIOT', 'MARA', 'CLSK', 'MSTR', 'SQ', 'PLTR', 'ASML', 'INTU',
            'SNPS', 'MU', 'QCOM', 'AVGO', 'LRCX', 'TSM', 'INTC', 'VMW', 'SEMR',
            'SGRY', 'PSTG', 'DDOG', 'OKTA', 'ZS', 'CHKP', 'PANW', 'SMAR', 'NOW', 'VEEV',
            'TWLO', 'GTLB', 'ORCL', 'IBM', 'HPE', 'DELL', 'CSCO'
        ];

        let currentStock = null;
        let stocksData = [];
        let marketNewsData = [];

        // Navigation
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            event.target.classList.add('active');

            if (sectionId === 'news' && marketNewsData.length === 0) {
                loadMarketNews();
            }
            if (sectionId === 'newsletter') {
                loadNewsletter();
            }
        }

        // Load stock recommendations
        async function loadStocks() {
            try {
                const response = await fetch(`${API_BASE}/api/recommendations`);
                const data = await response.json();
                
                stocksData = data;
                displayStocks(data);
                displayTopMovers(data);
                updateActiveSignals(data);
            } catch (error) {
                console.error('Error loading stocks:', error);
                document.getElementById('stockTable').innerHTML = 
                    '<tr><td colspan="6" class="error-message">Failed to load stock data. Please refresh.</td></tr>';
            }
        }

        function displayStocks(stocks) {
            const tbody = document.getElementById('stockTable');
            tbody.innerHTML = stocks.map(stock => `
                <tr onclick="showStockDetails('${stock.Symbol}')">
                    <td class="ticker-cell">${stock.Symbol}</td>
                    <td>$${stock.Last.toFixed(2)}</td>
                    <td class="${stock.Change >= 0 ? 'positive' : 'negative'}">
                        ${stock.Change >= 0 ? '‚Üë' : '‚Üì'} ${Math.abs(stock.Change).toFixed(2)}%
                    </td>
                    <td>${stock.RSI || '--'}</td>
                    <td><span class="signal-badge signal-${stock.Signal.toLowerCase().replace(' ', '-')}">${stock.Signal}</span></td>
                    <td>${stock.Strategy || '--'}</td>
                </tr>
            `).join('');
        }

        function displayTopMovers(stocks) {
            const movers = [...stocks].sort((a, b) => Math.abs(b.Change) - Math.abs(a.Change)).slice(0, 5);
            const tbody = document.getElementById('topMoversTable');
            tbody.innerHTML = movers.map(stock => `
                <tr onclick="showStockDetails('${stock.Symbol}')">
                    <td class="ticker-cell">${stock.Symbol}</td>
                    <td>$${stock.Last.toFixed(2)}</td>
                    <td class="${stock.Change >= 0 ? 'positive' : 'negative'}">
                        ${stock.Change >= 0 ? '‚Üë' : '‚Üì'} ${Math.abs(stock.Change).toFixed(2)}%
                    </td>
                    <td>${(Math.random() * 10 + 5).toFixed(1)}M</td>
                    <td><span class="signal-badge signal-${stock.Signal.toLowerCase().replace(' ', '-')}">${stock.Signal}</span></td>
                </tr>
            `).join('');
        }

        function updateActiveSignals(stocks) {
            const buySignals = stocks.filter(s => s.Signal.includes('BUY')).length;
            document.getElementById('activeSignals').textContent = buySignals;
        }

        // Show stock details
        async function showStockDetails(symbol) {
            currentStock = symbol;
            const stock = stocksData.find(s => s.Symbol === symbol) || {};
            
            document.getElementById('detailsSymbol').textContent = symbol;
            document.getElementById('detailsPrice').textContent = `$${stock.Last?.toFixed(2) || '--'}`;
            document.getElementById('detailsRSI').textContent = stock.RSI || '--';
            document.getElementById('detailsVolume').textContent = '8.2M';
            document.getElementById('detailsAvgVolume').textContent = '7.5M';
            document.getElementById('detailsSignal').textContent = stock.Signal || '--';
            document.getElementById('detailsSignal').className = `signal-badge signal-${stock.Signal?.toLowerCase().replace(' ', '-')}`;
            document.getElementById('detailsStrategy').textContent = stock.Strategy || '--';
            document.getElementById('detailsSource').textContent = stock.Source || 'API';

            showSection('stockDetails');
            loadTradingViewChart(symbol);
            loadStockNews(symbol);
        }

        function loadTradingViewChart(symbol) {
            const container = document.getElementById('tradingview_chart');
            container.innerHTML = '';
            
            new TradingView.widget({
                "autosize": true,
                "symbol": `NASDAQ:${symbol}`,
                "interval": "D",
                "timezone": "America/Los_Angeles",
                "theme": "dark",
                "style": "1",
                "locale": "en",
                "toolbar_bg": "#1a1a3e",
                "enable_publishing": false,
                "hide_side_toolbar": false,
                "allow_symbol_change": true,
                "container_id": "tradingview_chart"
            });
        }

        // Load stock-specific news
        async function loadStockNews(symbol) {
            const container = document.getElementById('stockNewsContainer');
            container.innerHTML = '<div class="loading"><div class="spinner"></div></div>';

            try {
                const response = await fetch(`${API_BASE}/api/stock-news/${symbol}`);
                const data = await response.json();

                if (data.articles && data.articles.length > 0) {
                    container.innerHTML = data.articles.map(article => `
                        <div class="news-card">
                            <div class="news-header">
                                <div class="news-title">${article.headline}</div>
                                <div class="news-sentiment sentiment-${article.sentiment}">${article.sentiment.toUpperCase()}</div>
                            </div>
                            <div class="news-summary">${article.summary || 'No summary available.'}</div>
                            <div class="news-meta">
                                <span class="news-source">${article.source}</span>
                                <span class="news-time">${new Date(article.datetime * 1000).toLocaleDateString()}</span>
                                <a href="${article.url}" target="_blank" class="news-link">Read More ‚Üí</a>
                            </div>
                        </div>
                    `).join('');
                } else {
                    container.innerHTML = '<p style="color: #9ca3af;">No recent news available for this stock.</p>';
                }
            } catch (error) {
                console.error('Error loading stock news:', error);
                container.innerHTML = '<div class="error-message">Failed to load news. Please try again.</div>';
            }
        }

        // Load market news
        async function loadMarketNews() {
            const container = document.getElementById('marketNewsContainer');
            container.innerHTML = '<div class="loading"><div class="spinner"></div></div>';

            try {
                const response = await fetch(`${API_BASE}/api/market-news/dashboard`);
                const data = await response.json();

                if (data.articles && data.articles.length > 0) {
                    marketNewsData = data.articles;
                    container.innerHTML = data.articles.map(article => `
                        <div class="news-card">
                            <div class="news-header">
                                <div class="news-title">${article.headline}</div>
                                <div class="news-sentiment sentiment-${article.sentiment}">${article.sentiment.toUpperCase()}</div>
                            </div>
                            <div class="news-summary">${article.summary}</div>
                            <div class="news-meta">
                                <span class="news-source">${article.source}</span>
                                <a href="${article.url}" target="_blank" class="news-link">Read Full Article ‚Üí</a>
                            </div>
                        </div>
                    `).join('');
                } else {
                    container.innerHTML = '<p style="color: #9ca3af;">No market news available at this time.</p>';
                }
            } catch (error) {
                console.error('Error loading market news:', error);
                container.innerHTML = '<div class="error-message">Failed to load market news. Please try again.</div>';
            }
        }

        // Load newsletter
        async function loadNewsletter() {
            const dateEl = document.getElementById('newsletterDate');
            const contentEl = document.getElementById('newsletterContent');
            
            dateEl.textContent = new Date().toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });

            contentEl.innerHTML = '<div class="loading"><div class="spinner"></div></div>';

            try {
                const response = await fetch(`${API_BASE}/api/market-news/newsletter`);
                const data = await response.json();

                if (data.articles && data.articles.length > 0) {
                    contentEl.innerHTML = data.articles.map((article, index) => `
                        <div class="newsletter-article">
                            <div class="newsletter-article-title">${index + 1}. ${article.headline}</div>
                            <div class="newsletter-article-content">${article.summary}</div>
                            <div class="news-meta">
                                <span class="news-sentiment sentiment-${article.sentiment}">${article.sentiment.toUpperCase()}</span>
                                <span class="news-source">${article.source}</span>
                                <span class="news-time">${new Date(article.datetime * 1000).toLocaleDateString()}</span>
                                <a href="${article.url}" target="_blank" class="news-link">Full Article ‚Üí</a>
                            </div>
                        </div>
                    `).join('');
                } else {
                    contentEl.innerHTML = '<p style="color: #9ca3af;">No newsletter content available.</p>';
                }
            } catch (error) {
                console.error('Error loading newsletter:', error);
                contentEl.innerHTML = '<div class="error-message">Failed to load newsletter. Please try again.</div>';
            }
        }

        // Auto-refresh every 5 minutes
        setInterval(() => {
            loadStocks();
            if (document.getElementById('news').classList.contains('active')) {
                loadMarketNews();
            }
        }, 300000);

        // Initial load
        loadStocks();
    </script>
</body>
</html>
