<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elite Trading Analytics</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://s3.tradingview.com/tv.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: linear-gradient(135deg, #1a1a3e 0%, #16213e 50%, #0f3460 100%); color: #fff; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; min-height: 100vh; }

        .header { background: rgba(20, 20, 50, 0.95); backdrop-filter: blur(10px); border-bottom: 2px solid #00d4ff; padding: 1.2rem 2rem; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; }
        .logo { font-size: 1.8em; font-weight: 900; background: linear-gradient(135deg, #00d4ff 0%, #7c3aed 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; cursor: pointer; }
        .search-bar { flex: 1; max-width: 500px; margin: 0 2rem; display: flex; align-items: center; background: rgba(30, 30, 60, 0.8); border: 2px solid #444; border-radius: 10px; padding: 0.8rem 1rem; gap: 0.8rem; }
        .search-bar input { flex: 1; background: transparent; border: none; color: #fff; outline: none; }
        .search-bar button { background: linear-gradient(135deg, #7c3aed 0%, #06b6d4 100%); border: none; color: white; padding: 0.7rem 1.5rem; border-radius: 8px; cursor: pointer; font-weight: 700; }

        .container { max-width: 1600px; margin: 0 auto; padding: 2rem; }
        .page { display: none; }
        .page.active { display: block; }

        .btn-large { padding: 1rem 2rem; border: none; border-radius: 12px; font-size: 1.1em; font-weight: 700; cursor: pointer; display: flex; align-items: center; gap: 0.8rem; justify-content: center; }
        .btn-refresh { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; }
        .btn-brief { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; }
        .btn-newsletter { background: linear-gradient(135deg, #ec4899 0%, #db2777 100%); color: white; }
        .btn-back { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; width: 100%; margin-top: 2rem; }
        .action-buttons { display: flex; gap: 1rem; justify-content: center; margin-bottom: 2rem; flex-wrap: wrap; }

        .top-plays-section { margin-bottom: 3rem; padding: 2rem; background: rgba(0, 212, 255, 0.05); border: 2px solid #00d4ff; border-radius: 15px; }
        .top-plays-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(340px, 1fr)); gap: 1.5rem; margin-top: 1.5rem; }
        .play-card { background: linear-gradient(145deg, #1a1a40 0%, #242850 100%); border: 2px solid #333; border-radius: 15px; padding: 1.5rem; cursor: pointer; transition: all 0.3s; }
        .play-card:hover { border-color: #00d4ff; transform: translateY(-5px); }
        .play-title { font-size: 1.5em; font-weight: 900; color: white; margin-bottom: 0.5rem; }
        .play-subtitle { font-style: italic; color: #00d4ff; margin-bottom: 0.8rem; font-size: 0.95em; }
        .play-change { font-size: 1.1em; font-weight: 700; }
        .play-button { width: 100%; padding: 0.7rem 1.5rem; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; color: white; font-size: 0.95em; margin: 0.8rem 0; }
        .play-metrics-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.8rem; margin: 1rem 0; }
        .metric-box-sm { background: rgba(0, 212, 255, 0.1); border: 1px solid #444; padding: 0.6rem; border-radius: 8px; text-align: center; }
        .metric-label-sm { font-size: 0.7em; color: #b0b8c1; }
        .metric-value-sm { font-size: 1em; color: #00d4ff; font-weight: 700; margin-top: 0.2rem; }
        .play-analysis { margin: 1rem 0; padding: 1rem; background: rgba(0, 212, 255, 0.05); border-left: 3px solid; border-radius: 5px; }
        .play-analysis ul { list-style: none; padding: 0; margin: 0; }
        .play-analysis li { font-size: 0.85em; line-height: 1.6; margin: 0.4rem 0; padding-left: 1.5rem; position: relative; }
        .play-targets { margin-top: 1rem; padding: 1rem; background: rgba(0, 212, 255, 0.05); border-left: 3px solid #10b981; border-radius: 5px; }
        .play-targets-title { font-size: 0.85em; color: #10b981; font-weight: 700; margin-bottom: 0.5rem; }
        .play-targets-content { font-size: 0.85em; color: #b0b8c1; line-height: 1.6; }

        .ai-chat-toggle { position: fixed; bottom: 30px; right: 30px; width: 70px; height: 70px; background: linear-gradient(135deg, #7c3aed 0%, #06b6d4 100%); border: none; border-radius: 50%; color: white; font-size: 1.8em; cursor: pointer; z-index: 200; box-shadow: 0 8px 25px rgba(124, 58, 237, 0.4); transition: all 0.3s; }
        .ai-chat-toggle:hover { transform: scale(1.1); }
        .ai-chat-toggle.hidden { opacity: 0; pointer-events: none; }
        .ai-chat-widget { position: fixed; bottom: 120px; right: 30px; width: 420px; max-height: 600px; background: rgba(30, 30, 60, 0.98); border: 2px solid #00d4ff; border-radius: 15px; display: flex; flex-direction: column; z-index: 199; box-shadow: 0 12px 40px rgba(0, 0, 0, 0.5); transform: scale(0.8); opacity: 0; pointer-events: none; transition: all 0.3s; }
        .ai-chat-widget.active { transform: scale(1); opacity: 1; pointer-events: all; }
        .ai-chat-header { background: linear-gradient(135deg, #7c3aed 0%, #06b6d4 100%); color: white; padding: 1.2rem; border-radius: 13px 13px 0 0; font-weight: 700; display: flex; justify-content: space-between; align-items: center; }
        .ai-messages { flex: 1; overflow-y: auto; padding: 1.2rem; display: flex; flex-direction: column; gap: 1rem; min-height: 300px; max-height: 400px; }
        .message { padding: 0.9rem 1.2rem; border-radius: 10px; max-width: 90%; word-wrap: break-word; font-size: 0.9em; line-height: 1.6; }
        .message.user { align-self: flex-end; background: linear-gradient(135deg, #7c3aed 0%, #06b6d4 100%); color: white; }
        .message.ai { align-self: flex-start; background: rgba(0, 212, 255, 0.15); color: #d1fae5; border: 1px solid #00d4ff; }
        .ai-input { display: flex; gap: 0.8rem; padding: 1.2rem; border-top: 1px solid #444; }
        .ai-input input { flex: 1; background: rgba(20, 20, 50, 0.8); border: 1px solid #444; color: white; padding: 0.8rem; border-radius: 8px; outline: none; }
        .ai-input button { background: linear-gradient(135deg, #7c3aed 0%, #06b6d4 100%); border: none; color: white; padding: 0.8rem 1.5rem; border-radius: 8px; cursor: pointer; font-weight: 700; }

        .stock-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 1.5rem; }
        .stock-card { background: linear-gradient(145deg, #1a1a40 0%, #242850 100%); border: 2px solid #333; border-radius: 15px; padding: 1.5rem; cursor: pointer; transition: all 0.3s; }
        .stock-card:hover { border-color: #00d4ff; transform: translateY(-5px); }

        .loading-spinner {
            border: 4px solid #1e293b;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            animation: spin 0.8s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 1200px) {
            .ai-chat-widget { width: calc(100% - 20px); right: 10px; left: 10px; }
            .top-plays-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo" onclick="goHome()">üìä Elite Trading</div>
        <div class="search-bar">
            <i class="fas fa-search"></i>
            <input type="text" id="searchInput" placeholder="Search ticker..." onkeypress="if(event.key=='Enter') searchStock()">
            <button onclick="searchStock()">ANALYZE</button>
        </div>
    </div>

    <button class="ai-chat-toggle" onclick="toggleAIChat()" id="aiChatToggle"><i class="fas fa-robot"></i></button>
    <div class="ai-chat-widget" id="aiChatWidget">
        <div class="ai-chat-header">
            <span>ü§ñ Trading AI</span>
            <button onclick="toggleAIChat()" style="background: none; border: none; color: white; font-size: 1.2em; cursor: pointer;">‚úï</button>
        </div>
        <div class="ai-messages" id="aiMessages">
            <div class="message ai">Ask about stocks, strategies, or market conditions.</div>
        </div>
        <div class="ai-input">
            <input type="text" id="aiInput" placeholder="Ask AI..." onkeypress="if(event.key=='Enter') sendAIMessage()">
            <button onclick="sendAIMessage()">Send</button>
        </div>
    </div>

    <div id="homePage" class="page active">
        <div class="container">
            <div style="background: linear-gradient(135deg, #7c3aed 0%, #06b6d4 100%); border-radius: 20px; padding: 3rem 2rem; text-align: center; margin-bottom: 2rem;">
                <h1 style="font-size: 2.8em; font-weight: 900;">Elite Trading Analytics</h1>
                <p style="font-size: 1.1em;">57 Stocks ¬∑ Live Prices ¬∑ AI Analysis</p>
            </div>

            <div class="action-buttons">
                <button class="btn-large btn-refresh" onclick="loadAllStocks()"><i class="fas fa-sync"></i> LOAD 57 STOCKS</button>
                <button class="btn-large btn-brief" onclick="showBrief()"><i class="fas fa-bolt"></i> MARKET BRIEF</button>
                <button class="btn-large btn-newsletter" onclick="showNewsletter()"><i class="fas fa-newspaper"></i> NEWSLETTER SCREENER</button>
            </div>

            <div class="top-plays-section">
                <h2 style="color: #00d4ff; font-size: 1.8em;"><i class="fas fa-star"></i> Top 3 High-Conviction Plays</h2>
                <div class="top-plays-grid" id="topPlays">Loading...</div>
            </div>

            <div id="loadingState" style="display: none; text-align: center; padding: 80px 20px;">
                <div class="loading-spinner"></div>
                <h3 style="color: #e2e8f0; margin-top: 24px; font-size: 20px;">Loading Market Analysis...</h3>
                <p style="color: #94a3b8; margin-top: 8px;">Fetching latest 110-signal recommendations</p>
            </div>

            <div id="errorState" style="display: none; text-align: center; padding: 80px 20px;">
                <div style="font-size: 64px; margin-bottom: 20px;">‚ö†Ô∏è</div>
                <h3 style="color: #ef4444; margin-bottom: 12px; font-size: 20px;">Unable to Load Data</h3>
                <p style="color: #94a3b8; margin-bottom: 24px; font-size: 14px;" id="errorMessage">Connection error</p>
                <button onclick="retryLoad()" style="background: #3b82f6; color: white; border: none; padding: 12px 28px; border-radius: 8px; cursor: pointer; font-size: 15px; font-weight: 600;">
                    üîÑ Retry
                </button>
            </div>

            <div id="stockGrid" class="stock-grid"></div>
        </div>
    </div>

    <div id="briefPage" class="page">
        <div class="container">
            <h1 style="color: #00d4ff; font-size: 2.5em; margin-bottom: 2rem;">üì∞ Market Brief</h1>
            <p style="color: #b0b8c1; font-size: 1.2em;">Quick market overview placeholder...</p>
            <button class="btn-large btn-back" onclick="goHome()">‚Üê BACK TO DASHBOARD</button>
        </div>
    </div>

    <div id="newsletterPage" class="page">
        <div class="container">
            <h1 style="color: #00d4ff; font-size: 2.5em; margin-bottom: 2rem;">üìã Newsletter Screener</h1>
            <p style="color: #b0b8c1; font-size: 1.2em;">Newsletter screener placeholder...</p>
            <button class="btn-large btn-back" onclick="goHome()">‚Üê BACK TO DASHBOARD</button>
        </div>
    </div>

    <div id="researchPage" class="page">
        <div class="container">
            <h1 style="color: #00d4ff; font-size: 2.5em; margin-bottom: 2rem;">üîç Stock Research</h1>
            <div id="researchContent"></div>
            <button class="btn-large btn-back" onclick="goHome()">‚Üê BACK TO DASHBOARD</button>
        </div>
    </div>

    <script>
    // ============================================
    // API CONFIGURATION - Step 1
    // ============================================
    const API_CONFIG = {
        baseUrl: 'https://elite-trading-with-exclusive-ip.onrender.com',
        endpoints: {
            recommendations: '/api/recommendations',
            triggerScan: '/api/trigger-scan'
        },
        refreshInterval: 5 * 60 * 1000,
        fallbackToLocal: true
    };

    function testAPIConfig() {
        console.log('‚úÖ API Config loaded:', API_CONFIG);
        console.log('üîó Recommendations endpoint:', API_CONFIG.baseUrl + API_CONFIG.endpoints.recommendations);
        return API_CONFIG;
    }

    // ============================================
    // API SERVICE FUNCTIONS - Step 2
    // ============================================
    const TradingAPI = {
        async getRecommendations() {
            console.log('üîÑ Fetching recommendations from API...');
            
            try {
                const url = API_CONFIG.baseUrl + API_CONFIG.endpoints.recommendations;
                console.log('üì° Calling:', url);
                
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('‚úÖ Received', data.length, 'stocks from API');
                
                return {
                    success: true,
                    data: data,
                    timestamp: new Date().toISOString()
                };
            } catch (error) {
                console.error('‚ùå API Error:', error);
                
                if (API_CONFIG.fallbackToLocal) {
                    console.log('‚ö†Ô∏è Using local data as fallback');
                    return {
                        success: false,
                        error: error.message,
                        data: allStocks,
                        usingFallback: true
                    };
                }
                
                return {
                    success: false,
                    error: error.message,
                    data: []
                };
            }
        },

        async testConnection() {
            console.log('üß™ Testing API connection...');
            const result = await this.getRecommendations();
            
            if (result.success) {
                console.log('‚úÖ API connection successful!');
                console.log('üìä Sample stock:', result.data[0]);
            } else if (result.usingFallback) {
                console.log('‚ö†Ô∏è API unavailable, using fallback data');
            } else {
                console.log('‚ùå API connection failed:', result.error);
            }
            
            return result;
        }
    };

    function testAPIService() {
        console.log('üß™ Testing API Service...');
        return TradingAPI.testConnection();
    }

    // ============================================
    // UI STATE MANAGEMENT - Step 3
    // ============================================
    function showLoadingState() {
        document.getElementById('loadingState').style.display = 'block';
        document.getElementById('errorState').style.display = 'none';
        document.getElementById('stockGrid').style.display = 'none';
    }

    function hideLoadingState() {
        document.getElementById('loadingState').style.display = 'none';
        document.getElementById('stockGrid').style.display = 'grid';
    }

    function showErrorState(message) {
        document.getElementById('loadingState').style.display = 'none';
        document.getElementById('errorState').style.display = 'block';
        document.getElementById('stockGrid').style.display = 'none';
        document.getElementById('errorMessage').textContent = message || 'Failed to load data';
    }

    function testLoadingState() {
        console.log('Testing loading state...');
        showLoadingState();
        setTimeout(() => {
            console.log('‚úÖ Loading state shown for 2 seconds');
            hideLoadingState();
        }, 2000);
    }

    function testErrorState() {
        console.log('Testing error state...');
        showErrorState('This is a test error message');
        setTimeout(() => {
            console.log('‚úÖ Error state shown for 3 seconds');
            hideLoadingState();
        }, 3000);
    }

    // ============================================
    // DATA - Fallback Stock Data
    // ============================================
    let allStocks = [
        {Symbol:'NVDA',Last:'178.88',Change:'-0.97',RSIWilder:'70',RegimeDetection:'82',Inst33:'85',Signal:'STRONG BUY',Story:'The Setup'},
        {Symbol:'TSLA',Last:'342.80',Change:'-2.3',RSIWilder:'42',RegimeDetection:'50',Inst33:'60',Signal:'HOLD',Story:'The Fade'},
        {Symbol:'META',Last:'512.15',Change:'2.1',RSIWilder:'66',RegimeDetection:'75',Inst33:'80',Signal:'BUY',Story:'The Creep'},
        {Symbol:'AAPL',Last:'289.45',Change:'-1.15',RSIWilder:'52',RegimeDetection:'65',Inst33:'75',Signal:'HOLD',Story:'Quality Hold'},
        {Symbol:'MSFT',Last:'425.30',Change:'0.85',RSIWilder:'58',RegimeDetection:'70',Inst33:'72',Signal:'BUY',Story:'Steady Growth'},
        {Symbol:'GOOGL',Last:'178.50',Change:'-0.9',RSIWilder:'48',RegimeDetection:'55',Inst33:'68',Signal:'HOLD',Story:'Consolidation'},
        {Symbol:'AMZN',Last:'195.20',Change:'1.2',RSIWilder:'62',RegimeDetection:'72',Inst33:'70',Signal:'BUY',Story:'Cloud Strength'},
        {Symbol:'AMD',Last:'142.35',Change:'4.2',RSIWilder:'68',RegimeDetection:'78',Inst33:'65',Signal:'STRONG BUY',Story:'Breakout Play'}
    ];

    // ============================================
    // STEP 4: API-DRIVEN DATA LOADING
    // ============================================
    let lastUpdateTime = null;

    async function loadAllStocks() {
        console.log('üîÑ Loading stocks from API...');
        showLoadingState();
        
        try {
            const result = await TradingAPI.getRecommendations();
            
            if (result.success || result.usingFallback) {
                allStocks = result.data;
                lastUpdateTime = new Date();
                renderStocks();
                hideLoadingState();
                
                if (result.success) {
                    console.log('‚úÖ Loaded from API:', allStocks.length, 'stocks');
                } else {
                    console.log('‚ö†Ô∏è Using fallback data:', allStocks.length, 'stocks');
                }
            } else {
                showErrorState(result.error || 'Failed to load stock data');
            }
        } catch (error) {
            console.error('üí• Unexpected error:', error);
            showErrorState('Unexpected error loading data');
        }
    }

    function renderStocks() {
        const topPlaysHTML = allStocks.slice(0, 3).map((s, i) => {
            const price = parseFloat(s.Last);
            const change = parseFloat(s.Change);
            const buttons = ['STRONG BUY', 'SELL PREMIUM', 'ACCUMULATE'];
            const colors = ['#10b981', '#f59e0b', '#00d4ff'];
            const borderColors = ['#7c3aed', '#7c3aed', '#7c3aed'];
            const bullets = [
                ['üü£ Positive momentum. Technically strong setup. Institutional inflows.',
                 'üü° Buy on support. Sell calls for income. Hold core position.',
                 '‚ö†Ô∏è Watch for exhaustion. Profit taking potential. Monitor key resistance.'],
                ['üü£ Pullback detected -2.3%. IV likely depressed. Mean reversion candidate.',
                 'üü° Buy dips on support. Scale into position. Monitor for reversal confirmation.',
                 '‚ö†Ô∏è Could test deeper lows. Watch key support levels. Use stops.'],
                ['üü£ Positive momentum. Technically strong setup. Institutional inflows.',
                 'üü° Buy on support. Sell calls for income. Hold core position.',
                 '‚ö†Ô∏è Watch for exhaustion. Profit taking potential. Monitor key resistance.']
            ];
            const targets = ['Entry: $146 | T1: $520 | T2: $540<br>Stop: $405', 'Entry: $343 | T1: $360 | T2: $375<br>Stop: $325', 'Entry: $512 | T1: $550 | T2: $580<br>Stop: $490'];

            return `
                <div class="play-card" onclick="researchStock('${s.Symbol}')">
                    <div class="play-title">${s.Story}</div>
                    <div class="play-subtitle">${s.Symbol} @ $${price.toFixed(2)} (${change >= 0 ? '+' : ''}${change}%)</div>
                    <div class="play-change" style="color: ${change >= 0 ? '#10b981' : '#ef4444'};">${change >= 0 ? '‚ñ≤' : '‚ñº'} ${Math.abs(change).toFixed(2)}%</div>
                    <button class="play-button" style="background: ${colors[i]};">${buttons[i]}</button>
                    <div class="play-metrics-grid">
                        <div class="metric-box-sm"><div class="metric-label-sm">RSI</div><div class="metric-value-sm">${s.RSIWilder}</div></div>
                        <div class="metric-box-sm"><div class="metric-label-sm">Regime</div><div class="metric-value-sm">${s.RegimeDetection}%</div></div>
                        <div class="metric-box-sm"><div class="metric-label-sm">Inst</div><div class="metric-value-sm">${s.Inst33}</div></div>
                    </div>
                    <div class="play-analysis" style="border-color: ${borderColors[i]};"><ul>${bullets[i].map(b => `<li>${b}</li>`).join('')}</ul></div>
                    <div class="play-targets"><div class="play-targets-title">üéØ Targets</div><div class="play-targets-content">${targets[i]}</div></div>
                </div>
            `;
        }).join('');
        document.getElementById('topPlays').innerHTML = topPlaysHTML;

        const grid = allStocks.map(s => {
            const price = parseFloat(s.Last);
            const change = parseFloat(s.Change);
            return `
                <div class="stock-card" onclick="researchStock('${s.Symbol}')">
                    <div style="font-size: 2.2em; font-weight: 900; color: white;">${s.Symbol}</div>
                    <div style="font-size: 1.8em; color: #00d4ff; font-weight: 900;">$${price.toFixed(2)}</div>
                    <div style="font-style: italic; color: #b0b8c1; margin: 0.3rem 0;">"${s.Story}"</div>
                    <div style="color: ${change >= 0 ? '#10b981' : '#ef4444'}; font-size: 1.1em; font-weight: 700; margin: 0.5rem 0;">${change >= 0 ? '‚ñ≤' : '‚ñº'} ${Math.abs(change).toFixed(2)}%</div>
                    <span style="display: inline-block; padding: 0.6rem 1.2rem; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border-radius: 8px; font-weight: 700; color: white;">${s.Signal}</span>
                    <div style="margin-top: 1rem; font-size: 0.85em; color: #b0b8c1;">RSI: ${s.RSIWilder} | Regime: ${s.RegimeDetection}% | Inst: ${s.Inst33}</div>
                </div>
            `;
        }).join('');
        document.getElementById('stockGrid').innerHTML = grid;
    }

    function retryLoad() {
        console.log('üîÑ Retry triggered by user');
        loadAllStocks();
    }

    // Auto-refresh every 5 minutes
    setInterval(() => {
        console.log('üîÑ Auto-refresh: Reloading from API...');
        loadAllStocks();
    }, API_CONFIG.refreshInterval);

    // Initialize on page load
    window.addEventListener('load', () => {
        console.log('üöÄ Dashboard initializing...');
        loadAllStocks();
    });

    // ============================================
    // NAVIGATION & UI FUNCTIONS
    // ============================================
    function goHome() {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById('homePage').classList.add('active');
        document.getElementById('aiChatToggle').classList.remove('hidden');
    }

    function showBrief() {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById('briefPage').classList.add('active');
        document.getElementById('aiChatToggle').classList.add('hidden');
    }

    function showNewsletter() {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById('newsletterPage').classList.add('active');
        document.getElementById('aiChatToggle').classList.add('hidden');
    }

    function researchStock(symbol) {
        const stock = allStocks.find(s => s.Symbol === symbol);
        if (!stock) return;
        
        document.getElementById('researchContent').innerHTML = `
            <div style="padding: 2rem; background: rgba(0, 212, 255, 0.05); border: 2px solid #00d4ff; border-radius: 15px;">
                <h2 style="color: #00d4ff; font-size: 2em; margin-bottom: 1rem;">${symbol}</h2>
                <p style="color: #b0b8c1; font-size: 1.2em;">Price: $${parseFloat(stock.Last).toFixed(2)}</p>
                <p style="color: #b0b8c1; font-size: 1.2em;">Change: ${stock.Change}%</p>
                <p style="color: #b0b8c1; font-size: 1.2em;">Signal: ${stock.Signal}</p>
            </div>
        `;
        
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById('researchPage').classList.add('active');
        document.getElementById('aiChatToggle').classList.add('hidden');
    }

    function searchStock() {
        const symbol = document.getElementById('searchInput').value.toUpperCase().trim();
        if (symbol) {
            researchStock(symbol);
        }
    }

    // ============================================
    // AI CHAT FUNCTIONS
    // ============================================
    function toggleAIChat() {
        document.getElementById('aiChatWidget').classList.toggle('active');
    }

    function sendAIMessage() {
        const input = document.getElementById('aiInput');
        const message = input.value.trim();
        if (!message) return;
        
        const messagesDiv = document.getElementById('aiMessages');
        messagesDiv.innerHTML += `<div class="message user">${message}</div>`;
        input.value = '';
        
        setTimeout(() => {
            messagesDiv.innerHTML += `<div class="message ai">I'm analyzing "${message}"... This is a placeholder AI response.</div>`;
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }, 500);
    }
    </script>
</body>
</html>
